#
# <meta:header>
#   <meta:licence>
#     Copyright (c) 2018, ROE (http://www.roe.ac.uk/)
#
#     This information is free software: you can redistribute it and/or modify
#     it under the terms of the GNU General Public License as published by
#     the Free Software Foundation, either version 3 of the License, or
#     (at your option) any later version.
#
#     This information is distributed in the hope that it will be useful,
#     but WITHOUT ANY WARRANTY; without even the implied warranty of
#     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#     GNU General Public License for more details.
#
#     You should have received a copy of the GNU General Public License
#     along with this program.  If not, see <http://www.gnu.org/licenses/>.
#   </meta:licence>
# </meta:header>
#
#

# -----------------------------------------------------
# Load our libvirt configuration.
#[user@trop03]

    source "${HOME}/libvirt.settings"

# -----------------------------------------------------
# Configure our SSH settings.
#[user@trop03]

    sshuser=Stevedore
    sshopts=(
        '-A'
        '-o LogLevel=ERROR'
        '-o CheckHostIP=no'
        '-o UserKnownHostsFile=/dev/null'
        '-o StrictHostKeyChecking=no'
        )

    scpopts=(
        '-o LogLevel=ERROR'
        '-o CheckHostIP=no'
        '-o UserKnownHostsFile=/dev/null'
        '-o StrictHostKeyChecking=no'
        )

# -----------------------------------------------------
# Assign our virtual machine names.
#[user@trop03]

    kfnames=(
        Stedigo
        Angece
        Edwalafia
        Onoza
        )

    zknames=(
        Fosauri
        Marpus
        Byflame
        )

    mmnames=(
        Afoaviel
        Rusaldez
        )

# -----------------------------------------------------
# Sed script to indent output.
#[user@laptop]

    sed -i '
        /^--START--/,/^--STOP--/ {
            /^--START--/ d
            /^--STOP--/  d
            s/^\(.*\)/    >   \1/
            }
        ' doc/notes/zrq/20181223-01-trop-transfer.txt

    --START--
    --STOP--

# -----------------------------------------------------
# Check containers on our Kafka nodes.
#[user@trop03]

    for vmname in ${kfnames[@]}
        do
            echo "---- ----"
            ssh \
                ${sshopts[*]} \
                ${sshuser:?}@${vmname:?} \
                    "
                    hostname
                    docker ps -a
                    "
        done


    >   ---- ----
    >   Stedigo
    >   CONTAINER ID        IMAGE                         COMMAND                  CREATED             STATUS                  PORTS               NAMES
    >   528f5c8d6a84        confluentinc/cp-kafka:4.1.1   "/etc/confluent/dock…"   11 days ago         Exited (1) 5 days ago                       stevedore_emily_1
    >   ---- ----
    >   Angece
    >   CONTAINER ID        IMAGE                         COMMAND                  CREATED             STATUS                  PORTS               NAMES
    >   54ab40521deb        confluentinc/cp-kafka:4.1.1   "/etc/confluent/dock…"   11 days ago         Exited (1) 5 days ago                       stevedore_emily_1
    >   ---- ----
    >   Edwalafia
    >   CONTAINER ID        IMAGE                         COMMAND                  CREATED             STATUS              PORTS                              NAMES
    >   4af2d612c94e        confluentinc/cp-kafka:4.1.1   "/etc/confluent/dock…"   11 days ago         Up 11 days          0.0.0.0:9092-9093->9092-9093/tcp   stevedore_emily_1
    >   ---- ----
    >   Onoza
    >   CONTAINER ID        IMAGE                         COMMAND                  CREATED             STATUS                  PORTS               NAMES
    >   e02f40328809        confluentinc/cp-kafka:4.1.1   "/etc/confluent/dock…"   11 days ago         Exited (1) 5 days ago                       stevedore_emily_1


# -----------------------------------------------------
# Check the disc space on our Kafka nodes.
#[user@trop03]

    for vmname in ${kfnames[@]}
        do
            ssh \
                ${sshopts[*]} \
                ${sshuser:?}@${vmname:?} \
                    "
                    echo \"---- ---- ---- ----\"
                    echo \"[\$(hostname)][\$(date)]\"
                    echo \"---- ----\"
                    df -h /
                    echo \"---- ----\"
                    df -h \"/data1-01\"
                    echo "---- ----"
                    df -h \"/data2-01\"
                    "
        done


    >   ---- ---- ---- ----
    >   [Stedigo][Sun 23 Dec 12:55:03 GMT 2018]
    >   ---- ----
    >   Filesystem      Size  Used Avail Use% Mounted on
    >   /dev/vda3       6.8G  2.5G  3.8G  39% /
    >   ---- ----
    >   Filesystem      Size  Used Avail Use% Mounted on
    >   /dev/vdc         32G   31G   48K 100% /data1-01
    >   ---- ----
    >   Filesystem      Size  Used Avail Use% Mounted on
    >   /dev/vdd         32G   31G   56K 100% /data2-01
    >   ---- ---- ---- ----
    >   [Angece][Sun 23 Dec 12:55:04 GMT 2018]
    >   ---- ----
    >   Filesystem      Size  Used Avail Use% Mounted on
    >   /dev/vda3       6.8G  2.4G  3.9G  39% /
    >   ---- ----
    >   Filesystem      Size  Used Avail Use% Mounted on
    >   /dev/vdc         32G   31G   20K 100% /data1-01
    >   ---- ----
    >   Filesystem      Size  Used Avail Use% Mounted on
    >   /dev/vdd         32G   31G   12K 100% /data2-01
    >   ---- ---- ---- ----
    >   [Edwalafia][Sun 23 Dec 12:55:04 GMT 2018]
    >   ---- ----
    >   Filesystem      Size  Used Avail Use% Mounted on
    >   /dev/vda3       6.8G  2.5G  3.8G  40% /
    >   ---- ----
    >   Filesystem      Size  Used Avail Use% Mounted on
    >   /dev/vdc         32G   31G  764K 100% /data1-01
    >   ---- ----
    >   Filesystem      Size  Used Avail Use% Mounted on
    >   /dev/vdd         32G   31G   44K 100% /data2-01
    >   ---- ---- ---- ----
    >   [Onoza][Sun 23 Dec 12:55:05 GMT 2018]
    >   ---- ----
    >   Filesystem      Size  Used Avail Use% Mounted on
    >   /dev/vda3       6.8G  2.4G  3.9G  39% /
    >   ---- ----
    >   Filesystem      Size  Used Avail Use% Mounted on
    >   /dev/vdc         32G   31G   28K 100% /data1-01
    >   ---- ----
    >   Filesystem      Size  Used Avail Use% Mounted on
    >   /dev/vdd         32G   31G   16K 100% /data2-01


# -----------------------------------------------------
# Stop kafka on each node.
#[user@trop03]

    for vmname in ${kfnames[@]}
        do
            echo "---- ----"
            ssh \
                ${scpopts[*]} \
                ${sshuser:?}@${vmname:?} \
                "
                hostname
                docker-compose \
                    --file kafka.yml \
                    down
                "
        done


    >   ---- ----
    >   Stedigo
    >   Removing stevedore_emily_1 ... done
    >   Removing network stevedore_default
    >   ---- ----
    >   Angece
    >   Removing stevedore_emily_1 ... done
    >   Removing network stevedore_default
    >   ---- ----
    >   Edwalafia
    >   Stopping stevedore_emily_1 ... done
    >   Removing stevedore_emily_1 ... done
    >   Removing network stevedore_default
    >   ---- ----
    >   Onoza
    >   Removing stevedore_emily_1 ... done
    >   Removing network stevedore_default


# -----------------------------------------------------
# Create lists of devices and mount points.
#[user@trop03]

    source "${HOME}/libvirt.settings"

    volnum=02
    volsize=64G

    unset volpools
    volpools=(
        data1
        data2
        )

    unset voldevs
    declare -A voldevs=(
        [data1]=vde
        [data2]=vdf
        )

    unset volmnts
    declare -A volmnts=(
        [data1]=/data1-02
        [data2]=/data2-02
        )


# -----------------------------------------------------
# Create a new volume for each Kafka node.
#[user@trop03]

    for vmname in ${kfnames[@]}
        do
            echo "---- ----"
            echo "vmname [${vmname}]"
            for volpool in ${volpools[@]}
                do
                    echo "----"
                    volname=${vmname:?}-${volpool:?}-${volnum:?}.qcow
                    echo "volpool [${volpool}]"
                    echo "volname [${volname}]"
                    virsh \
                        --connect ${connection:?} \
                        vol-create-as \
                            ${volpool:?} \
                            ${volname:?} \
                            ${volsize} \
                            --allocation 0 \
                            --format qcow2

                    virsh \
                        --connect ${connection:?} \
                        vol-info \
                            --pool "${volpool:?}" \
                            ${volname:?}

                done
        done


    >   ---- ----
    >   vmname [Stedigo]
    >   ----
    >   volpool [data1]
    >   volname [Stedigo-data1-02.qcow]
    >   Vol Stedigo-data1-02.qcow created
    >
    >   Name:           Stedigo-data1-02.qcow
    >   Type:           file
    >   Capacity:       64.00 GiB
    >   Allocation:     196.00 KiB
    >
    >   ----
    >   volpool [data2]
    >   volname [Stedigo-data2-02.qcow]
    >   Vol Stedigo-data2-02.qcow created
    >
    >   Name:           Stedigo-data2-02.qcow
    >   Type:           file
    >   Capacity:       64.00 GiB
    >   Allocation:     196.00 KiB
    >
    >   ---- ----
    >   vmname [Angece]
    >   ----
    >   volpool [data1]
    >   volname [Angece-data1-02.qcow]
    >   Vol Angece-data1-02.qcow created
    >
    >   Name:           Angece-data1-02.qcow
    >   Type:           file
    >   Capacity:       64.00 GiB
    >   Allocation:     196.00 KiB
    >
    >   ----
    >   volpool [data2]
    >   volname [Angece-data2-02.qcow]
    >   Vol Angece-data2-02.qcow created
    >
    >   Name:           Angece-data2-02.qcow
    >   Type:           file
    >   Capacity:       64.00 GiB
    >   Allocation:     196.00 KiB
    >
    >   ---- ----
    >   vmname [Edwalafia]
    >   ----
    >   volpool [data1]
    >   volname [Edwalafia-data1-02.qcow]
    >   Vol Edwalafia-data1-02.qcow created
    >
    >   Name:           Edwalafia-data1-02.qcow
    >   Type:           file
    >   Capacity:       64.00 GiB
    >   Allocation:     196.00 KiB
    >
    >   ----
    >   volpool [data2]
    >   volname [Edwalafia-data2-02.qcow]
    >   Vol Edwalafia-data2-02.qcow created
    >
    >   Name:           Edwalafia-data2-02.qcow
    >   Type:           file
    >   Capacity:       64.00 GiB
    >   Allocation:     196.00 KiB
    >
    >   ---- ----
    >   vmname [Onoza]
    >   ----
    >   volpool [data1]
    >   volname [Onoza-data1-02.qcow]
    >   Vol Onoza-data1-02.qcow created
    >
    >   Name:           Onoza-data1-02.qcow
    >   Type:           file
    >   Capacity:       64.00 GiB
    >   Allocation:     196.00 KiB
    >
    >   ----
    >   volpool [data2]
    >   volname [Onoza-data2-02.qcow]
    >   Vol Onoza-data2-02.qcow created
    >
    >   Name:           Onoza-data2-02.qcow
    >   Type:           file
    >   Capacity:       64.00 GiB
    >   Allocation:     196.00 KiB


# -----------------------------------------------------
# Attach the new volume to each Kafka node.
#[user@trop03]

    for vmname in ${kfnames[@]}
        do
            echo "---- ----"
            echo "vmname [${vmname}]"
            for volpool in ${volpools[@]}
                do
                    echo "----"
                    volname=${vmname:?}-${volpool:?}-${volnum:?}.qcow
                    echo "volpool [${volpool}]"
                    echo "volname [${volname}]"

                    volpath=$(
                        virsh \
                            --connect "${connection:?}" \
                            vol-path \
                                --pool "${volpool:?}" \
                                "${volname:?}"
                        )

                    voldev=${voldevs[${volpool:?}]}
                    echo "voldev  [${voldev}]"
                    echo "volpath [${volpath}]"

                    virsh \
                        --connect "${connection:?}" \
                        attach-disk \
                            ${vmname:?}   \
                            ${volpath:?}  \
                            ${voldev:?}   \
                            --driver qemu  \
                            --subdriver qcow2

                done
        done


    >   ---- ----
    >   vmname [Stedigo]
    >   ----
    >   volpool [data1]
    >   volname [Stedigo-data1-02.qcow]
    >   voldev  [vde]
    >   volpath [/data1/libvirt/images/data1/Stedigo-data1-02.qcow]
    >   Disk attached successfully
    >
    >   ----
    >   volpool [data2]
    >   volname [Stedigo-data2-02.qcow]
    >   voldev  [vdf]
    >   volpath [/data2/libvirt/images/data2/Stedigo-data2-02.qcow]
    >   Disk attached successfully
    >
    >   ---- ----
    >   vmname [Angece]
    >   ----
    >   volpool [data1]
    >   volname [Angece-data1-02.qcow]
    >   voldev  [vde]
    >   volpath [/data1/libvirt/images/data1/Angece-data1-02.qcow]
    >   Disk attached successfully
    >
    >   ----
    >   volpool [data2]
    >   volname [Angece-data2-02.qcow]
    >   voldev  [vdf]
    >   volpath [/data2/libvirt/images/data2/Angece-data2-02.qcow]
    >   Disk attached successfully
    >
    >   ---- ----
    >   vmname [Edwalafia]
    >   ----
    >   volpool [data1]
    >   volname [Edwalafia-data1-02.qcow]
    >   voldev  [vde]
    >   volpath [/data1/libvirt/images/data1/Edwalafia-data1-02.qcow]
    >   Disk attached successfully
    >
    >   ----
    >   volpool [data2]
    >   volname [Edwalafia-data2-02.qcow]
    >   voldev  [vdf]
    >   volpath [/data2/libvirt/images/data2/Edwalafia-data2-02.qcow]
    >   Disk attached successfully
    >
    >   ---- ----
    >   vmname [Onoza]
    >   ----
    >   volpool [data1]
    >   volname [Onoza-data1-02.qcow]
    >   voldev  [vde]
    >   volpath [/data1/libvirt/images/data1/Onoza-data1-02.qcow]
    >   Disk attached successfully
    >
    >   ----
    >   volpool [data2]
    >   volname [Onoza-data2-02.qcow]
    >   voldev  [vdf]
    >   volpath [/data2/libvirt/images/data2/Onoza-data2-02.qcow]
    >   Disk attached successfully


#---------------------------------------------------------------------
# Create a script to mount a volume.
#[user@virtual]

cat > /tmp/volume-mount.sh << 'EOSH'

echo "---- ----"
echo "hostname [$(hostname)]"
echo "devpath  [${devpath:?}]"
echo "mntpath  [${mntpath:?}]"

#---------------------------------------------------------------------
# Create a filesystem on the new device.

    sudo \
        mkfs.btrfs \
            --force \
            ${devpath:?}

#---------------------------------------------------------------------
# Create our mount point.

    sudo mkdir -p "${mntpath:?}"
    sudo touch "${mntpath:?}/mount-failed"

#---------------------------------------------------------------------
# Add the volume to our FileSystemTABle.
# https://www.howtoforge.com/reducing-disk-io-by-mounting-partitions-with-noatime

    devuuid=$(
        lsblk --noheadings --output UUID "${devpath:?}"
        )

sudo tee -a /etc/fstab << EOTAB
UUID=${devuuid:?} ${mntpath:?}    btrfs    defaults,noatime    0  0
EOTAB

#---------------------------------------------------------------------
# Mount the new volume.

    sudo \
        mount "${mntpath:?}"

#---------------------------------------------------------------------
# Check the new volume.

    df -h "${mntpath:?}"
    ls -l "${mntpath:?}"

EOSH

# -----------------------------------------------------
# Login and mount each of the new volumes.
#[user@trop03]

    for vmname in ${kfnames[@]}
        do
            for volpool in ${volpools[@]}
                do
                    devpath=/dev/${voldevs[${volpool}]}
                    mntpath=${volmnts[${volpool}]}
                    echo "---- ----"
                    echo "vmname  [${vmname}]"
                    echo "devpath [${devpath}]"
                    echo "mntpath [${mntpath}]"

                    echo "
                        export devpath=${devpath:?}
                        export mntpath=${mntpath:?}
                    " \
                    | cat - /tmp/volume-mount.sh \
                    | ssh \
                        ${sshopts[*]} \
                        ${sshuser:?}@${vmname:?}
                done
        done


    >   ---- ----
    >   vmname  [Stedigo]
    >   devpath [/dev/vde]
    >   mntpath [/data1-02]
    >   ---- ----
    >   hostname [Stedigo]
    >   devpath  [/dev/vde]
    >   mntpath  [/data1-02]
    >   btrfs-progs v4.17.1
    >   See http://btrfs.wiki.kernel.org for more information.
    >
    >   Label:              (null)
    >   UUID:               55e5fcb2-c24a-4a21-8914-7843ac5596a9
    >   Node size:          16384
    >   Sector size:        4096
    >   Filesystem size:    64.00GiB
    >   Block group profiles:
    >     Data:             single            8.00MiB
    >     Metadata:         DUP               1.00GiB
    >     System:           DUP               8.00MiB
    >   SSD detected:       no
    >   Incompat features:  extref, skinny-metadata
    >   Number of devices:  1
    >   Devices:
    >      ID        SIZE  PATH
    >       1    64.00GiB  /dev/vde
    >
    >   UUID=55e5fcb2-c24a-4a21-8914-7843ac5596a9 /data1-02    btrfs    defaults,noatime    0  0
    >   Filesystem      Size  Used Avail Use% Mounted on
    >   /dev/vde         64G   17M   62G   1% /data1-02
    >   total 0
    >   ---- ----
    >   vmname  [Stedigo]
    >   devpath [/dev/vdf]
    >   mntpath [/data2-02]
    >   ---- ----
    >   hostname [Stedigo]
    >   devpath  [/dev/vdf]
    >   mntpath  [/data2-02]
    >   btrfs-progs v4.17.1
    >   See http://btrfs.wiki.kernel.org for more information.
    >
    >   Label:              (null)
    >   UUID:               b4d70a33-7af9-4762-b2a3-9c0c8c587bf4
    >   Node size:          16384
    >   Sector size:        4096
    >   Filesystem size:    64.00GiB
    >   Block group profiles:
    >     Data:             single            8.00MiB
    >     Metadata:         DUP               1.00GiB
    >     System:           DUP               8.00MiB
    >   SSD detected:       no
    >   Incompat features:  extref, skinny-metadata
    >   Number of devices:  1
    >   Devices:
    >      ID        SIZE  PATH
    >       1    64.00GiB  /dev/vdf
    >
    >   UUID=b4d70a33-7af9-4762-b2a3-9c0c8c587bf4 /data2-02    btrfs    defaults,noatime    0  0
    >   Filesystem      Size  Used Avail Use% Mounted on
    >   /dev/vdf         64G   17M   62G   1% /data2-02
    >   total 0
    >   ---- ----
    >   vmname  [Angece]
    >   devpath [/dev/vde]
    >   mntpath [/data1-02]
    >   ---- ----
    >   hostname [Angece]
    >   devpath  [/dev/vde]
    >   mntpath  [/data1-02]
    >   btrfs-progs v4.17.1
    >   See http://btrfs.wiki.kernel.org for more information.
    >
    >   Label:              (null)
    >   UUID:               c553c0e4-b693-467a-ae4a-c594cc4d7afa
    >   Node size:          16384
    >   Sector size:        4096
    >   Filesystem size:    64.00GiB
    >   Block group profiles:
    >     Data:             single            8.00MiB
    >     Metadata:         DUP               1.00GiB
    >     System:           DUP               8.00MiB
    >   SSD detected:       no
    >   Incompat features:  extref, skinny-metadata
    >   Number of devices:  1
    >   Devices:
    >      ID        SIZE  PATH
    >       1    64.00GiB  /dev/vde
    >
    >   UUID=c553c0e4-b693-467a-ae4a-c594cc4d7afa /data1-02    btrfs    defaults,noatime    0  0
    >   Filesystem      Size  Used Avail Use% Mounted on
    >   /dev/vde         64G   17M   62G   1% /data1-02
    >   total 0
    >   ---- ----
    >   vmname  [Angece]
    >   devpath [/dev/vdf]
    >   mntpath [/data2-02]
    >   ---- ----
    >   hostname [Angece]
    >   devpath  [/dev/vdf]
    >   mntpath  [/data2-02]
    >   btrfs-progs v4.17.1
    >   See http://btrfs.wiki.kernel.org for more information.
    >
    >   Label:              (null)
    >   UUID:               e3a32ee7-c334-4346-820c-707e46c1d3d8
    >   Node size:          16384
    >   Sector size:        4096
    >   Filesystem size:    64.00GiB
    >   Block group profiles:
    >     Data:             single            8.00MiB
    >     Metadata:         DUP               1.00GiB
    >     System:           DUP               8.00MiB
    >   SSD detected:       no
    >   Incompat features:  extref, skinny-metadata
    >   Number of devices:  1
    >   Devices:
    >      ID        SIZE  PATH
    >       1    64.00GiB  /dev/vdf
    >
    >   UUID=e3a32ee7-c334-4346-820c-707e46c1d3d8 /data2-02    btrfs    defaults,noatime    0  0
    >   Filesystem      Size  Used Avail Use% Mounted on
    >   /dev/vdf         64G   17M   62G   1% /data2-02
    >   total 0
    >   ---- ----
    >   vmname  [Edwalafia]
    >   devpath [/dev/vde]
    >   mntpath [/data1-02]
    >   ---- ----
    >   hostname [Edwalafia]
    >   devpath  [/dev/vde]
    >   mntpath  [/data1-02]
    >   btrfs-progs v4.17.1
    >   See http://btrfs.wiki.kernel.org for more information.
    >
    >   Label:              (null)
    >   UUID:               a921ae6f-02b0-4da3-88dd-bf5252cfcfdb
    >   Node size:          16384
    >   Sector size:        4096
    >   Filesystem size:    64.00GiB
    >   Block group profiles:
    >     Data:             single            8.00MiB
    >     Metadata:         DUP               1.00GiB
    >     System:           DUP               8.00MiB
    >   SSD detected:       no
    >   Incompat features:  extref, skinny-metadata
    >   Number of devices:  1
    >   Devices:
    >      ID        SIZE  PATH
    >       1    64.00GiB  /dev/vde
    >
    >   UUID=a921ae6f-02b0-4da3-88dd-bf5252cfcfdb /data1-02    btrfs    defaults,noatime    0  0
    >   Filesystem      Size  Used Avail Use% Mounted on
    >   /dev/vde         64G   17M   62G   1% /data1-02
    >   total 0
    >   ---- ----
    >   vmname  [Edwalafia]
    >   devpath [/dev/vdf]
    >   mntpath [/data2-02]
    >   ---- ----
    >   hostname [Edwalafia]
    >   devpath  [/dev/vdf]
    >   mntpath  [/data2-02]
    >   btrfs-progs v4.17.1
    >   See http://btrfs.wiki.kernel.org for more information.
    >
    >   Label:              (null)
    >   UUID:               ce19d30f-2583-4106-b093-e67127beb96d
    >   Node size:          16384
    >   Sector size:        4096
    >   Filesystem size:    64.00GiB
    >   Block group profiles:
    >     Data:             single            8.00MiB
    >     Metadata:         DUP               1.00GiB
    >     System:           DUP               8.00MiB
    >   SSD detected:       no
    >   Incompat features:  extref, skinny-metadata
    >   Number of devices:  1
    >   Devices:
    >      ID        SIZE  PATH
    >       1    64.00GiB  /dev/vdf
    >
    >   UUID=ce19d30f-2583-4106-b093-e67127beb96d /data2-02    btrfs    defaults,noatime    0  0
    >   Filesystem      Size  Used Avail Use% Mounted on
    >   /dev/vdf         64G   17M   62G   1% /data2-02
    >   total 0
    >   ---- ----
    >   vmname  [Onoza]
    >   devpath [/dev/vde]
    >   mntpath [/data1-02]
    >   ---- ----
    >   hostname [Onoza]
    >   devpath  [/dev/vde]
    >   mntpath  [/data1-02]
    >   btrfs-progs v4.17.1
    >   See http://btrfs.wiki.kernel.org for more information.
    >
    >   Label:              (null)
    >   UUID:               dde98c24-9112-45b4-8ca6-6d6ac85ca9b0
    >   Node size:          16384
    >   Sector size:        4096
    >   Filesystem size:    64.00GiB
    >   Block group profiles:
    >     Data:             single            8.00MiB
    >     Metadata:         DUP               1.00GiB
    >     System:           DUP               8.00MiB
    >   SSD detected:       no
    >   Incompat features:  extref, skinny-metadata
    >   Number of devices:  1
    >   Devices:
    >      ID        SIZE  PATH
    >       1    64.00GiB  /dev/vde
    >
    >   UUID=dde98c24-9112-45b4-8ca6-6d6ac85ca9b0 /data1-02    btrfs    defaults,noatime    0  0
    >   Filesystem      Size  Used Avail Use% Mounted on
    >   /dev/vde         64G   17M   62G   1% /data1-02
    >   total 0
    >   ---- ----
    >   vmname  [Onoza]
    >   devpath [/dev/vdf]
    >   mntpath [/data2-02]
    >   ---- ----
    >   hostname [Onoza]
    >   devpath  [/dev/vdf]
    >   mntpath  [/data2-02]
    >   btrfs-progs v4.17.1
    >   See http://btrfs.wiki.kernel.org for more information.
    >
    >   Label:              (null)
    >   UUID:               ceba1807-350d-44be-9640-b01c57bdc749
    >   Node size:          16384
    >   Sector size:        4096
    >   Filesystem size:    64.00GiB
    >   Block group profiles:
    >     Data:             single            8.00MiB
    >     Metadata:         DUP               1.00GiB
    >     System:           DUP               8.00MiB
    >   SSD detected:       no
    >   Incompat features:  extref, skinny-metadata
    >   Number of devices:  1
    >   Devices:
    >      ID        SIZE  PATH
    >       1    64.00GiB  /dev/vdf
    >
    >   UUID=ceba1807-350d-44be-9640-b01c57bdc749 /data2-02    btrfs    defaults,noatime    0  0
    >   Filesystem      Size  Used Avail Use% Mounted on
    >   /dev/vdf         64G   17M   62G   1% /data2-02
    >   total 0


# -----------------------------------------------------
# Check the available space on each Kafka node.
#[user@trop03]

    for vmname in ${kfnames[@]}
        do
            echo "---- ----"
            echo "vmname [${vmname:?}]"
            ssh \
                ${scpopts[*]} \
                ${sshuser:?}@${vmname:?} \
                "
                df -h | grep '^/dev/' | sort
                "
        done


    >   ---- ----
    >   vmname [Stedigo]
    >   /dev/vda1       240M  118M  106M  53% /boot
    >   /dev/vda3       6.8G  2.4G  3.9G  39% /
    >   /dev/vdc         32G   31G   48K 100% /data1-01
    >   /dev/vdd         32G   31G   56K 100% /data2-01
    >   /dev/vde         64G   17M   62G   1% /data1-02
    >   /dev/vdf         64G   17M   62G   1% /data2-02
    >   ---- ----
    >   vmname [Angece]
    >   /dev/vda1       240M  118M  106M  53% /boot
    >   /dev/vda3       6.8G  2.4G  3.9G  39% /
    >   /dev/vdc         32G   31G   20K 100% /data1-01
    >   /dev/vdd         32G   31G   12K 100% /data2-01
    >   /dev/vde         64G   17M   62G   1% /data1-02
    >   /dev/vdf         64G   17M   62G   1% /data2-02
    >   ---- ----
    >   vmname [Edwalafia]
    >   /dev/vda1       240M  118M  106M  53% /boot
    >   /dev/vda3       6.8G  2.4G  3.9G  39% /
    >   /dev/vdc         32G   31G  1.3M 100% /data1-01
    >   /dev/vdd         32G   31G   44K 100% /data2-01
    >   /dev/vde         64G   17M   62G   1% /data1-02
    >   /dev/vdf         64G   17M   62G   1% /data2-02
    >   ---- ----
    >   vmname [Onoza]
    >   /dev/vda1       240M  118M  106M  53% /boot
    >   /dev/vda3       6.8G  2.4G  3.9G  39% /
    >   /dev/vdc         32G   31G   28K 100% /data1-01
    >   /dev/vdd         32G   31G   16K 100% /data2-01
    >   /dev/vde         64G   17M   62G   1% /data1-02
    >   /dev/vdf         64G   17M   62G   1% /data2-02


# -----------------------------------------------------
# Update the Kafka compose ENV file.
#[user@trop03]

    newvols=/data1-02,/data2-02

    for vmname in ${kfnames[@]}
        do
            echo "---- ----"
            echo "vmname [${vmname:?}]"
            ssh \
                ${scpopts[*]} \
                ${sshuser:?}@${vmname:?} \
                    "
                    sed -i '
                        s|KAFKA_LOG_DIRS=\(.*\)|KAFKA_LOG_DIRS=\1,${newvols}|
                        ' kafka.env

                    sed -n '
                        /^KAFKA_LOG_DIRS/ p
                        ' kafka.env
                    "
        done


    >   ---- ----
    >   vmname [Stedigo]
    >   KAFKA_LOG_DIRS=/data1-01,/data2-01,/data1-02,/data2-02
    >   ---- ----
    >   vmname [Angece]
    >   KAFKA_LOG_DIRS=/data1-01,/data2-01,/data1-02,/data2-02
    >   ---- ----
    >   vmname [Edwalafia]
    >   KAFKA_LOG_DIRS=/data1-01,/data2-01,/data1-02,/data2-02
    >   ---- ----
    >   vmname [Onoza]
    >   KAFKA_LOG_DIRS=/data1-01,/data2-01,/data1-02,/data2-02


# -----------------------------------------------------
# Start Kafka on each node.
#[user@trop03]

    for vmname in ${kfnames[@]}
        do
            echo "---- ----"
            ssh \
                ${scpopts[*]} \
                ${sshuser:?}@${vmname:?} \
                "
                hostname
                docker-compose \
                    --file kafka.yml \
                    up -d
                "
        done


    >   ---- ----
    >   Stedigo
    >   Creating network "stevedore_default" with the default driver
    >   Creating stevedore_emily_1 ... done
    >   ---- ----
    >   Angece
    >   Creating network "stevedore_default" with the default driver
    >   Creating stevedore_emily_1 ... done
    >   ---- ----
    >   Edwalafia
    >   Creating network "stevedore_default" with the default driver
    >   Creating stevedore_emily_1 ... done
    >   ---- ----
    >   Onoza
    >   Creating network "stevedore_default" with the default driver
    >   Creating stevedore_emily_1 ... done


# -----------------------------------------------------
# Login and tail the logs (separate terminals).
#[user@trop03]

    ssh trop03

        ssh Edwalafia
        ssh Onoza
        ssh Angece
        ssh Stedigo

            docker logs -f stevedore_emily_1


    >   [2018-12-23 14:22:04,946] INFO [Log partition=ztf_20181205_programid1-12, dir=/data1-01] Completed load of log with 1 segments, log start offset 0 and log end offset 10622 in 48339 ms (kafka.log.Log)
    >   [2018-12-23 14:22:04,946] INFO [Log partition=ztf_20181205_programid1-8, dir=/data2-01] Completed load of log with 1 segments, log start offset 0 and log end offset 10622 in 47837 ms (kafka.log.Log)
    >   [2018-12-23 14:22:04,953] WARN [Log partition=ztf_20181205_programid1-0, dir=/data2-01] Found a corrupted index file corresponding to log file /data2-01/ztf_20181205_programid1-0/00000000000000000000.log
        due to Corrupt index found, index file (/data2-01/ztf_20181205_programid1-0/00000000000000000000.index) has non-zero size but the last offset is 0 which is no greater than the base offset 0.},
        recovering segment and rebuilding index files... (kafka.log.Log)
    >   [2018-12-23 14:22:04,953] WARN [Log partition=ztf_20181205_programid1-4, dir=/data1-01] Found a corrupted index file corresponding to log file /data1-01/ztf_20181205_programid1-4/00000000000000000000.log
        due to Corrupt index found, index file (/data1-01/ztf_20181205_programid1-4/00000000000000000000.index) has non-zero size but the last offset is 0 which is no greater than the base offset 0.},
        recovering segment and rebuilding index files... (kafka.log.Log)
    >   ....
    >   ....
    >   [2018-12-23 15:05:23,029] INFO [ReplicaFetcherManager on broker 3] Removed fetcher for partitions ztf_20181215_programid1-7 (kafka.server.ReplicaFetcherManager)
    >   [2018-12-23 15:05:23,029] INFO [Partition ztf_20181215_programid1-7 broker=3] ztf_20181215_programid1-7 starts at Leader Epoch 4 from offset 642. Previous Leader Epoch was: 3 (kafka.cluster.Partition)
    >   [2018-12-23 15:05:23,029] TRACE [Broker id=3] Stopped fetchers as part of become-leader request from controller 2 epoch 3 with correlation id 178 for partition ztf_20181215_programid1-7
        (last update controller epoch 3) (state.change.logger)
    >   [2018-12-23 15:05:23,029] TRACE [Broker id=3] Completed LeaderAndIsr request correlationId 178 from controller 2 epoch 3 for the become-leader transition for partition ztf_20181215_programid1-7 (state.change.logger)
    >   [2018-12-23 15:05:23,030] INFO [ReplicaAlterLogDirsManager on broker 3] Added fetcher for partitions List() (kafka.server.ReplicaAlterLogDirsManager)
    >   [2018-12-23 15:05:23,031] TRACE [Broker id=3] Cached leader info PartitionState(controllerEpoch=3, leader=3, leaderEpoch=4, isr=[1, 3, 2], zkVersion=6, replicas=[3, 1, 2], offlineReplicas=[])
        for partition ztf_20181215_programid1-7 in response to UpdateMetadata request sent by controller 2 epoch 3 with correlation id 179 (state.change.logger)



    >   [2018-12-23 14:22:06,780] INFO [Log partition=ztf_20181205_programid1-9, dir=/data2-01] Recovering unflushed segment 0 (kafka.log.Log)
    >   [2018-12-23 14:22:08,648] INFO [ProducerStateManager partition=ztf_20181205_programid1-9] Writing producer snapshot at offset 10622 (kafka.log.ProducerStateManager)
    >   [2018-12-23 14:22:08,651] INFO [Log partition=ztf_20181205_programid1-9, dir=/data2-01] Loading producer state from offset 10622 with message format version 2 (kafka.log.Log)
    >   [2018-12-23 14:22:08,652] INFO [ProducerStateManager partition=ztf_20181205_programid1-9] Loading producer state from snapshot file
        '/data2-01/ztf_20181205_programid1-9/00000000000000010622.snapshot' (kafka.log.ProducerStateManager)
    >   [2018-12-23 14:22:08,652] INFO [Log partition=ztf_20181205_programid1-9, dir=/data2-01] Completed load of log with 1 segments, log start offset 0 and log end offset 10622 in 49092 ms (kafka.log.Log)
    >   [2018-12-23 14:22:08,659] WARN [Log partition=ztf_20181205_programid1-1, dir=/data2-01] Found a corrupted index file corresponding to log file
        /data2-01/ztf_20181205_programid1-1/00000000000000000000.log due to Corrupt index found, index file (/data2-01/ztf_20181205_programid1-1/00000000000000000000.index)
        has non-zero size but the last offset is 0 which is no greater than the base offset 0.}, recovering segment and rebuilding index files... (kafka.log.Log)
    >   ....
    >   ....
    >   [2018-12-23 15:05:23,299] INFO [Log partition=ztf_20181209_programid1-13, dir=/data2-01] Truncating to 4205 has no effect as the largest offset in the log is 4204 (kafka.log.Log)
    >   [2018-12-23 15:05:23,300] INFO [ReplicaFetcher replicaId=4, leaderId=3, fetcherId=0] Based on follower's leader epoch, leader replied with an offset 10622 >= the follower's log end offset 10622 in ztf_20181205_programid1-8.
        No truncation needed. (kafka.server.ReplicaFetcherThread)
    >   [2018-12-23 15:05:23,300] INFO [Log partition=ztf_20181205_programid1-8, dir=/data1-01] Truncating to 10622 has no effect as the largest offset in the log is 10621 (kafka.log.Log)
    >   [2018-12-23 15:05:23,300] INFO [ReplicaFetcher replicaId=4, leaderId=3, fetcherId=0] Based on follower's leader epoch, leader replied with an offset 10622 >= the follower's log end offset 10622 in ztf_20181205_programid1-0.
        No truncation needed. (kafka.server.ReplicaFetcherThread)
    >   [2018-12-23 15:05:23,300] INFO [Log partition=ztf_20181205_programid1-0, dir=/data2-01] Truncating to 10622 has no effect as the largest offset in the log is 10621 (kafka.log.Log)
    >   [2018-12-23 15:05:23,300] INFO [ReplicaFetcher replicaId=4, leaderId=3, fetcherId=0] Based on follower's leader epoch, leader replied with an offset 14906 >= the follower's log end offset 14906 in ztf_20181214_programid1-10.
        No truncation needed. (kafka.server.ReplicaFetcherThread)
    >   [2018-12-23 15:05:23,300] INFO [Log partition=ztf_20181214_programid1-10, dir=/data1-01] Truncating to 14906 has no effect as the largest offset in the log is 14905 (kafka.log.Log)
    >   [2018-12-23 15:05:23,300] INFO [ReplicaFetcher replicaId=4, leaderId=3, fetcherId=0] Based on follower's leader epoch, leader replied with an offset 15722 >= the follower's log end offset 15722 in ztf_20181217_programid1-0.
        No truncation needed. (kafka.server.ReplicaFetcherThread)
    >   [2018-12-23 15:05:23,300] INFO [Log partition=ztf_20181217_programid1-0, dir=/data2-01] Truncating to 15722 has no effect as the largest offset in the log is 15721 (kafka.log.Log)
    >   [2018-12-23 15:05:23,300] INFO [ReplicaFetcher replicaId=4, leaderId=3, fetcherId=0] Based on follower's leader epoch, leader replied with an offset 8649 >= the follower's log end offset 8649 in ztf_20181216_programid1-11.
        No truncation needed. (kafka.server.ReplicaFetcherThread)
    >   [2018-12-23 15:05:23,300] INFO [Log partition=ztf_20181216_programid1-11, dir=/data2-01] Truncating to 8649 has no effect as the largest offset in the log is 8648 (kafka.log.Log)


    >   [2018-12-23 14:22:01,917] INFO [ProducerStateManager partition=ztf_20181205_programid1-15] Writing producer snapshot at offset 10622 (kafka.log.ProducerStateManager)
    >   [2018-12-23 14:22:01,920] INFO [Log partition=ztf_20181205_programid1-15, dir=/data1-01] Loading producer state from offset 10622 with message format version 2 (kafka.log.Log)
    >   [2018-12-23 14:22:01,921] INFO [ProducerStateManager partition=ztf_20181205_programid1-15] Loading producer state from snapshot file
        '/data1-01/ztf_20181205_programid1-15/00000000000000010622.snapshot' (kafka.log.ProducerStateManager)
    >   [2018-12-23 14:22:01,921] INFO [Log partition=ztf_20181205_programid1-15, dir=/data1-01] Completed load of log with 1 segments, log start offset 0 and log end offset 10622 in 47748 ms (kafka.log.Log)
    >   [2018-12-23 14:22:01,930] WARN [Log partition=ztf_20181205_programid1-7, dir=/data1-01] Found a corrupted index file corresponding to log file
        /data1-01/ztf_20181205_programid1-7/00000000000000000000.log due to Corrupt index found, index file (/data1-01/ztf_20181205_programid1-7/00000000000000000000.index)
        has non-zero size but the last offset is 0 which is no greater than the base offset 0.}, recovering segment and rebuilding index files... (kafka.log.Log)
    >   ....
    >   ....
    >   [2018-12-23 15:10:23,031] DEBUG [Controller id=2] Topics not in preferred replica for broker 2 Map() (kafka.controller.KafkaController)
    >   [2018-12-23 15:10:23,031] TRACE [Controller id=2] Leader imbalance ratio for broker 2 is 0.0 (kafka.controller.KafkaController)
    >   [2018-12-23 15:10:23,031] DEBUG [Controller id=2] Topics not in preferred replica for broker 4 Map() (kafka.controller.KafkaController)
    >   [2018-12-23 15:10:23,031] TRACE [Controller id=2] Leader imbalance ratio for broker 4 is 0.0 (kafka.controller.KafkaController)
    >   [2018-12-23 15:10:23,031] DEBUG [Controller id=2] Topics not in preferred replica for broker 1 Map() (kafka.controller.KafkaController)
    >   [2018-12-23 15:10:23,031] TRACE [Controller id=2] Leader imbalance ratio for broker 1 is 0.0 (kafka.controller.KafkaController)
    >   [2018-12-23 15:10:23,032] DEBUG [Controller id=2] Topics not in preferred replica for broker 3 Map() (kafka.controller.KafkaController)
    >   [2018-12-23 15:10:23,032] TRACE [Controller id=2] Leader imbalance ratio for broker 3 is 0.0 (kafka.controller.KafkaController)


    >   [2018-12-23 14:22:46,026] INFO [ProducerStateManager partition=ztf_20181205_programid1-10] Writing producer snapshot at offset 10622 (kafka.log.ProducerStateManager)
    >   [2018-12-23 14:22:46,028] INFO [Log partition=ztf_20181205_programid1-10, dir=/data2-01] Loading producer state from offset 10622 with message format version 2 (kafka.log.Log)
    >   [2018-12-23 14:22:46,030] INFO [ProducerStateManager partition=ztf_20181205_programid1-10] Loading producer state from snapshot file
        '/data2-01/ztf_20181205_programid1-10/00000000000000010622.snapshot' (kafka.log.ProducerStateManager)
    >   [2018-12-23 14:22:46,030] INFO [Log partition=ztf_20181205_programid1-10, dir=/data2-01] Completed load of log with 1 segments, log start offset 0 and log end offset 10622 in 48428 ms (kafka.log.Log)
    >   [2018-12-23 14:22:46,146] WARN [Log partition=ztf_20181205_programid1-11, dir=/data2-01] Found a corrupted index file corresponding to log file /data2-01/ztf_20181205_programid1-11/00000000000000000000.log
        due to Corrupt index found, index file (/data2-01/ztf_20181205_programid1-11/00000000000000000000.index) has non-zero size but the last offset is 0 which is no greater than the base offset 0.},
        recovering segment and rebuilding index files... (kafka.log.Log)
    >   ....
    >   ....
    >   [2018-12-23 15:05:23,298] INFO [ReplicaFetcher replicaId=1, leaderId=3, fetcherId=0] Based on follower's leader epoch, leader replied with an offset 6744 >= the follower's log end offset 6744 in ztf_20181210_programid1-6.
        No truncation needed. (kafka.server.ReplicaFetcherThread)
    >   [2018-12-23 15:05:23,299] INFO [Log partition=ztf_20181210_programid1-6, dir=/data2-01] Truncating to 6744 has no effect as the largest offset in the log is 6743 (kafka.log.Log)
    >   [2018-12-23 15:05:23,299] INFO [ReplicaFetcher replicaId=1, leaderId=3, fetcherId=0] Based on follower's leader epoch, leader replied with an offset 15722 >= the follower's log end offset 15722 in ztf_20181217_programid1-0.
        No truncation needed. (kafka.server.ReplicaFetcherThread)
    >   [2018-12-23 15:05:23,300] INFO [Log partition=ztf_20181217_programid1-0, dir=/data1-01] Truncating to 15722 has no effect as the largest offset in the log is 15721 (kafka.log.Log)
    >   [2018-12-23 15:05:23,300] INFO [ReplicaFetcher replicaId=1, leaderId=3, fetcherId=0] Based on follower's leader epoch, leader replied with an offset 642 >= the follower's log end offset 642 in ztf_20181215_programid1-7.
        No truncation needed. (kafka.server.ReplicaFetcherThread)
    >   [2018-12-23 15:05:23,300] INFO [Log partition=ztf_20181215_programid1-7, dir=/data1-01] Truncating to 642 has no effect as the largest offset in the log is 641 (kafka.log.Log)


# -----------------------------------------------------
# Check the available topics in our Kafka system.
# https://docs.confluent.io/current/app-development/kafkacat-usage.html
# https://github.com/edenhill/kafkacat
#[user@trop03]

    devnode=Rusaldez

    ztfconnect=public.alerts.ztf.uw.edu:9092

    roetemp=${kfnames[*]}
    roeconnect=${roetemp// /:9092,}:9092
    roegroupid=ztf-mirror.roe.ac.uk

    ssh \
        ${sshopts[*]} \
        ${sshuser:?}@${devnode:?} \
        "
        docker run \
            --rm \
            phymatopus/kafkacat:latest \
                -b "${roeconnect:?}" \
                -L \
                -J \
        | jq -r '.topics[] | select(.topic | startswith(\"__\") | not)  | .topic' \
        | sort
        " \
    | tee /tmp/topiclist


    >   ztf_20181205_programid1
    >   ztf_20181209_programid1
    >   ztf_20181210_programid1
    >   ztf_20181212_programid1
    >   ztf_20181213_programid1
    >   ztf_20181214_programid1
    >   ztf_20181215_programid1
    >   ztf_20181216_programid1
    >   ztf_20181217_programid1


# -----------------------------------------------------
# Check the topics offsets in our Kafka system.
#[user@trop03]

    brokers=${roeconnect:?}

    for topicid in $(cat /tmp/topiclist)
    do
        echo "--------------------"
        echo "Topic [${topicid:?}]"

        ssh \
            ${sshopts[*]} \
            ${sshuser:?}@${devnode:?} \
            "
            docker run --rm phymatopus/kafka-core \
                bin/kafka-run-class.sh kafka.tools.GetOffsetShell \
                    --broker-list "${brokers:?}" \
                    --topic "${topicid:?}" \
                    --time -1
            docker run --rm phymatopus/kafka-core \
                bin/kafka-run-class.sh kafka.tools.GetOffsetShell \
                    --broker-list "${brokers:?}" \
                    --topic "${topicid:?}" \
                    --time -2
            " \
        | sort

    done


    >   --------------------
    >   Topic [ztf_20181205_programid1]
    >   ztf_20181205_programid1:0:0
    >   ztf_20181205_programid1:0:10622
    >   ztf_20181205_programid1:1:0
    >   ztf_20181205_programid1:10:0
    >   ztf_20181205_programid1:10:10622
    >   ztf_20181205_programid1:11:0
    >   ztf_20181205_programid1:1:10623
    >   ztf_20181205_programid1:11:10622
    >   ztf_20181205_programid1:12:0
    >   ztf_20181205_programid1:12:10622
    >   ztf_20181205_programid1:13:0
    >   ztf_20181205_programid1:13:10622
    >   ztf_20181205_programid1:14:0
    >   ztf_20181205_programid1:14:10622
    >   ztf_20181205_programid1:15:0
    >   ztf_20181205_programid1:15:10622
    >   ztf_20181205_programid1:2:0
    >   ztf_20181205_programid1:2:10622
    >   ztf_20181205_programid1:3:0
    >   ztf_20181205_programid1:3:10622
    >   ztf_20181205_programid1:4:0
    >   ztf_20181205_programid1:4:10622
    >   ztf_20181205_programid1:5:0
    >   ztf_20181205_programid1:5:10622
    >   ztf_20181205_programid1:6:0
    >   ztf_20181205_programid1:6:10622
    >   ztf_20181205_programid1:7:0
    >   ztf_20181205_programid1:7:10622
    >   ztf_20181205_programid1:8:0
    >   ztf_20181205_programid1:8:10622
    >   ztf_20181205_programid1:9:0
    >   ztf_20181205_programid1:9:10622
    >   --------------------
    >   Topic [ztf_20181209_programid1]
    >   ztf_20181209_programid1:0:0
    >   ztf_20181209_programid1:0:4206
    >   ztf_20181209_programid1:1:0
    >   ztf_20181209_programid1:10:0
    >   ztf_20181209_programid1:10:4205
    >   ztf_20181209_programid1:11:0
    >   ztf_20181209_programid1:11:4206
    >   ztf_20181209_programid1:12:0
    >   ztf_20181209_programid1:12:4206
    >   ztf_20181209_programid1:13:0
    >   ztf_20181209_programid1:13:4205
    >   ztf_20181209_programid1:14:0
    >   ztf_20181209_programid1:1:4206
    >   ztf_20181209_programid1:14:4205
    >   ztf_20181209_programid1:15:0
    >   ztf_20181209_programid1:15:4206
    >   ztf_20181209_programid1:2:0
    >   ztf_20181209_programid1:2:4206
    >   ztf_20181209_programid1:3:0
    >   ztf_20181209_programid1:3:4206
    >   ztf_20181209_programid1:4:0
    >   ztf_20181209_programid1:4:4205
    >   ztf_20181209_programid1:5:0
    >   ztf_20181209_programid1:5:4205
    >   ztf_20181209_programid1:6:0
    >   ztf_20181209_programid1:6:4206
    >   ztf_20181209_programid1:7:0
    >   ztf_20181209_programid1:7:4205
    >   ztf_20181209_programid1:8:0
    >   ztf_20181209_programid1:8:4206
    >   ztf_20181209_programid1:9:0
    >   ztf_20181209_programid1:9:4205
    >   --------------------
    >   Topic [ztf_20181210_programid1]
    >   ztf_20181210_programid1:0:0
    >   ztf_20181210_programid1:0:6744
    >   ztf_20181210_programid1:1:0
    >   ztf_20181210_programid1:10:0
    >   ztf_20181210_programid1:10:6744
    >   ztf_20181210_programid1:11:0
    >   ztf_20181210_programid1:11:6744
    >   ztf_20181210_programid1:12:0
    >   ztf_20181210_programid1:12:6744
    >   ztf_20181210_programid1:13:0
    >   ztf_20181210_programid1:13:6744
    >   ztf_20181210_programid1:14:0
    >   ztf_20181210_programid1:14:6742
    >   ztf_20181210_programid1:15:0
    >   ztf_20181210_programid1:15:6744
    >   ztf_20181210_programid1:1:6744
    >   ztf_20181210_programid1:2:0
    >   ztf_20181210_programid1:2:6743
    >   ztf_20181210_programid1:3:0
    >   ztf_20181210_programid1:3:6744
    >   ztf_20181210_programid1:4:0
    >   ztf_20181210_programid1:4:6744
    >   ztf_20181210_programid1:5:0
    >   ztf_20181210_programid1:5:6742
    >   ztf_20181210_programid1:6:0
    >   ztf_20181210_programid1:6:6744
    >   ztf_20181210_programid1:7:0
    >   ztf_20181210_programid1:7:6744
    >   ztf_20181210_programid1:8:0
    >   ztf_20181210_programid1:8:6744
    >   ztf_20181210_programid1:9:0
    >   ztf_20181210_programid1:9:6744
    >   --------------------
    >   Topic [ztf_20181212_programid1]
    >   ztf_20181212_programid1:0:0
    >   ztf_20181212_programid1:0:9896
    >   ztf_20181212_programid1:1:0
    >   ztf_20181212_programid1:10:0
    >   ztf_20181212_programid1:10:9896
    >   ztf_20181212_programid1:11:0
    >   ztf_20181212_programid1:11:9896
    >   ztf_20181212_programid1:12:0
    >   ztf_20181212_programid1:12:9896
    >   ztf_20181212_programid1:13:0
    >   ztf_20181212_programid1:13:9897
    >   ztf_20181212_programid1:14:0
    >   ztf_20181212_programid1:14:9896
    >   ztf_20181212_programid1:15:0
    >   ztf_20181212_programid1:15:9896
    >   ztf_20181212_programid1:1:9896
    >   ztf_20181212_programid1:2:0
    >   ztf_20181212_programid1:2:9897
    >   ztf_20181212_programid1:3:0
    >   ztf_20181212_programid1:3:9896
    >   ztf_20181212_programid1:4:0
    >   ztf_20181212_programid1:4:9897
    >   ztf_20181212_programid1:5:0
    >   ztf_20181212_programid1:5:9897
    >   ztf_20181212_programid1:6:0
    >   ztf_20181212_programid1:6:9896
    >   ztf_20181212_programid1:7:0
    >   ztf_20181212_programid1:7:9897
    >   ztf_20181212_programid1:8:0
    >   ztf_20181212_programid1:8:9896
    >   ztf_20181212_programid1:9:0
    >   ztf_20181212_programid1:9:9896
    >   --------------------
    >   Topic [ztf_20181213_programid1]
    >   ztf_20181213_programid1:0:0
    >   ztf_20181213_programid1:0:7572
    >   ztf_20181213_programid1:1:0
    >   ztf_20181213_programid1:10:0
    >   ztf_20181213_programid1:10:7574
    >   ztf_20181213_programid1:11:0
    >   ztf_20181213_programid1:11:7572
    >   ztf_20181213_programid1:12:0
    >   ztf_20181213_programid1:12:7572
    >   ztf_20181213_programid1:13:0
    >   ztf_20181213_programid1:13:7574
    >   ztf_20181213_programid1:14:0
    >   ztf_20181213_programid1:14:7574
    >   ztf_20181213_programid1:15:0
    >   ztf_20181213_programid1:15:7572
    >   ztf_20181213_programid1:1:7574
    >   ztf_20181213_programid1:2:0
    >   ztf_20181213_programid1:2:7572
    >   ztf_20181213_programid1:3:0
    >   ztf_20181213_programid1:3:7573
    >   ztf_20181213_programid1:4:0
    >   ztf_20181213_programid1:4:7574
    >   ztf_20181213_programid1:5:0
    >   ztf_20181213_programid1:5:7574
    >   ztf_20181213_programid1:6:0
    >   ztf_20181213_programid1:6:7572
    >   ztf_20181213_programid1:7:0
    >   ztf_20181213_programid1:7:7574
    >   ztf_20181213_programid1:8:0
    >   ztf_20181213_programid1:8:7572
    >   ztf_20181213_programid1:9:0
    >   ztf_20181213_programid1:9:7574
    >   --------------------
    >   Topic [ztf_20181214_programid1]
    >   ztf_20181214_programid1:0:0
    >   ztf_20181214_programid1:0:14906
    >   ztf_20181214_programid1:1:0
    >   ztf_20181214_programid1:10:0
    >   ztf_20181214_programid1:10:14906
    >   ztf_20181214_programid1:11:0
    >   ztf_20181214_programid1:11:14905
    >   ztf_20181214_programid1:1:14906
    >   ztf_20181214_programid1:12:0
    >   ztf_20181214_programid1:12:14906
    >   ztf_20181214_programid1:13:0
    >   ztf_20181214_programid1:13:14905
    >   ztf_20181214_programid1:14:0
    >   ztf_20181214_programid1:14:14905
    >   ztf_20181214_programid1:15:0
    >   ztf_20181214_programid1:15:14906
    >   ztf_20181214_programid1:2:0
    >   ztf_20181214_programid1:2:14905
    >   ztf_20181214_programid1:3:0
    >   ztf_20181214_programid1:3:14906
    >   ztf_20181214_programid1:4:0
    >   ztf_20181214_programid1:4:14906
    >   ztf_20181214_programid1:5:0
    >   ztf_20181214_programid1:5:14904
    >   ztf_20181214_programid1:6:0
    >   ztf_20181214_programid1:6:14906
    >   ztf_20181214_programid1:7:0
    >   ztf_20181214_programid1:7:14906
    >   ztf_20181214_programid1:8:0
    >   ztf_20181214_programid1:8:14906
    >   ztf_20181214_programid1:9:0
    >   ztf_20181214_programid1:9:14906
    >   --------------------
    >   Topic [ztf_20181215_programid1]
    >   ztf_20181215_programid1:0:0
    >   ztf_20181215_programid1:0:641
    >   ztf_20181215_programid1:1:0
    >   ztf_20181215_programid1:10:0
    >   ztf_20181215_programid1:10:642
    >   ztf_20181215_programid1:11:0
    >   ztf_20181215_programid1:11:640
    >   ztf_20181215_programid1:12:0
    >   ztf_20181215_programid1:12:642
    >   ztf_20181215_programid1:13:0
    >   ztf_20181215_programid1:13:642
    >   ztf_20181215_programid1:14:0
    >   ztf_20181215_programid1:14:641
    >   ztf_20181215_programid1:15:0
    >   ztf_20181215_programid1:15:642
    >   ztf_20181215_programid1:1:642
    >   ztf_20181215_programid1:2:0
    >   ztf_20181215_programid1:2:640
    >   ztf_20181215_programid1:3:0
    >   ztf_20181215_programid1:3:642
    >   ztf_20181215_programid1:4:0
    >   ztf_20181215_programid1:4:642
    >   ztf_20181215_programid1:5:0
    >   ztf_20181215_programid1:5:640
    >   ztf_20181215_programid1:6:0
    >   ztf_20181215_programid1:6:641
    >   ztf_20181215_programid1:7:0
    >   ztf_20181215_programid1:7:642
    >   ztf_20181215_programid1:8:0
    >   ztf_20181215_programid1:8:640
    >   ztf_20181215_programid1:9:0
    >   ztf_20181215_programid1:9:642
    >   --------------------
    >   Topic [ztf_20181216_programid1]
    >   ztf_20181216_programid1:0:0
    >   ztf_20181216_programid1:0:8650
    >   ztf_20181216_programid1:1:0
    >   ztf_20181216_programid1:10:0
    >   ztf_20181216_programid1:10:8650
    >   ztf_20181216_programid1:11:0
    >   ztf_20181216_programid1:11:8649
    >   ztf_20181216_programid1:12:0
    >   ztf_20181216_programid1:12:8650
    >   ztf_20181216_programid1:13:0
    >   ztf_20181216_programid1:13:8650
    >   ztf_20181216_programid1:14:0
    >   ztf_20181216_programid1:14:8650
    >   ztf_20181216_programid1:15:0
    >   ztf_20181216_programid1:15:8649
    >   ztf_20181216_programid1:1:8650
    >   ztf_20181216_programid1:2:0
    >   ztf_20181216_programid1:2:8649
    >   ztf_20181216_programid1:3:0
    >   ztf_20181216_programid1:3:8650
    >   ztf_20181216_programid1:4:0
    >   ztf_20181216_programid1:4:8650
    >   ztf_20181216_programid1:5:0
    >   ztf_20181216_programid1:5:8650
    >   ztf_20181216_programid1:6:0
    >   ztf_20181216_programid1:6:8650
    >   ztf_20181216_programid1:7:0
    >   ztf_20181216_programid1:7:8650
    >   ztf_20181216_programid1:8:0
    >   ztf_20181216_programid1:8:8649
    >   ztf_20181216_programid1:9:0
    >   ztf_20181216_programid1:9:8650
    >   --------------------
    >   Topic [ztf_20181217_programid1]
    >   ztf_20181217_programid1:0:0
    >   ztf_20181217_programid1:0:15722
    >   ztf_20181217_programid1:1:0
    >   ztf_20181217_programid1:10:0
    >   ztf_20181217_programid1:10:15723
    >   ztf_20181217_programid1:11:0
    >   ztf_20181217_programid1:11:15736
    >   ztf_20181217_programid1:1:15727
    >   ztf_20181217_programid1:12:0
    >   ztf_20181217_programid1:12:15722
    >   ztf_20181217_programid1:13:0
    >   ztf_20181217_programid1:13:15725
    >   ztf_20181217_programid1:14:0
    >   ztf_20181217_programid1:14:15721
    >   ztf_20181217_programid1:15:0
    >   ztf_20181217_programid1:15:15740
    >   ztf_20181217_programid1:2:0
    >   ztf_20181217_programid1:2:15723
    >   ztf_20181217_programid1:3:0
    >   ztf_20181217_programid1:3:15736
    >   ztf_20181217_programid1:4:0
    >   ztf_20181217_programid1:4:15722
    >   ztf_20181217_programid1:5:0
    >   ztf_20181217_programid1:5:15724
    >   ztf_20181217_programid1:6:0
    >   ztf_20181217_programid1:6:15725
    >   ztf_20181217_programid1:7:0
    >   ztf_20181217_programid1:7:15739
    >   ztf_20181217_programid1:8:0
    >   ztf_20181217_programid1:8:15719
    >   ztf_20181217_programid1:9:0
    >   ztf_20181217_programid1:9:15726


# -----------------------------------------------------
# Update the topic and restart MirrorMaker on each node.
#[user@trop03]

    ztftopicid=ztf_20181218_programid1
    ztftopicid=ztf_20181219_programid1

    for vmname in ${mmnames[@]}
        do
            echo "---- ----"
            echo "vmname [${vmname:?}]"
            ssh \
                ${scpopts[*]} \
                ${sshuser:?}@${vmname:?} \
                "
                docker-compose \
                    --file mirror.yml \
                    down
                sed -i \"
                    s/^ztftopicid=.*/ztftopicid=${ztftopicid:?}/
                    \" mirror.env
                docker-compose \
                    --file mirror.yml \
                    up -d
                "
        done


    >   ---- ----
    >   vmname [Afoaviel]
    >   Stopping stevedore_tina_1 ... done
    >   Removing stevedore_tina_1 ... done
    >   Removing network stevedore_default
    >   Creating network "stevedore_default" with the default driver
    >   Creating stevedore_tina_1 ... done
    >   ---- ----
    >   vmname [Rusaldez]
    >   Stopping stevedore_tina_1 ... done
    >   Removing stevedore_tina_1 ... done
    >   Removing network stevedore_default
    >   Creating network "stevedore_default" with the default driver
    >   Creating stevedore_tina_1 ... done


    for vmname in ${mmnames[@]}
        do
            echo "---- ----"
            echo "vmname [${vmname:?}]"
            ssh \
                ${scpopts[*]} \
                ${sshuser:?}@${vmname:?} \
                "
                docker ps
                "
        done


    >   ---- ----
    >   vmname [Afoaviel]
    >   CONTAINER ID        IMAGE                   COMMAND                  CREATED             STATUS              PORTS               NAMES
    >   31ec7e03f2fa        phymatopus/kafka-core   "bin/kafka-mirror-ma…"   40 seconds ago      Up 39 seconds                           stevedore_tina_1
    >   ---- ----
    >   vmname [Rusaldez]
    >   CONTAINER ID        IMAGE                   COMMAND                  CREATED             STATUS              PORTS               NAMES
    >   222d07e87ee0        phymatopus/kafka-core   "bin/kafka-mirror-ma…"   36 seconds ago      Up 35 seconds                           stevedore_tina_1


# -----------------------------------------------------
# Check our client offsets in the ZTF broker.
#[user@trop03]

    devnode=Rusaldez

    ztfconnect=public.alerts.ztf.uw.edu:9092
    roegroupid=ztf-mirror.roe.ac.uk

    date ; \
    ssh \
        ${sshopts[*]} \
        ${sshuser:?}@${devnode:?} \
        "
        docker run --rm phymatopus/kafka-core \
            bin/kafka-consumer-groups.sh \
                --bootstrap-server "${ztfconnect:?}" \
                --describe \
                --group "${roegroupid:?}"
         " \
    | sort \
    ; date


    >   Sun 23 Dec 16:24:36 GMT 2018
    >   Note: This will not show information about old Zookeeper-based consumers.
    >   Sun 23 Dec 16:24:42 GMT 2018


    >   Sun 23 Dec 16:37:14 GMT 2018
    >   TOPIC                   PARTITION  CURRENT-OFFSET  LOG-END-OFFSET  LAG             CONSUMER-ID                                                 HOST            CLIENT-ID
    >   ztf_20181219_programid1 0          1573            20858           19285           ztf-mirror.roe.ac.uk-0-2f8ec00b-e895-4e1b-932d-4d6efcd9e7bd /129.215.175.98 ztf-mirror.roe.ac.uk-0
    >   ztf_20181219_programid1 10         1577            20859           19282           ztf-mirror.roe.ac.uk-1-4a0c5dcb-7c72-4d5c-8f01-5ab7aeef4209 /129.215.175.98 ztf-mirror.roe.ac.uk-1
    >   ztf_20181219_programid1 11         1527            20858           19331           ztf-mirror.roe.ac.uk-1-d2737872-883a-44ce-8c86-82ce4930214f /129.215.175.98 ztf-mirror.roe.ac.uk-1
    >   ztf_20181219_programid1 1          1784            20859           19075           ztf-mirror.roe.ac.uk-0-9a40a633-d756-4a78-8e38-5a33ef6b92c6 /129.215.175.98 ztf-mirror.roe.ac.uk-0
    >   ztf_20181219_programid1 12         1567            20858           19291           ztf-mirror.roe.ac.uk-2-42f68bd4-59d8-4e64-945e-402152189b06 /129.215.175.98 ztf-mirror.roe.ac.uk-2
    >   ztf_20181219_programid1 13         1525            20859           19334           ztf-mirror.roe.ac.uk-2-58361761-429d-4560-9abb-6283385965da /129.215.175.98 ztf-mirror.roe.ac.uk-2
    >   ztf_20181219_programid1 2          1570            20858           19288           ztf-mirror.roe.ac.uk-1-4a0c5dcb-7c72-4d5c-8f01-5ab7aeef4209 /129.215.175.98 ztf-mirror.roe.ac.uk-1
    >   ztf_20181219_programid1 3          1529            20859           19330           ztf-mirror.roe.ac.uk-1-d2737872-883a-44ce-8c86-82ce4930214f /129.215.175.98 ztf-mirror.roe.ac.uk-1
    >   ztf_20181219_programid1 4          1573            20859           19286           ztf-mirror.roe.ac.uk-2-42f68bd4-59d8-4e64-945e-402152189b06 /129.215.175.98 ztf-mirror.roe.ac.uk-2
    >   ztf_20181219_programid1 5          1526            20858           19332           ztf-mirror.roe.ac.uk-2-58361761-429d-4560-9abb-6283385965da /129.215.175.98 ztf-mirror.roe.ac.uk-2
    >   ztf_20181219_programid1 6          2987            20858           17871           ztf-mirror.roe.ac.uk-3-5a92f773-6412-4dce-9d33-b1d965d43147 /129.215.175.98 ztf-mirror.roe.ac.uk-3
    >   ztf_20181219_programid1 7          3076            20859           17783           ztf-mirror.roe.ac.uk-3-a15876c9-eb15-494e-83d6-648e0eea7730 /129.215.175.98 ztf-mirror.roe.ac.uk-3
    >   ztf_20181219_programid1 8          1571            20858           19287           ztf-mirror.roe.ac.uk-0-2f8ec00b-e895-4e1b-932d-4d6efcd9e7bd /129.215.175.98 ztf-mirror.roe.ac.uk-0
    >   ztf_20181219_programid1 9          1781            20859           19078           ztf-mirror.roe.ac.uk-0-9a40a633-d756-4a78-8e38-5a33ef6b92c6 /129.215.175.98 ztf-mirror.roe.ac.uk-0
    >   Sun 23 Dec 16:37:22 GMT 2018


    >   Sun 23 Dec 16:45:40 GMT 2018
    >   TOPIC                   PARTITION  CURRENT-OFFSET  LOG-END-OFFSET  LAG             CONSUMER-ID                                                 HOST            CLIENT-ID
    >   ztf_20181219_programid1 0          4011            20858           16847           ztf-mirror.roe.ac.uk-0-2f8ec00b-e895-4e1b-932d-4d6efcd9e7bd /129.215.175.98 ztf-mirror.roe.ac.uk-0
    >   ztf_20181219_programid1 10         4006            20859           16853           ztf-mirror.roe.ac.uk-1-4a0c5dcb-7c72-4d5c-8f01-5ab7aeef4209 /129.215.175.98 ztf-mirror.roe.ac.uk-1
    >   ztf_20181219_programid1 11         3963            20858           16895           ztf-mirror.roe.ac.uk-1-d2737872-883a-44ce-8c86-82ce4930214f /129.215.175.98 ztf-mirror.roe.ac.uk-1
    >   ztf_20181219_programid1 12         3996            20858           16862           ztf-mirror.roe.ac.uk-2-42f68bd4-59d8-4e64-945e-402152189b06 /129.215.175.98 ztf-mirror.roe.ac.uk-2
    >   ztf_20181219_programid1 13         3976            20859           16883           ztf-mirror.roe.ac.uk-2-58361761-429d-4560-9abb-6283385965da /129.215.175.98 ztf-mirror.roe.ac.uk-2
    >   ztf_20181219_programid1 1          3959            20859           16900           ztf-mirror.roe.ac.uk-0-9a40a633-d756-4a78-8e38-5a33ef6b92c6 /129.215.175.98 ztf-mirror.roe.ac.uk-0
    >   ztf_20181219_programid1 2          4001            20858           16857           ztf-mirror.roe.ac.uk-1-4a0c5dcb-7c72-4d5c-8f01-5ab7aeef4209 /129.215.175.98 ztf-mirror.roe.ac.uk-1
    >   ztf_20181219_programid1 3          3961            20859           16898           ztf-mirror.roe.ac.uk-1-d2737872-883a-44ce-8c86-82ce4930214f /129.215.175.98 ztf-mirror.roe.ac.uk-1
    >   ztf_20181219_programid1 4          4003            20859           16856           ztf-mirror.roe.ac.uk-2-42f68bd4-59d8-4e64-945e-402152189b06 /129.215.175.98 ztf-mirror.roe.ac.uk-2
    >   ztf_20181219_programid1 5          3973            20858           16885           ztf-mirror.roe.ac.uk-2-58361761-429d-4560-9abb-6283385965da /129.215.175.98 ztf-mirror.roe.ac.uk-2
    >   ztf_20181219_programid1 6          7685            20858           13173           ztf-mirror.roe.ac.uk-3-5a92f773-6412-4dce-9d33-b1d965d43147 /129.215.175.98 ztf-mirror.roe.ac.uk-3
    >   ztf_20181219_programid1 7          7769            20859           13090           ztf-mirror.roe.ac.uk-3-a15876c9-eb15-494e-83d6-648e0eea7730 /129.215.175.98 ztf-mirror.roe.ac.uk-3
    >   ztf_20181219_programid1 8          4001            20858           16857           ztf-mirror.roe.ac.uk-0-2f8ec00b-e895-4e1b-932d-4d6efcd9e7bd /129.215.175.98 ztf-mirror.roe.ac.uk-0
    >   ztf_20181219_programid1 9          3953            20859           16906           ztf-mirror.roe.ac.uk-0-9a40a633-d756-4a78-8e38-5a33ef6b92c6 /129.215.175.98 ztf-mirror.roe.ac.uk-0
    >   Sun 23 Dec 16:45:48 GMT 2018


# -----------------------------------------------------
# Check the disc use on each Kafka node.
#[user@trop03]

    for vmname in ${kfnames[@]}
        do
            ssh \
                ${sshopts[*]} \
                ${sshuser:?}@${vmname:?} \
                    "
                    echo \"---- ---- ---- ----\"
                    echo \"[\$(hostname)][\$(date)]\"

                    echo \"---- ----\"
                    du -h \"/data1-01\"
                    echo \"---- ----\"
                    du -h \"/data1-02\"

                    echo "---- ----"
                    du -h \"/data2-01\"
                    echo "---- ----"
                    du -h \"/data2-02\"
                    "
        done

#
# Not using the new partitions yet ...


    >   ---- ---- ---- ----
    >   [Stedigo][Sun 23 Dec 16:47:59 GMT 2018]
    >   ---- ----
    >   0	/data1-01/__confluent.support.metrics-0
    >   715M	/data1-01/ztf_20181205_programid1-6
    >   716M	/data1-01/ztf_20181205_programid1-14
    >   715M	/data1-01/ztf_20181205_programid1-12
    >   716M	/data1-01/ztf_20181205_programid1-0
    >   715M	/data1-01/ztf_20181205_programid1-4
    >   716M	/data1-01/ztf_20181205_programid1-1
    >   269M	/data1-01/ztf_20181209_programid1-7
    >   269M	/data1-01/ztf_20181209_programid1-15
    >   269M	/data1-01/ztf_20181209_programid1-14
    >   269M	/data1-01/ztf_20181209_programid1-5
    >   269M	/data1-01/ztf_20181209_programid1-12
    >   269M	/data1-01/ztf_20181209_programid1-6
    >   437M	/data1-01/ztf_20181210_programid1-0
    >   437M	/data1-01/ztf_20181210_programid1-8
    >   437M	/data1-01/ztf_20181210_programid1-9
    >   437M	/data1-01/ztf_20181210_programid1-3
    >   436M	/data1-01/ztf_20181210_programid1-5
    >   437M	/data1-01/ztf_20181210_programid1-2
    >   646M	/data1-01/ztf_20181212_programid1-2
    >   646M	/data1-01/ztf_20181212_programid1-10
    >   647M	/data1-01/ztf_20181212_programid1-12
    >   646M	/data1-01/ztf_20181212_programid1-9
    >   646M	/data1-01/ztf_20181212_programid1-7
    >   646M	/data1-01/ztf_20181212_programid1-1
    >   497M	/data1-01/ztf_20181213_programid1-10
    >   497M	/data1-01/ztf_20181213_programid1-2
    >   497M	/data1-01/ztf_20181213_programid1-9
    >   496M	/data1-01/ztf_20181213_programid1-4
    >   496M	/data1-01/ztf_20181213_programid1-1
    >   496M	/data1-01/ztf_20181213_programid1-11
    >   957M	/data1-01/ztf_20181214_programid1-8
    >   957M	/data1-01/ztf_20181214_programid1-0
    >   957M	/data1-01/ztf_20181214_programid1-5
    >   958M	/data1-01/ztf_20181214_programid1-2
    >   957M	/data1-01/ztf_20181214_programid1-9
    >   957M	/data1-01/ztf_20181214_programid1-3
    >   42M	/data1-01/ztf_20181215_programid1-9
    >   42M	/data1-01/ztf_20181215_programid1-1
    >   42M	/data1-01/ztf_20181215_programid1-15
    >   42M	/data1-01/ztf_20181215_programid1-6
    >   42M	/data1-01/ztf_20181215_programid1-0
    >   42M	/data1-01/ztf_20181215_programid1-7
    >   561M	/data1-01/ztf_20181216_programid1-1
    >   560M	/data1-01/ztf_20181216_programid1-9
    >   560M	/data1-01/ztf_20181216_programid1-3
    >   561M	/data1-01/ztf_20181216_programid1-7
    >   560M	/data1-01/ztf_20181216_programid1-15
    >   560M	/data1-01/ztf_20181216_programid1-0
    >   992M	/data1-01/ztf_20181217_programid1-2
    >   991M	/data1-01/ztf_20181217_programid1-10
    >   992M	/data1-01/ztf_20181217_programid1-12
    >   991M	/data1-01/ztf_20181217_programid1-0
    >   991M	/data1-01/ztf_20181217_programid1-13
    >   993M	/data1-01/ztf_20181217_programid1-7
    >   30G	/data1-01
    >   ---- ----
    >   16K	/data1-02
    >   ---- ----
    >   716M	/data2-01/ztf_20181205_programid1-2
    >   716M	/data2-01/ztf_20181205_programid1-10
    >   715M	/data2-01/ztf_20181205_programid1-11
    >   716M	/data2-01/ztf_20181205_programid1-9
    >   716M	/data2-01/ztf_20181205_programid1-7
    >   715M	/data2-01/ztf_20181205_programid1-13
    >   269M	/data2-01/ztf_20181209_programid1-3
    >   269M	/data2-01/ztf_20181209_programid1-11
    >   269M	/data2-01/ztf_20181209_programid1-0
    >   269M	/data2-01/ztf_20181209_programid1-8
    >   269M	/data2-01/ztf_20181209_programid1-2
    >   269M	/data2-01/ztf_20181209_programid1-9
    >   436M	/data2-01/ztf_20181210_programid1-12
    >   436M	/data2-01/ztf_20181210_programid1-4
    >   437M	/data2-01/ztf_20181210_programid1-15
    >   437M	/data2-01/ztf_20181210_programid1-6
    >   436M	/data2-01/ztf_20181210_programid1-14
    >   437M	/data2-01/ztf_20181210_programid1-11
    >   647M	/data2-01/ztf_20181212_programid1-14
    >   647M	/data2-01/ztf_20181212_programid1-6
    >   646M	/data2-01/ztf_20181212_programid1-11
    >   646M	/data2-01/ztf_20181212_programid1-0
    >   646M	/data2-01/ztf_20181212_programid1-13
    >   646M	/data2-01/ztf_20181212_programid1-4
    >   496M	/data2-01/ztf_20181213_programid1-6
    >   496M	/data2-01/ztf_20181213_programid1-14
    >   496M	/data2-01/ztf_20181213_programid1-12
    >   497M	/data2-01/ztf_20181213_programid1-0
    >   496M	/data2-01/ztf_20181213_programid1-13
    >   496M	/data2-01/ztf_20181213_programid1-7
    >   957M	/data2-01/ztf_20181214_programid1-4
    >   957M	/data2-01/ztf_20181214_programid1-12
    >   957M	/data2-01/ztf_20181214_programid1-11
    >   957M	/data2-01/ztf_20181214_programid1-14
    >   958M	/data2-01/ztf_20181214_programid1-15
    >   958M	/data2-01/ztf_20181214_programid1-6
    >   42M	/data2-01/ztf_20181215_programid1-5
    >   42M	/data2-01/ztf_20181215_programid1-13
    >   42M	/data2-01/ztf_20181215_programid1-8
    >   42M	/data2-01/ztf_20181215_programid1-12
    >   42M	/data2-01/ztf_20181215_programid1-3
    >   42M	/data2-01/ztf_20181215_programid1-10
    >   560M	/data2-01/ztf_20181216_programid1-13
    >   560M	/data2-01/ztf_20181216_programid1-5
    >   560M	/data2-01/ztf_20181216_programid1-6
    >   560M	/data2-01/ztf_20181216_programid1-10
    >   560M	/data2-01/ztf_20181216_programid1-8
    >   560M	/data2-01/ztf_20181216_programid1-12
    >   992M	/data2-01/ztf_20181217_programid1-14
    >   992M	/data2-01/ztf_20181217_programid1-6
    >   993M	/data2-01/ztf_20181217_programid1-11
    >   992M	/data2-01/ztf_20181217_programid1-9
    >   992M	/data2-01/ztf_20181217_programid1-4
    >   992M	/data2-01/ztf_20181217_programid1-1
    >   30G	/data2-01
    >   ---- ----
    >   16K	/data2-02
    >   ---- ---- ---- ----
    >   [Angece][Sun 23 Dec 16:47:59 GMT 2018]
    >   ---- ----
    >   0	/data1-01/__confluent.support.metrics-0
    >   715M	/data1-01/ztf_20181205_programid1-15
    >   716M	/data1-01/ztf_20181205_programid1-7
    >   715M	/data1-01/ztf_20181205_programid1-5
    >   716M	/data1-01/ztf_20181205_programid1-10
    >   715M	/data1-01/ztf_20181205_programid1-13
    >   716M	/data1-01/ztf_20181205_programid1-14
    >   269M	/data1-01/ztf_20181209_programid1-4
    >   269M	/data1-01/ztf_20181209_programid1-12
    >   269M	/data1-01/ztf_20181209_programid1-13
    >   269M	/data1-01/ztf_20181209_programid1-7
    >   269M	/data1-01/ztf_20181209_programid1-15
    >   269M	/data1-01/ztf_20181209_programid1-6
    >   437M	/data1-01/ztf_20181210_programid1-13
    >   436M	/data1-01/ztf_20181210_programid1-5
    >   436M	/data1-01/ztf_20181210_programid1-12
    >   437M	/data1-01/ztf_20181210_programid1-3
    >   437M	/data1-01/ztf_20181210_programid1-10
    >   437M	/data1-01/ztf_20181210_programid1-8
    >   646M	/data1-01/ztf_20181212_programid1-15
    >   646M	/data1-01/ztf_20181212_programid1-7
    >   646M	/data1-01/ztf_20181212_programid1-8
    >   646M	/data1-01/ztf_20181212_programid1-2
    >   646M	/data1-01/ztf_20181212_programid1-10
    >   646M	/data1-01/ztf_20181212_programid1-1
    >   496M	/data1-01/ztf_20181213_programid1-7
    >   496M	/data1-01/ztf_20181213_programid1-15
    >   496M	/data1-01/ztf_20181213_programid1-13
    >   497M	/data1-01/ztf_20181213_programid1-10
    >   496M	/data1-01/ztf_20181213_programid1-8
    >   497M	/data1-01/ztf_20181213_programid1-2
    >   957M	/data1-01/ztf_20181214_programid1-5
    >   957M	/data1-01/ztf_20181214_programid1-13
    >   957M	/data1-01/ztf_20181214_programid1-7
    >   958M	/data1-01/ztf_20181214_programid1-15
    >   958M	/data1-01/ztf_20181214_programid1-6
    >   957M	/data1-01/ztf_20181214_programid1-0
    >   42M	/data1-01/ztf_20181215_programid1-6
    >   42M	/data1-01/ztf_20181215_programid1-14
    >   42M	/data1-01/ztf_20181215_programid1-9
    >   42M	/data1-01/ztf_20181215_programid1-13
    >   42M	/data1-01/ztf_20181215_programid1-4
    >   42M	/data1-01/ztf_20181215_programid1-11
    >   560M	/data1-01/ztf_20181216_programid1-10
    >   560M	/data1-01/ztf_20181216_programid1-2
    >   561M	/data1-01/ztf_20181216_programid1-7
    >   561M	/data1-01/ztf_20181216_programid1-1
    >   560M	/data1-01/ztf_20181216_programid1-12
    >   560M	/data1-01/ztf_20181216_programid1-9
    >   993M	/data1-01/ztf_20181217_programid1-15
    >   993M	/data1-01/ztf_20181217_programid1-7
    >   991M	/data1-01/ztf_20181217_programid1-8
    >   992M	/data1-01/ztf_20181217_programid1-2
    >   991M	/data1-01/ztf_20181217_programid1-13
    >   992M	/data1-01/ztf_20181217_programid1-1
    >   30G	/data1-01
    >   ---- ----
    >   16K	/data1-02
    >   ---- ----
    >   715M	/data2-01/ztf_20181205_programid1-11
    >   715M	/data2-01/ztf_20181205_programid1-3
    >   716M	/data2-01/ztf_20181205_programid1-8
    >   716M	/data2-01/ztf_20181205_programid1-2
    >   715M	/data2-01/ztf_20181205_programid1-4
    >   716M	/data2-01/ztf_20181205_programid1-1
    >   269M	/data2-01/ztf_20181209_programid1-0
    >   269M	/data2-01/ztf_20181209_programid1-8
    >   269M	/data2-01/ztf_20181209_programid1-3
    >   269M	/data2-01/ztf_20181209_programid1-10
    >   269M	/data2-01/ztf_20181209_programid1-1
    >   269M	/data2-01/ztf_20181209_programid1-9
    >   437M	/data2-01/ztf_20181210_programid1-9
    >   437M	/data2-01/ztf_20181210_programid1-1
    >   437M	/data2-01/ztf_20181210_programid1-15
    >   437M	/data2-01/ztf_20181210_programid1-6
    >   437M	/data2-01/ztf_20181210_programid1-0
    >   437M	/data2-01/ztf_20181210_programid1-7
    >   646M	/data2-01/ztf_20181212_programid1-11
    >   646M	/data2-01/ztf_20181212_programid1-3
    >   647M	/data2-01/ztf_20181212_programid1-14
    >   646M	/data2-01/ztf_20181212_programid1-5
    >   646M	/data2-01/ztf_20181212_programid1-13
    >   646M	/data2-01/ztf_20181212_programid1-4
    >   496M	/data2-01/ztf_20181213_programid1-3
    >   496M	/data2-01/ztf_20181213_programid1-11
    >   496M	/data2-01/ztf_20181213_programid1-4
    >   496M	/data2-01/ztf_20181213_programid1-1
    >   496M	/data2-01/ztf_20181213_programid1-14
    >   496M	/data2-01/ztf_20181213_programid1-5
    >   958M	/data2-01/ztf_20181214_programid1-1
    >   957M	/data2-01/ztf_20181214_programid1-9
    >   958M	/data2-01/ztf_20181214_programid1-10
    >   957M	/data2-01/ztf_20181214_programid1-8
    >   957M	/data2-01/ztf_20181214_programid1-12
    >   957M	/data2-01/ztf_20181214_programid1-3
    >   42M	/data2-01/ztf_20181215_programid1-2
    >   42M	/data2-01/ztf_20181215_programid1-10
    >   42M	/data2-01/ztf_20181215_programid1-12
    >   42M	/data2-01/ztf_20181215_programid1-0
    >   42M	/data2-01/ztf_20181215_programid1-7
    >   42M	/data2-01/ztf_20181215_programid1-1
    >   560M	/data2-01/ztf_20181216_programid1-6
    >   560M	/data2-01/ztf_20181216_programid1-14
    >   560M	/data2-01/ztf_20181216_programid1-13
    >   560M	/data2-01/ztf_20181216_programid1-4
    >   560M	/data2-01/ztf_20181216_programid1-11
    >   560M	/data2-01/ztf_20181216_programid1-0
    >   993M	/data2-01/ztf_20181217_programid1-11
    >   993M	/data2-01/ztf_20181217_programid1-3
    >   992M	/data2-01/ztf_20181217_programid1-14
    >   992M	/data2-01/ztf_20181217_programid1-5
    >   992M	/data2-01/ztf_20181217_programid1-4
    >   991M	/data2-01/ztf_20181217_programid1-10
    >   30G	/data2-01
    >   ---- ----
    >   16K	/data2-02
    >   ---- ---- ---- ----
    >   [Edwalafia][Sun 23 Dec 16:47:59 GMT 2018]
    >   ---- ----
    >   0	/data1-01/__confluent.support.metrics-0
    >   715M	/data1-01/ztf_20181205_programid1-12
    >   715M	/data1-01/ztf_20181205_programid1-4
    >   715M	/data1-01/ztf_20181205_programid1-5
    >   715M	/data1-01/ztf_20181205_programid1-15
    >   715M	/data1-01/ztf_20181205_programid1-6
    >   716M	/data1-01/ztf_20181205_programid1-14
    >   269M	/data1-01/ztf_20181209_programid1-1
    >   269M	/data1-01/ztf_20181209_programid1-9
    >   269M	/data1-01/ztf_20181209_programid1-10
    >   269M	/data1-01/ztf_20181209_programid1-4
    >   269M	/data1-01/ztf_20181209_programid1-11
    >   269M	/data1-01/ztf_20181209_programid1-12
    >   437M	/data1-01/ztf_20181210_programid1-10
    >   437M	/data1-01/ztf_20181210_programid1-2
    >   437M	/data1-01/ztf_20181210_programid1-9
    >   437M	/data1-01/ztf_20181210_programid1-13
    >   436M	/data1-01/ztf_20181210_programid1-4
    >   437M	/data1-01/ztf_20181210_programid1-11
    >   647M	/data1-01/ztf_20181212_programid1-12
    >   646M	/data1-01/ztf_20181212_programid1-4
    >   646M	/data1-01/ztf_20181212_programid1-11
    >   646M	/data1-01/ztf_20181212_programid1-2
    >   646M	/data1-01/ztf_20181212_programid1-9
    >   646M	/data1-01/ztf_20181212_programid1-3
    >   497M	/data1-01/ztf_20181213_programid1-0
    >   496M	/data1-01/ztf_20181213_programid1-8
    >   496M	/data1-01/ztf_20181213_programid1-6
    >   496M	/data1-01/ztf_20181213_programid1-14
    >   496M	/data1-01/ztf_20181213_programid1-5
    >   496M	/data1-01/ztf_20181213_programid1-15
    >   957M	/data1-01/ztf_20181214_programid1-14
    >   958M	/data1-01/ztf_20181214_programid1-6
    >   957M	/data1-01/ztf_20181214_programid1-4
    >   957M	/data1-01/ztf_20181214_programid1-11
    >   957M	/data1-01/ztf_20181214_programid1-9
    >   957M	/data1-01/ztf_20181214_programid1-13
    >   42M	/data1-01/ztf_20181215_programid1-3
    >   42M	/data1-01/ztf_20181215_programid1-11
    >   42M	/data1-01/ztf_20181215_programid1-5
    >   42M	/data1-01/ztf_20181215_programid1-13
    >   42M	/data1-01/ztf_20181215_programid1-4
    >   42M	/data1-01/ztf_20181215_programid1-14
    >   561M	/data1-01/ztf_20181216_programid1-7
    >   560M	/data1-01/ztf_20181216_programid1-15
    >   560M	/data1-01/ztf_20181216_programid1-10
    >   561M	/data1-01/ztf_20181216_programid1-1
    >   560M	/data1-01/ztf_20181216_programid1-8
    >   560M	/data1-01/ztf_20181216_programid1-2
    >   992M	/data1-01/ztf_20181217_programid1-12
    >   992M	/data1-01/ztf_20181217_programid1-4
    >   993M	/data1-01/ztf_20181217_programid1-11
    >   992M	/data1-01/ztf_20181217_programid1-2
    >   992M	/data1-01/ztf_20181217_programid1-9
    >   993M	/data1-01/ztf_20181217_programid1-3
    >   30G	/data1-01
    >   ---- ----
    >   16K	/data1-02
    >   ---- ----
    >   716M	/data2-01/ztf_20181205_programid1-8
    >   716M	/data2-01/ztf_20181205_programid1-0
    >   715M	/data2-01/ztf_20181205_programid1-11
    >   716M	/data2-01/ztf_20181205_programid1-2
    >   716M	/data2-01/ztf_20181205_programid1-9
    >   715M	/data2-01/ztf_20181205_programid1-3
    >   269M	/data2-01/ztf_20181209_programid1-13
    >   269M	/data2-01/ztf_20181209_programid1-5
    >   269M	/data2-01/ztf_20181209_programid1-0
    >   269M	/data2-01/ztf_20181209_programid1-7
    >   269M	/data2-01/ztf_20181209_programid1-14
    >   269M	/data2-01/ztf_20181209_programid1-2
    >   437M	/data2-01/ztf_20181210_programid1-6
    >   436M	/data2-01/ztf_20181210_programid1-14
    >   436M	/data2-01/ztf_20181210_programid1-12
    >   437M	/data2-01/ztf_20181210_programid1-0
    >   437M	/data2-01/ztf_20181210_programid1-7
    >   437M	/data2-01/ztf_20181210_programid1-1
    >   646M	/data2-01/ztf_20181212_programid1-8
    >   646M	/data2-01/ztf_20181212_programid1-0
    >   647M	/data2-01/ztf_20181212_programid1-14
    >   646M	/data2-01/ztf_20181212_programid1-5
    >   646M	/data2-01/ztf_20181212_programid1-15
    >   647M	/data2-01/ztf_20181212_programid1-6
    >   496M	/data2-01/ztf_20181213_programid1-12
    >   496M	/data2-01/ztf_20181213_programid1-4
    >   497M	/data2-01/ztf_20181213_programid1-9
    >   496M	/data2-01/ztf_20181213_programid1-3
    >   496M	/data2-01/ztf_20181213_programid1-11
    >   497M	/data2-01/ztf_20181213_programid1-2
    >   958M	/data2-01/ztf_20181214_programid1-10
    >   958M	/data2-01/ztf_20181214_programid1-2
    >   957M	/data2-01/ztf_20181214_programid1-7
    >   958M	/data2-01/ztf_20181214_programid1-1
    >   957M	/data2-01/ztf_20181214_programid1-12
    >   957M	/data2-01/ztf_20181214_programid1-0
    >   42M	/data2-01/ztf_20181215_programid1-15
    >   42M	/data2-01/ztf_20181215_programid1-7
    >   42M	/data2-01/ztf_20181215_programid1-8
    >   42M	/data2-01/ztf_20181215_programid1-2
    >   42M	/data2-01/ztf_20181215_programid1-10
    >   42M	/data2-01/ztf_20181215_programid1-1
    >   560M	/data2-01/ztf_20181216_programid1-3
    >   560M	/data2-01/ztf_20181216_programid1-11
    >   560M	/data2-01/ztf_20181216_programid1-13
    >   560M	/data2-01/ztf_20181216_programid1-4
    >   560M	/data2-01/ztf_20181216_programid1-14
    >   560M	/data2-01/ztf_20181216_programid1-5
    >   991M	/data2-01/ztf_20181217_programid1-8
    >   991M	/data2-01/ztf_20181217_programid1-0
    >   992M	/data2-01/ztf_20181217_programid1-14
    >   992M	/data2-01/ztf_20181217_programid1-5
    >   993M	/data2-01/ztf_20181217_programid1-15
    >   992M	/data2-01/ztf_20181217_programid1-6
    >   30G	/data2-01
    >   ---- ----
    >   16K	/data2-02
    >   ---- ---- ---- ----
    >   [Onoza][Sun 23 Dec 16:48:00 GMT 2018]
    >   ---- ----
    >   715M	/data1-01/ztf_20181205_programid1-5
    >   715M	/data1-01/ztf_20181205_programid1-13
    >   716M	/data1-01/ztf_20181205_programid1-8
    >   715M	/data1-01/ztf_20181205_programid1-12
    >   715M	/data1-01/ztf_20181205_programid1-3
    >   716M	/data1-01/ztf_20181205_programid1-10
    >   269M	/data1-01/ztf_20181209_programid1-10
    >   269M	/data1-01/ztf_20181209_programid1-2
    >   269M	/data1-01/ztf_20181209_programid1-3
    >   269M	/data1-01/ztf_20181209_programid1-4
    >   269M	/data1-01/ztf_20181209_programid1-11
    >   269M	/data1-01/ztf_20181209_programid1-5
    >   437M	/data1-01/ztf_20181210_programid1-15
    >   437M	/data1-01/ztf_20181210_programid1-7
    >   437M	/data1-01/ztf_20181210_programid1-13
    >   436M	/data1-01/ztf_20181210_programid1-4
    >   437M	/data1-01/ztf_20181210_programid1-8
    >   436M	/data1-01/ztf_20181210_programid1-5
    >   646M	/data1-01/ztf_20181212_programid1-5
    >   646M	/data1-01/ztf_20181212_programid1-13
    >   646M	/data1-01/ztf_20181212_programid1-8
    >   647M	/data1-01/ztf_20181212_programid1-12
    >   647M	/data1-01/ztf_20181212_programid1-6
    >   646M	/data1-01/ztf_20181212_programid1-10
    >   497M	/data1-01/ztf_20181213_programid1-9
    >   496M	/data1-01/ztf_20181213_programid1-1
    >   496M	/data1-01/ztf_20181213_programid1-12
    >   496M	/data1-01/ztf_20181213_programid1-3
    >   497M	/data1-01/ztf_20181213_programid1-10
    >   496M	/data1-01/ztf_20181213_programid1-8
    >   957M	/data1-01/ztf_20181214_programid1-7
    >   958M	/data1-01/ztf_20181214_programid1-15
    >   958M	/data1-01/ztf_20181214_programid1-10
    >   958M	/data1-01/ztf_20181214_programid1-1
    >   957M	/data1-01/ztf_20181214_programid1-5
    >   958M	/data1-01/ztf_20181214_programid1-2
    >   42M	/data1-01/ztf_20181215_programid1-8
    >   42M	/data1-01/ztf_20181215_programid1-0
    >   42M	/data1-01/ztf_20181215_programid1-15
    >   42M	/data1-01/ztf_20181215_programid1-2
    >   42M	/data1-01/ztf_20181215_programid1-6
    >   42M	/data1-01/ztf_20181215_programid1-14
    >   560M	/data1-01/ztf_20181216_programid1-4
    >   560M	/data1-01/ztf_20181216_programid1-12
    >   560M	/data1-01/ztf_20181216_programid1-6
    >   560M	/data1-01/ztf_20181216_programid1-14
    >   560M	/data1-01/ztf_20181216_programid1-5
    >   560M	/data1-01/ztf_20181216_programid1-15
    >   992M	/data1-01/ztf_20181217_programid1-5
    >   991M	/data1-01/ztf_20181217_programid1-13
    >   991M	/data1-01/ztf_20181217_programid1-8
    >   992M	/data1-01/ztf_20181217_programid1-12
    >   993M	/data1-01/ztf_20181217_programid1-3
    >   991M	/data1-01/ztf_20181217_programid1-10
    >   30G	/data1-01
    >   ---- ----
    >   16K	/data1-02
    >   ---- ----
    >   716M	/data2-01/ztf_20181205_programid1-9
    >   716M	/data2-01/ztf_20181205_programid1-1
    >   715M	/data2-01/ztf_20181205_programid1-15
    >   715M	/data2-01/ztf_20181205_programid1-6
    >   716M	/data2-01/ztf_20181205_programid1-0
    >   716M	/data2-01/ztf_20181205_programid1-7
    >   269M	/data2-01/ztf_20181209_programid1-14
    >   269M	/data2-01/ztf_20181209_programid1-6
    >   269M	/data2-01/ztf_20181209_programid1-13
    >   269M	/data2-01/ztf_20181209_programid1-1
    >   269M	/data2-01/ztf_20181209_programid1-8
    >   269M	/data2-01/ztf_20181209_programid1-15
    >   437M	/data2-01/ztf_20181210_programid1-3
    >   437M	/data2-01/ztf_20181210_programid1-11
    >   437M	/data2-01/ztf_20181210_programid1-10
    >   437M	/data2-01/ztf_20181210_programid1-1
    >   436M	/data2-01/ztf_20181210_programid1-14
    >   437M	/data2-01/ztf_20181210_programid1-2
    >   646M	/data2-01/ztf_20181212_programid1-9
    >   646M	/data2-01/ztf_20181212_programid1-1
    >   646M	/data2-01/ztf_20181212_programid1-15
    >   646M	/data2-01/ztf_20181212_programid1-0
    >   646M	/data2-01/ztf_20181212_programid1-3
    >   646M	/data2-01/ztf_20181212_programid1-7
    >   496M	/data2-01/ztf_20181213_programid1-13
    >   496M	/data2-01/ztf_20181213_programid1-5
    >   496M	/data2-01/ztf_20181213_programid1-6
    >   497M	/data2-01/ztf_20181213_programid1-0
    >   496M	/data2-01/ztf_20181213_programid1-7
    >   496M	/data2-01/ztf_20181213_programid1-15
    >   957M	/data2-01/ztf_20181214_programid1-11
    >   957M	/data2-01/ztf_20181214_programid1-3
    >   957M	/data2-01/ztf_20181214_programid1-4
    >   957M	/data2-01/ztf_20181214_programid1-8
    >   957M	/data2-01/ztf_20181214_programid1-14
    >   957M	/data2-01/ztf_20181214_programid1-13
    >   42M	/data2-01/ztf_20181215_programid1-12
    >   42M	/data2-01/ztf_20181215_programid1-4
    >   42M	/data2-01/ztf_20181215_programid1-5
    >   42M	/data2-01/ztf_20181215_programid1-9
    >   42M	/data2-01/ztf_20181215_programid1-3
    >   42M	/data2-01/ztf_20181215_programid1-11
    >   560M	/data2-01/ztf_20181216_programid1-8
    >   560M	/data2-01/ztf_20181216_programid1-0
    >   560M	/data2-01/ztf_20181216_programid1-3
    >   560M	/data2-01/ztf_20181216_programid1-11
    >   560M	/data2-01/ztf_20181216_programid1-2
    >   560M	/data2-01/ztf_20181216_programid1-9
    >   992M	/data2-01/ztf_20181217_programid1-9
    >   992M	/data2-01/ztf_20181217_programid1-1
    >   993M	/data2-01/ztf_20181217_programid1-15
    >   992M	/data2-01/ztf_20181217_programid1-6
    >   991M	/data2-01/ztf_20181217_programid1-0
    >   993M	/data2-01/ztf_20181217_programid1-7
    >   30G	/data2-01
    >   ---- ----
    >   16K	/data2-02


# -----------------------------------------------------
# Check the disc space on each Kafka node.
#[user@trop03]

    for vmname in ${kfnames[@]}
        do
            ssh \
                ${sshopts[*]} \
                ${sshuser:?}@${vmname:?} \
                    "
                    echo \"---- ---- ---- ----\"
                    echo \"[\$(hostname)][\$(date)]\"
                    echo \"---- ----\"

                    df -h /
                    echo \"---- ----\"
                    df -h \"/data1-01\"
                    echo \"---- ----\"
                    df -h \"/data1-02\"

                    echo "---- ----"
                    df -h \"/data2-01\"
                    echo "---- ----"
                    df -h \"/data2-02\"
                    "
        done


    >   ---- ---- ---- ----
    >   [Stedigo][Sun 23 Dec 16:44:56 GMT 2018]
    >   ---- ----
    >   Filesystem      Size  Used Avail Use% Mounted on
    >   /dev/vda3       6.8G  5.2G  1.2G  83% /
    >   ---- ----
    >   Filesystem      Size  Used Avail Use% Mounted on
    >   /dev/vdc         32G   31G  4.6M 100% /data1-01
    >   ---- ----
    >   Filesystem      Size  Used Avail Use% Mounted on
    >   /dev/vde         64G   17M   62G   1% /data1-02
    >   ---- ----
    >   Filesystem      Size  Used Avail Use% Mounted on
    >   /dev/vdd         32G   31G  3.3M 100% /data2-01
    >   ---- ----
    >   Filesystem      Size  Used Avail Use% Mounted on
    >   /dev/vdf         64G   17M   62G   1% /data2-02
    >   ---- ---- ---- ----
    >   [Angece][Sun 23 Dec 16:44:56 GMT 2018]
    >   ---- ----
    >   Filesystem      Size  Used Avail Use% Mounted on
    >   /dev/vda3       6.8G  5.2G  1.2G  83% /
    >   ---- ----
    >   Filesystem      Size  Used Avail Use% Mounted on
    >   /dev/vdc         32G   31G  4.0M 100% /data1-01
    >   ---- ----
    >   Filesystem      Size  Used Avail Use% Mounted on
    >   /dev/vde         64G   17M   62G   1% /data1-02
    >   ---- ----
    >   Filesystem      Size  Used Avail Use% Mounted on
    >   /dev/vdd         32G   31G  4.1M 100% /data2-01
    >   ---- ----
    >   Filesystem      Size  Used Avail Use% Mounted on
    >   /dev/vdf         64G   17M   62G   1% /data2-02
    >   ---- ---- ---- ----
    >   [Edwalafia][Sun 23 Dec 16:44:57 GMT 2018]
    >   ---- ----
    >   Filesystem      Size  Used Avail Use% Mounted on
    >   /dev/vda3       6.8G  5.3G  1.1G  84% /
    >   ---- ----
    >   Filesystem      Size  Used Avail Use% Mounted on
    >   /dev/vdc         32G   31G  6.1M 100% /data1-01
    >   ---- ----
    >   Filesystem      Size  Used Avail Use% Mounted on
    >   /dev/vde         64G   17M   62G   1% /data1-02
    >   ---- ----
    >   Filesystem      Size  Used Avail Use% Mounted on
    >   /dev/vdd         32G   31G  3.8M 100% /data2-01
    >   ---- ----
    >   Filesystem      Size  Used Avail Use% Mounted on
    >   /dev/vdf         64G   17M   62G   1% /data2-02
    >   ---- ---- ---- ----
    >   [Onoza][Sun 23 Dec 16:44:57 GMT 2018]
    >   ---- ----
    >   Filesystem      Size  Used Avail Use% Mounted on
    >   /dev/vda3       6.8G  5.2G  1.1G  84% /
    >   ---- ----
    >   Filesystem      Size  Used Avail Use% Mounted on
    >   /dev/vdc         32G   31G  4.7M 100% /data1-01
    >   ---- ----
    >   Filesystem      Size  Used Avail Use% Mounted on
    >   /dev/vde         64G   17M   62G   1% /data1-02
    >   ---- ----
    >   Filesystem      Size  Used Avail Use% Mounted on
    >   /dev/vdd         32G   31G  4.9M 100% /data2-01
    >   ---- ----
    >   Filesystem      Size  Used Avail Use% Mounted on
    >   /dev/vdf         64G   17M   62G   1% /data2-02


# -----------------------------------------------------
# Kafka services fail - out of disc space.
#[user@trop03]


    >   [2018-12-23 16:49:46,181] ERROR Error while appending records to ztf_20181219_programid1-4 in dir /data1-02 (kafka.server.LogDirFailureChannel)
    >   java.io.IOException: No space left on device
    >   	at sun.nio.ch.FileDispatcherImpl.write0(Native Method)
    >   	at sun.nio.ch.FileDispatcherImpl.write(FileDispatcherImpl.java:60)
    >       ....
    >
    >   [2018-12-23 16:49:46,181] ERROR Error while appending records to ztf_20181219_programid1-5 in dir /data1-02 (kafka.server.LogDirFailureChannel)
    >   java.io.IOException: No space left on device
    >   	at sun.nio.ch.FileDispatcherImpl.write0(Native Method)
    >   	at sun.nio.ch.FileDispatcherImpl.write(FileDispatcherImpl.java:60)
    >       ....
    >
    >   [2018-12-23 16:49:46,228] INFO [ReplicaManager broker=3] Stopping serving replicas in dir /data1-02 (kafka.server.ReplicaManager)
    >   [2018-12-23 16:49:46,230] ERROR [ReplicaFetcher replicaId=3, leaderId=1, fetcherId=0] Error while processing data for partition ztf_20181219_programid1-4 (kafka.server.ReplicaFetcherThread)
    >   org.apache.kafka.common.errors.KafkaStorageException: Error while appending records to ztf_20181219_programid1-4 in dir /data1-02
    >   Caused by: java.io.IOException: No space left on device
    >   	at sun.nio.ch.FileDispatcherImpl.write0(Native Method)
    >   	at sun.nio.ch.FileDispatcherImpl.write(FileDispatcherImpl.java:60)
    >       ....
    >
    >   [2018-12-23 16:49:46,230] ERROR [ReplicaFetcher replicaId=3, leaderId=2, fetcherId=0] Error while processing data for partition ztf_20181219_programid1-5 (kafka.server.ReplicaFetcherThread)
    >   org.apache.kafka.common.errors.KafkaStorageException: Error while appending records to ztf_20181219_programid1-5 in dir /data1-02
    >   Caused by: java.io.IOException: No space left on device
    >   	at sun.nio.ch.FileDispatcherImpl.write0(Native Method)
    >   	at sun.nio.ch.FileDispatcherImpl.write(FileDispatcherImpl.java:60)
    >       ....
    >
    >   [2018-12-23 16:49:46,247] ERROR Error while appending records to ztf_20181219_programid1-8 in dir /data2-02 (kafka.server.LogDirFailureChannel)
    >   java.io.IOException: No space left on device
    >   	at sun.nio.ch.FileDispatcherImpl.write0(Native Method)
    >   	at sun.nio.ch.FileDispatcherImpl.write(FileDispatcherImpl.java:60)
    >       ....
    >
    >   [2018-12-23 16:49:46,260] ERROR Error while appending records to ztf_20181219_programid1-13 in dir /data2-02 (kafka.server.LogDirFailureChannel)
    >   java.io.IOException: No space left on device
    >   	at sun.nio.ch.FileDispatcherImpl.write0(Native Method)
    >   	at sun.nio.ch.FileDispatcherImpl.write(FileDispatcherImpl.java:60)
    >       ....
    >
    >   [2018-12-23 16:49:46,264] ERROR [ReplicaFetcher replicaId=3, leaderId=1, fetcherId=0] Error while processing data for partition ztf_20181219_programid1-8 (kafka.server.ReplicaFetcherThread)
    >   org.apache.kafka.common.errors.KafkaStorageException: Error while appending records to ztf_20181219_programid1-8 in dir /data2-02
    >   Caused by: java.io.IOException: No space left on device
    >   	at sun.nio.ch.FileDispatcherImpl.write0(Native Method)
    >   	at sun.nio.ch.FileDispatcherImpl.write(FileDispatcherImpl.java:60)
    >       ....
    >
    >   [2018-12-23 16:49:46,265] ERROR [ReplicaFetcher replicaId=3, leaderId=2, fetcherId=0] Error while processing data for partition ztf_20181219_programid1-13 (kafka.server.ReplicaFetcherThread)
    >   org.apache.kafka.common.errors.KafkaStorageException: Error while appending records to ztf_20181219_programid1-13 in dir /data2-02
    >   Caused by: java.io.IOException: No space left on device
    >   	at sun.nio.ch.FileDispatcherImpl.write0(Native Method)
    >   	at sun.nio.ch.FileDispatcherImpl.write(FileDispatcherImpl.java:60)
    >       ....
    >
    >   [2018-12-23 16:49:46,278] ERROR Error while appending records to ztf_20181219_programid1-1 in dir /data2-02 (kafka.server.LogDirFailureChannel)
    >   java.io.IOException: No space left on device
    >   	at sun.nio.ch.FileDispatcherImpl.write0(Native Method)
    >   	at sun.nio.ch.FileDispatcherImpl.write(FileDispatcherImpl.java:60)
    >       ....
    >
    >   [2018-12-23 16:49:46,280] ERROR [ReplicaFetcher replicaId=3, leaderId=2, fetcherId=0] Error while processing data for partition ztf_20181219_programid1-1 (kafka.server.ReplicaFetcherThread)
    >   org.apache.kafka.common.errors.KafkaStorageException: Error while appending records to ztf_20181219_programid1-1 in dir /data2-02
    >   Caused by: java.io.IOException: No space left on device
    >   	at sun.nio.ch.FileDispatcherImpl.write0(Native Method)
    >   	at sun.nio.ch.FileDispatcherImpl.write(FileDispatcherImpl.java:60)
    >       ....
    >
    >   [2018-12-23 16:49:46,283] INFO [ReplicaFetcherManager on broker 3] Removed fetcher for partitions ztf_20181219_programid1-11,ztf_20181219_programid1-5,ztf_20181219_programid1-2,ztf_20181219_programid1-3,ztf_20181219_programid1-10,ztf_20181219_programid1-4 (kafka.server.ReplicaFetcherManager)
    >   #
    >   # A fatal error has been detected by the Java Runtime Environment:
    >   #
    >   #  SIGBUS (0x7) at pc=0x00007f18b71c7805, pid=1, tid=0x00007f1873789700
    >   #
    >   # JRE version: OpenJDK Runtime Environment (8.0_172-b01) (build 1.8.0_172-b01)
    >   # Java VM: OpenJDK 64-Bit Server VM (25.172-b01 mixed mode linux-amd64 compressed oops)
    >   # Problematic frame:
    >   [thread 139739235612416 also had an error]
    >     CompileBroker::collect_statistics(CompilerThread*, elapsedTimer, CompileTask*)+0x4e5
    >   #
    >   # Core dump written. Default location: //core or core.1
    >   #
    >   # An error report file with more information is saved as:
    >   # //hs_err_pid1.log


# -----------------------------------------------------
# Stop kafka on each node.
#[user@trop03]

    for vmname in ${kfnames[@]}
        do
            echo "---- ----"
            ssh \
                ${scpopts[*]} \
                ${sshuser:?}@${vmname:?} \
                "
                hostname
                docker-compose \
                    --file kafka.yml \
                    down
                "
        done


    >   ---- ----
    >   Stedigo
    >   Removing stevedore_emily_1 ... done
    >   Removing network stevedore_default
    >   ---- ----
    >   Angece
    >   Stopping stevedore_emily_1 ... done
    >   Removing stevedore_emily_1 ... done
    >   Removing network stevedore_default
    >   ---- ----
    >   Edwalafia
    >   Removing stevedore_emily_1 ... done
    >   Removing network stevedore_default
    >   ---- ----
    >   Onoza
    >   Removing stevedore_emily_1 ... done
    >   Removing network stevedore_default


# -----------------------------------------------------
# Update our Kafka compose YML files.
#[user@trop03]

    for vmname in ${kfnames[@]}
        do
            echo "---- ----"
            echo "vmname [${vmname:?}]"
            ssh \
                ${scpopts[*]} \
                ${sshuser:?}@${vmname:?} \
                    "
cat > /tmp/volmounts << 'EOF'
            - type:   "bind"
              source: "/data1-02"
              target: "/data1-02"
            - type:   "bind"
              source: "/data1-02"
              target: "/data1-02"
EOF

                    sed -i '
                        /^[[:space:]]*volumes:/,// {
                            // {
                                r /tmp/volmounts
                                }
                            }
                        ' kafka.yml
                    "
        done


    >   ---- ----
    >   vmname [Stedigo]
    >   ---- ----
    >   vmname [Angece]
    >   ---- ----
    >   vmname [Edwalafia]
    >   ---- ----


# -----------------------------------------------------
# Check our Kafka compose YML files.
#[user@trop03]

    for vmname in ${kfnames[@]}
        do
            echo "---- ----"
            echo "vmname [${vmname:?}]"
            ssh \
                ${scpopts[*]} \
                ${sshuser:?}@${vmname:?} \
                    "
                    cat kafka.yml
                    "
        done


    >   ---- ----
    >   vmname [Stedigo]
    >
    >   version: "3.2"
    >
    >   services:
    >
    >       emily:
    >           image:
    >               confluentinc/cp-kafka:4.1.1
    >           ports:
    >               - "9092:9092"
    >               - "9093:9093"
    >           extra_hosts:
    >               - "${LISTENER_HOSTNAME}:127.0.0.2"
    >           environment:
    >               - KAFKA_LISTENERS=LISTENER_BOB://0.0.0.0:9092
    >               - KAFKA_ADVERTISED_LISTENERS=LISTENER_BOB://${LISTENER_HOSTNAME}:9092
    >               - KAFKA_INTER_BROKER_LISTENER_NAME=LISTENER_BOB
    >               - KAFKA_LISTENER_SECURITY_PROTOCOL_MAP=LISTENER_BOB:PLAINTEXT,LISTENER_FRED:PLAINTEXT
    >               - KAFKA_LOG_DIRS=${KAFKA_LOG_DIRS}
    >               - KAFKA_BROKER_ID=${KAFKA_BROKER_ID}
    >               - KAFKA_BROKER_RACK=${KAFKA_BROKER_RACK}
    >               - KAFKA_ZOOKEEPER_CONNECT=${KAFKA_ZOOKEEPER_CONNECT}
    >               - KAFKA_NUM_PARTITIONS=16
    >               - KAFKA_DEFAULT_REPLICATION_FACTOR=3
    >               - KAFKA_LOG_RETENTION_MS=-1
    >               - KAFKA_LOG_RETENTION_BYTES=-1
    >               - KAFKA_AUTO_CREATE_TOPICS_ENABLE=true
    >               - KAFKA_MESSAGE_MAX_BYTES=10485760
    >           volumes:
    >               - type:   bind
    >                 source: /data1-02
    >                 target: /data1-02
    >               - type:   bind
    >                 source: /data1-02
    >                 target: /data1-02
    >               - type:   "bind"
    >                 source: "/data1-01"
    >                 target: "/data1-01"
    >               - type:   "bind"
    >                 source: "/data2-01"
    >                 target: "/data2-01"
    >
    >   ---- ----
    >   vmname [Angece]
    >
    >   version: "3.2"
    >
    >   services:
    >
    >       emily:
    >           image:
    >               confluentinc/cp-kafka:4.1.1
    >           ports:
    >               - "9092:9092"
    >               - "9093:9093"
    >           extra_hosts:
    >               - "${LISTENER_HOSTNAME}:127.0.0.2"
    >           environment:
    >               - KAFKA_LISTENERS=LISTENER_BOB://0.0.0.0:9092
    >               - KAFKA_ADVERTISED_LISTENERS=LISTENER_BOB://${LISTENER_HOSTNAME}:9092
    >               - KAFKA_INTER_BROKER_LISTENER_NAME=LISTENER_BOB
    >               - KAFKA_LISTENER_SECURITY_PROTOCOL_MAP=LISTENER_BOB:PLAINTEXT,LISTENER_FRED:PLAINTEXT
    >               - KAFKA_LOG_DIRS=${KAFKA_LOG_DIRS}
    >               - KAFKA_BROKER_ID=${KAFKA_BROKER_ID}
    >               - KAFKA_BROKER_RACK=${KAFKA_BROKER_RACK}
    >               - KAFKA_ZOOKEEPER_CONNECT=${KAFKA_ZOOKEEPER_CONNECT}
    >               - KAFKA_NUM_PARTITIONS=16
    >               - KAFKA_DEFAULT_REPLICATION_FACTOR=3
    >               - KAFKA_LOG_RETENTION_MS=-1
    >               - KAFKA_LOG_RETENTION_BYTES=-1
    >               - KAFKA_AUTO_CREATE_TOPICS_ENABLE=true
    >               - KAFKA_MESSAGE_MAX_BYTES=10485760
    >           volumes:
    >               - type:   bind
    >                 source: /data1-02
    >                 target: /data1-02
    >               - type:   bind
    >                 source: /data1-02
    >                 target: /data1-02
    >               - type:   "bind"
    >                 source: "/data1-01"
    >                 target: "/data1-01"
    >               - type:   "bind"
    >                 source: "/data2-01"
    >                 target: "/data2-01"
    >
    >   ---- ----
    >   vmname [Edwalafia]
    >
    >   version: "3.2"
    >
    >   services:
    >
    >       emily:
    >           image:
    >               confluentinc/cp-kafka:4.1.1
    >           ports:
    >               - "9092:9092"
    >               - "9093:9093"
    >           extra_hosts:
    >               - "${LISTENER_HOSTNAME}:127.0.0.2"
    >           environment:
    >               - KAFKA_LISTENERS=LISTENER_BOB://0.0.0.0:9092
    >               - KAFKA_ADVERTISED_LISTENERS=LISTENER_BOB://${LISTENER_HOSTNAME}:9092
    >               - KAFKA_INTER_BROKER_LISTENER_NAME=LISTENER_BOB
    >               - KAFKA_LISTENER_SECURITY_PROTOCOL_MAP=LISTENER_BOB:PLAINTEXT,LISTENER_FRED:PLAINTEXT
    >               - KAFKA_LOG_DIRS=${KAFKA_LOG_DIRS}
    >               - KAFKA_BROKER_ID=${KAFKA_BROKER_ID}
    >               - KAFKA_BROKER_RACK=${KAFKA_BROKER_RACK}
    >               - KAFKA_ZOOKEEPER_CONNECT=${KAFKA_ZOOKEEPER_CONNECT}
    >               - KAFKA_NUM_PARTITIONS=16
    >               - KAFKA_DEFAULT_REPLICATION_FACTOR=3
    >               - KAFKA_LOG_RETENTION_MS=-1
    >               - KAFKA_LOG_RETENTION_BYTES=-1
    >               - KAFKA_AUTO_CREATE_TOPICS_ENABLE=true
    >               - KAFKA_MESSAGE_MAX_BYTES=10485760
    >           volumes:
    >               - type:   bind
    >                 source: /data1-02
    >                 target: /data1-02
    >               - type:   bind
    >                 source: /data1-02
    >                 target: /data1-02
    >               - type:   "bind"
    >                 source: "/data1-01"
    >                 target: "/data1-01"
    >               - type:   "bind"
    >                 source: "/data2-01"
    >                 target: "/data2-01"
    >
    >   ---- ----
    >   vmname [Onoza]
    >
    >   version: "3.2"
    >
    >   services:
    >
    >       emily:
    >           image:
    >               confluentinc/cp-kafka:4.1.1
    >           ports:
    >               - "9092:9092"
    >               - "9093:9093"
    >           extra_hosts:
    >               - "${LISTENER_HOSTNAME}:127.0.0.2"
    >           environment:
    >               - KAFKA_LISTENERS=LISTENER_BOB://0.0.0.0:9092
    >               - KAFKA_ADVERTISED_LISTENERS=LISTENER_BOB://${LISTENER_HOSTNAME}:9092
    >               - KAFKA_INTER_BROKER_LISTENER_NAME=LISTENER_BOB
    >               - KAFKA_LISTENER_SECURITY_PROTOCOL_MAP=LISTENER_BOB:PLAINTEXT,LISTENER_FRED:PLAINTEXT
    >               - KAFKA_LOG_DIRS=${KAFKA_LOG_DIRS}
    >               - KAFKA_BROKER_ID=${KAFKA_BROKER_ID}
    >               - KAFKA_BROKER_RACK=${KAFKA_BROKER_RACK}
    >               - KAFKA_ZOOKEEPER_CONNECT=${KAFKA_ZOOKEEPER_CONNECT}
    >               - KAFKA_NUM_PARTITIONS=16
    >               - KAFKA_DEFAULT_REPLICATION_FACTOR=3
    >               - KAFKA_LOG_RETENTION_MS=-1
    >               - KAFKA_LOG_RETENTION_BYTES=-1
    >               - KAFKA_AUTO_CREATE_TOPICS_ENABLE=true
    >               - KAFKA_MESSAGE_MAX_BYTES=10485760
    >           volumes:
    >               - type:   bind
    >                 source: /data1-02
    >                 target: /data1-02
    >               - type:   bind
    >                 source: /data1-02
    >                 target: /data1-02
    >               - type:   "bind"
    >                 source: "/data1-01"
    >                 target: "/data1-01"
    >               - type:   "bind"
    >                 source: "/data2-01"
    >                 target: "/data2-01"


# -----------------------------------------------------
# Check our Kafka compose ENV files.
#[user@trop03]

    for vmname in ${kfnames[@]}
        do
            echo "---- ----"
            echo "vmname [${vmname:?}]"
            ssh \
                ${scpopts[*]} \
                ${sshuser:?}@${vmname:?} \
                    "
                    cat .env
                    "
        done


    >   ---- ----
    >   vmname [Stedigo]
    >   KAFKA_LOG_DIRS=/data1-01,/data2-01,/data1-02,/data2-02
    >   KAFKA_BROKER_ID=1
    >   KAFKA_BROKER_RACK=1
    >   KAFKA_ZOOKEEPER_CONNECT=192.168.203.21,192.168.203.22,192.168.203.23
    >   LISTENER_HOSTNAME=Stedigo
    >   STAT_IP=192.168.203.31
    >   DHCP_IP=192.168.203.17
    >   ---- ----
    >   vmname [Angece]
    >   KAFKA_LOG_DIRS=/data1-01,/data2-01,/data1-02,/data2-02
    >   KAFKA_BROKER_ID=2
    >   KAFKA_BROKER_RACK=2
    >   KAFKA_ZOOKEEPER_CONNECT=192.168.203.21,192.168.203.22,192.168.203.23
    >   LISTENER_HOSTNAME=Angece
    >   STAT_IP=192.168.203.32
    >   DHCP_IP=192.168.203.18
    >   ---- ----
    >   vmname [Edwalafia]
    >   KAFKA_LOG_DIRS=/data1-01,/data2-01,/data1-02,/data2-02
    >   KAFKA_BROKER_ID=3
    >   KAFKA_BROKER_RACK=3
    >   KAFKA_ZOOKEEPER_CONNECT=192.168.203.21,192.168.203.22,192.168.203.23
    >   LISTENER_HOSTNAME=Edwalafia
    >   STAT_IP=192.168.203.33
    >   DHCP_IP=192.168.203.19
    >   ---- ----
    >   vmname [Onoza]
    >   KAFKA_LOG_DIRS=/data1-01,/data2-01,/data1-02,/data2-02
    >   KAFKA_BROKER_ID=4
    >   KAFKA_BROKER_RACK=4
    >   KAFKA_ZOOKEEPER_CONNECT=192.168.203.21,192.168.203.22,192.168.203.23
    >   LISTENER_HOSTNAME=Onoza
    >   STAT_IP=192.168.203.34
    >   DHCP_IP=192.168.203.20


# -----------------------------------------------------
# Stop MirrorMaker on each node.
#[user@trop03]

    for vmname in ${mmnames[@]}
        do
            echo "---- ----"
            echo "vmname [${vmname:?}]"
            ssh \
                ${scpopts[*]} \
                ${sshuser:?}@${vmname:?} \
                "
                docker-compose \
                    --file mirror.yml \
                    down
                "
        done


    >   ---- ----
    >   vmname [Afoaviel]
    >   Removing stevedore_tina_1 ... done
    >   Removing network stevedore_default
    >   ---- ----
    >   vmname [Rusaldez]
    >   Removing stevedore_tina_1 ... done
    >   Removing network stevedore_default


# -----------------------------------------------------
# Check our client offsets in the ZTF broker.
#[user@trop03]

    devnode=Rusaldez

    ztfconnect=public.alerts.ztf.uw.edu:9092
    roegroupid=ztf-mirror.roe.ac.uk

    date ; \
    ssh \
        ${sshopts[*]} \
        ${sshuser:?}@${devnode:?} \
        "
        docker run --rm phymatopus/kafka-core \
            bin/kafka-consumer-groups.sh \
                --bootstrap-server "${ztfconnect:?}" \
                --describe \
                --group "${roegroupid:?}"
         " \
    | sort \
    ; date


    >   Sun 23 Dec 17:53:04 GMT 2018
    >   Consumer group 'ztf-mirror.roe.ac.uk' has no active members.
    >   TOPIC                   PARTITION  CURRENT-OFFSET  LOG-END-OFFSET  LAG             CONSUMER-ID     HOST            CLIENT-ID
    >   ztf_20181219_programid1 0          5096            20858           15762           -               -               -
    >   ztf_20181219_programid1 10         5069            20859           15790           -               -               -
    >   ztf_20181219_programid1 11         5030            20858           15828           -               -               -
    >   ztf_20181219_programid1 12         5083            20858           15775           -               -               -
    >   ztf_20181219_programid1 13         5043            20859           15816           -               -               -
    >   ztf_20181219_programid1 1          5047            20859           15812           -               -               -
    >   ztf_20181219_programid1 2          5064            20858           15794           -               -               -
    >   ztf_20181219_programid1 3          5027            20859           15832           -               -               -
    >   ztf_20181219_programid1 4          5092            20859           15767           -               -               -
    >   ztf_20181219_programid1 5          5039            20858           15819           -               -               -
    >   ztf_20181219_programid1 6          9781            20858           11077           -               -               -
    >   ztf_20181219_programid1 7          9874            20859           10985           -               -               -
    >   ztf_20181219_programid1 8          5089            20858           15769           -               -               -
    >   ztf_20181219_programid1 9          5039            20859           15820           -               -               -
    >   Sun 23 Dec 17:53:12 GMT 2018


# -----------------------------------------------------
# Reset our client offsets in the ZTF broker.
#[user@trop03]

    devnode=Rusaldez

    ztftopicid=ztf_20181219_programid1
    ztfconnect=public.alerts.ztf.uw.edu:9092
    roegroupid=ztf-mirror.roe.ac.uk

    date ; \
    ssh \
        ${sshopts[*]} \
        ${sshuser:?}@${devnode:?} \
        "
        docker run --rm phymatopus/kafka-core \
            bin/kafka-consumer-groups.sh \
                --bootstrap-server "${ztfconnect:?}" \
                --group "${roegroupid:?}" \
                --reset-offsets \
                --to-earliest \
                --execute \
                --topic ${ztftopicid:?}
         " \
    | sort \
    ; date


    >   Sun 23 Dec 17:59:06 GMT 2018
    >   TOPIC                          PARTITION  NEW-OFFSET
    >   ztf_20181219_programid1        0          0
    >   ztf_20181219_programid1        1          0
    >   ztf_20181219_programid1        10         0
    >   ztf_20181219_programid1        11         0
    >   ztf_20181219_programid1        12         0
    >   ztf_20181219_programid1        13         0
    >   ztf_20181219_programid1        2          0
    >   ztf_20181219_programid1        3          0
    >   ztf_20181219_programid1        4          0
    >   ztf_20181219_programid1        5          0
    >   ztf_20181219_programid1        6          0
    >   ztf_20181219_programid1        7          0
    >   ztf_20181219_programid1        8          0
    >   ztf_20181219_programid1        9          0
    >   Sun 23 Dec 17:59:14 GMT 2018


# -----------------------------------------------------
# Check our client offsets in the ZTF broker.
#[user@trop03]

    devnode=Rusaldez

    ztfconnect=public.alerts.ztf.uw.edu:9092
    roegroupid=ztf-mirror.roe.ac.uk

    date ; \
    ssh \
        ${sshopts[*]} \
        ${sshuser:?}@${devnode:?} \
        "
        docker run --rm phymatopus/kafka-core \
            bin/kafka-consumer-groups.sh \
                --bootstrap-server "${ztfconnect:?}" \
                --describe \
                --group "${roegroupid:?}"
         " \
    | sort \
    ; date


    >   Sun 23 Dec 18:00:16 GMT 2018
    >   TOPIC                   PARTITION  CURRENT-OFFSET  LOG-END-OFFSET  LAG             CONSUMER-ID     HOST            CLIENT-ID
    >   ztf_20181219_programid1 0          0               20858           20858           -               -               -
    >   ztf_20181219_programid1 10         0               20859           20859           -               -               -
    >   ztf_20181219_programid1 1          0               20859           20859           -               -               -
    >   ztf_20181219_programid1 11         0               20858           20858           -               -               -
    >   ztf_20181219_programid1 12         0               20858           20858           -               -               -
    >   ztf_20181219_programid1 13         0               20859           20859           -               -               -
    >   ztf_20181219_programid1 2          0               20858           20858           -               -               -
    >   ztf_20181219_programid1 3          0               20859           20859           -               -               -
    >   ztf_20181219_programid1 4          0               20859           20859           -               -               -
    >   ztf_20181219_programid1 5          0               20858           20858           -               -               -
    >   ztf_20181219_programid1 6          0               20858           20858           -               -               -
    >   ztf_20181219_programid1 7          0               20859           20859           -               -               -
    >   ztf_20181219_programid1 8          0               20858           20858           -               -               -
    >   ztf_20181219_programid1 9          0               20859           20859           -               -               -
    >   Sun 23 Dec 18:00:25 GMT 2018


# -----------------------------------------------------
# Start Kafka on each node.
#[user@trop03]

    for vmname in ${kfnames[@]}
        do
            echo "---- ----"
            ssh \
                ${scpopts[*]} \
                ${sshuser:?}@${vmname:?} \
                "
                hostname
                docker-compose \
                    --file kafka.yml \
                    up -d
                "
        done


    >   ---- ----
    >   Stedigo
    >   Creating network "stevedore_default" with the default driver
    >   Creating stevedore_emily_1 ... done
    >   ---- ----
    >   Angece
    >   Creating network "stevedore_default" with the default driver
    >   Creating stevedore_emily_1 ... done
    >   ---- ----
    >   Edwalafia
    >   Creating network "stevedore_default" with the default driver
    >   Creating stevedore_emily_1 ... done
    >   ---- ----
    >   Onoza
    >   Creating network "stevedore_default" with the default driver
    >   Creating stevedore_emily_1 ... done


# -----------------------------------------------------
# Update the topic and restart MirrorMaker on each node.
#[user@trop03]

    ztftopicid=ztf_20181218_programid1
    ztftopicid=ztf_20181219_programid1

    for vmname in ${mmnames[@]}
        do
            echo "---- ----"
            echo "vmname [${vmname:?}]"
            ssh \
                ${scpopts[*]} \
                ${sshuser:?}@${vmname:?} \
                "
                docker-compose \
                    --file mirror.yml \
                    down
                sed -i \"
                    s/^ztftopicid=.*/ztftopicid=${ztftopicid:?}/
                    \" mirror.env
                docker-compose \
                    --file mirror.yml \
                    up -d
                "
        done


    >   ---- ----
    >   vmname [Afoaviel]
    >   Removing network stevedore_default
    >   Network stevedore_default not found.
    >   Creating network "stevedore_default" with the default driver
    >   Creating stevedore_tina_1 ... done
    >   ---- ----
    >   vmname [Rusaldez]
    >   Removing network stevedore_default
    >   Network stevedore_default not found.
    >   Creating network "stevedore_default" with the default driver
    >   Creating stevedore_tina_1 ... done


# -----------------------------------------------------
# Check our client offsets in the ZTF broker.
#[user@trop03]

    devnode=Rusaldez

    ztfconnect=public.alerts.ztf.uw.edu:9092
    roegroupid=ztf-mirror.roe.ac.uk

    date ; \
    ssh \
        ${sshopts[*]} \
        ${sshuser:?}@${devnode:?} \
        "
        docker run --rm phymatopus/kafka-core \
            bin/kafka-consumer-groups.sh \
                --bootstrap-server "${ztfconnect:?}" \
                --describe \
                --group "${roegroupid:?}"
         " \
    | sort \
    ; date


    >   Sun 23 Dec 18:04:38 GMT 2018
    >   Note: This will not show information about old Zookeeper-based consumers.
    >
    >   TOPIC                   PARTITION  CURRENT-OFFSET  LOG-END-OFFSET  LAG             CONSUMER-ID                                                 HOST            CLIENT-ID
    >   ztf_20181219_programid1 0          0               20858           20858           ztf-mirror.roe.ac.uk-0-36539a6f-486a-4421-8012-8d92e240df9f /129.215.175.98 ztf-mirror.roe.ac.uk-0
    >   ztf_20181219_programid1 10         0               20859           20859           ztf-mirror.roe.ac.uk-1-c167ec83-0eb2-41ed-9ecf-1216cdbff769 /129.215.175.98 ztf-mirror.roe.ac.uk-1
    >   ztf_20181219_programid1 1          0               20859           20859           ztf-mirror.roe.ac.uk-0-d16c3c6b-493c-4f6d-9d38-25f6d29df9aa /129.215.175.98 ztf-mirror.roe.ac.uk-0
    >   ztf_20181219_programid1 11         0               20858           20858           ztf-mirror.roe.ac.uk-1-cfd01f47-4868-40e9-b188-6ef45c997982 /129.215.175.98 ztf-mirror.roe.ac.uk-1
    >   ztf_20181219_programid1 12         0               20858           20858           ztf-mirror.roe.ac.uk-2-b92f20df-c7d9-4b91-be69-4a70a85e8471 /129.215.175.98 ztf-mirror.roe.ac.uk-2
    >   ztf_20181219_programid1 13         0               20859           20859           ztf-mirror.roe.ac.uk-2-dbb34f92-d503-44f7-962e-7287fb92785a /129.215.175.98 ztf-mirror.roe.ac.uk-2
    >   ztf_20181219_programid1 2          0               20858           20858           ztf-mirror.roe.ac.uk-1-c167ec83-0eb2-41ed-9ecf-1216cdbff769 /129.215.175.98 ztf-mirror.roe.ac.uk-1
    >   ztf_20181219_programid1 3          0               20859           20859           ztf-mirror.roe.ac.uk-1-cfd01f47-4868-40e9-b188-6ef45c997982 /129.215.175.98 ztf-mirror.roe.ac.uk-1
    >   ztf_20181219_programid1 4          0               20859           20859           ztf-mirror.roe.ac.uk-2-b92f20df-c7d9-4b91-be69-4a70a85e8471 /129.215.175.98 ztf-mirror.roe.ac.uk-2
    >   ztf_20181219_programid1 5          0               20858           20858           ztf-mirror.roe.ac.uk-2-dbb34f92-d503-44f7-962e-7287fb92785a /129.215.175.98 ztf-mirror.roe.ac.uk-2
    >   ztf_20181219_programid1 6          0               20858           20858           ztf-mirror.roe.ac.uk-3-95738f3d-3064-4d72-9892-52323a36f9e4 /129.215.175.98 ztf-mirror.roe.ac.uk-3
    >   ztf_20181219_programid1 7          0               20859           20859           ztf-mirror.roe.ac.uk-3-f3b71c51-f24a-4816-bbc7-de09d7e51d42 /129.215.175.98 ztf-mirror.roe.ac.uk-3
    >   ztf_20181219_programid1 8          0               20858           20858           ztf-mirror.roe.ac.uk-0-36539a6f-486a-4421-8012-8d92e240df9f /129.215.175.98 ztf-mirror.roe.ac.uk-0
    >   ztf_20181219_programid1 9          0               20859           20859           ztf-mirror.roe.ac.uk-0-d16c3c6b-493c-4f6d-9d38-25f6d29df9aa /129.215.175.98 ztf-mirror.roe.ac.uk-0
    >   Sun 23 Dec 18:04:45 GMT 2018


# -----------------------------------------------------
# Kafka debug logs show Kafka rebuilding corrupted index files ...
# https://issues.apache.org/jira/browse/KAFKA-1554
# https://issues.apache.org/jira/browse/KAFKA-2012
#[user@trop03]


    >   [2018-12-23 18:13:23,784] INFO [ProducerStateManager partition=ztf_20181212_programid1-2] Writing producer snapshot at offset 9897 (kafka.log.ProducerStateManager)
    >   [2018-12-23 18:13:23,784] INFO [Log partition=ztf_20181212_programid1-2, dir=/data1-01] Loading producer state from offset 9897 with message format version 2 (kafka.log.Log)
    >   [2018-12-23 18:13:23,785] INFO [ProducerStateManager partition=ztf_20181212_programid1-2] Loading producer state from snapshot file '/data1-01/ztf_20181212_programid1-2/00000000000000009897.snapshot' (kafka.log.ProducerStateManager)
    >   [2018-12-23 18:13:23,785] INFO [Log partition=ztf_20181212_programid1-2, dir=/data1-01] Completed load of log with 1 segments, log start offset 0 and log end offset 9897 in 41622 ms (kafka.log.Log)
    >   [2018-12-23 18:13:23,852] WARN [Log partition=ztf_20181212_programid1-9, dir=/data1-01] Found a corrupted index file corresponding to log file /data1-01/ztf_20181212_programid1-9/00000000000000000000.log due to Corrupt index found, index file (/data1-01/ztf_20181212_programid1-9/00000000000000000000.index) has non-zero size but the last offset is 0 which is no greater than the base offset 0.}, recovering segment and rebuilding index files... (kafka.log.Log)
    >   [2018-12-23 18:13:36,001] INFO [ProducerStateManager partition=ztf_20181212_programid1-5] Writing producer snapshot at offset 9897 (kafka.log.ProducerStateManager)
    >   [2018-12-23 18:13:36,002] INFO [Log partition=ztf_20181212_programid1-5, dir=/data2-01] Recovering unflushed segment 0 (kafka.log.Log)
    >   [2018-12-23 18:13:37,363] INFO [ProducerStateManager partition=ztf_20181212_programid1-5] Writing producer snapshot at offset 9897 (kafka.log.ProducerStateManager)
    >   [2018-12-23 18:13:37,364] INFO [Log partition=ztf_20181212_programid1-5, dir=/data2-01] Loading producer state from offset 9897 with message format version 2 (kafka.log.Log)
    >   [2018-12-23 18:13:37,364] INFO [ProducerStateManager partition=ztf_20181212_programid1-5] Loading producer state from snapshot file '/data2-01/ztf_20181212_programid1-5/00000000000000009897.snapshot' (kafka.log.ProducerStateManager)
    >   [2018-12-23 18:13:37,365] INFO [Log partition=ztf_20181212_programid1-5, dir=/data2-01] Completed load of log with 1 segments, log start offset 0 and log end offset 9897 in 43014 ms (kafka.log.Log)
    >   [2018-12-23 18:13:37,369] WARN [Log partition=ztf_20181212_programid1-15, dir=/data2-01] Found a corrupted index file corresponding to log file /data2-01/ztf_20181212_programid1-15/00000000000000000000.log due to Corrupt index found, index file (/data2-01/ztf_20181212_programid1-15/00000000000000000000.index) has non-zero size but the last offset is 0 which is no greater than the base offset 0.}, recovering segment and


    >   [2018-12-23 18:14:25,989] INFO [ProducerStateManager partition=ztf_20181212_programid1-3] Loading producer state from snapshot file '/data2-01/ztf_20181212_programid1-3/00000000000000009896.snapshot' (kafka.log.ProducerStateManager)
    >   [2018-12-23 18:14:25,989] INFO [Log partition=ztf_20181212_programid1-3, dir=/data2-01] Completed load of log with 1 segments, log start offset 0 and log end offset 9896 in 40861 ms (kafka.log.Log)
    >   [2018-12-23 18:14:25,994] WARN [Log partition=ztf_20181212_programid1-7, dir=/data2-01] Found a corrupted index file corresponding to log file /data2-01/ztf_20181212_programid1-7/00000000000000000000.log due to Corrupt index found, index file (/data2-01/ztf_20181212_programid1-7/00000000000000000000.index) has non-zero size but the last offset is 0 which is no greater than the base offset 0.}, recovering segment and rebuilding index files... (kafka.log.Log)
    >   [2018-12-23 18:14:39,107] INFO [ProducerStateManager partition=ztf_20181212_programid1-10] Writing producer snapshot at offset 9896 (kafka.log.ProducerStateManager)
    >   [2018-12-23 18:14:39,108] INFO [Log partition=ztf_20181212_programid1-10, dir=/data1-01] Recovering unflushed segment 0 (kafka.log.Log)
    >   [2018-12-23 18:14:40,885] INFO [ProducerStateManager partition=ztf_20181212_programid1-10] Writing producer snapshot at offset 9896 (kafka.log.ProducerStateManager)
    >   [2018-12-23 18:14:40,886] INFO [Log partition=ztf_20181212_programid1-10, dir=/data1-01] Loading producer state from offset 9896 with message format version 2 (kafka.log.Log)
    >   [2018-12-23 18:14:40,886] INFO [ProducerStateManager partition=ztf_20181212_programid1-10] Loading producer state from snapshot file '/data1-01/ztf_20181212_programid1-10/00000000000000009896.snapshot' (kafka.log.ProducerStateManager)
    >   [2018-12-23 18:14:40,887] INFO [Log partition=ztf_20181212_programid1-10, dir=/data1-01] Completed load of log with 1 segments, log start offset 0 and log end offset 9896 in 40308 ms (kafka.log.Log)
    >   [2018-12-23 18:14:40,898] WARN [Log partition=ztf_20181213_programid1-9, dir=/data1-01] Found a corrupted index file corresponding to log file /data1-01/ztf_20181213_programid1-9/00000000000000000000.log due to Corrupt index found, index file (/data1-01/ztf_20181213_programid1-9/00000000000000000000.index) has non-zero size but the last offset is 0 which is no greater than the base offset 0.}, recovering segment and rebuilding index files... (kafka.log.Log)


    >   [2018-12-23 18:14:27,854] INFO [Log partition=ztf_20181212_programid1-13, dir=/data2-01] Loading producer state from offset 9897 with message format version 2 (kafka.log.Log)
    >   [2018-12-23 18:14:27,855] INFO [ProducerStateManager partition=ztf_20181212_programid1-13] Loading producer state from snapshot file '/data2-01/ztf_20181212_programid1-13/00000000000000009897.snapshot' (kafka.log.ProducerStateManager)
    >   [2018-12-23 18:14:27,855] INFO [Log partition=ztf_20181212_programid1-13, dir=/data2-01] Completed load of log with 1 segments, log start offset 0 and log end offset 9897 in 42567 ms (kafka.log.Log)
    >   [2018-12-23 18:14:27,861] WARN [Log partition=ztf_20181212_programid1-4, dir=/data2-01] Found a corrupted index file corresponding to log file /data2-01/ztf_20181212_programid1-4/00000000000000000000.log due to Corrupt index found, index file (/data2-01/ztf_20181212_programid1-4/00000000000000000000.index) has non-zero size but the last offset is 0 which is no greater than the base offset 0.}, recovering segment and rebuilding index files... (kafka.log.Log)
    >   [2018-12-23 18:14:42,066] INFO [ProducerStateManager partition=ztf_20181212_programid1-1] Writing producer snapshot at offset 9896 (kafka.log.ProducerStateManager)
    >   [2018-12-23 18:14:42,068] INFO [Log partition=ztf_20181212_programid1-1, dir=/data1-01] Recovering unflushed segment 0 (kafka.log.Log)
    >   [2018-12-23 18:14:43,665] INFO [ProducerStateManager partition=ztf_20181212_programid1-1] Writing producer snapshot at offset 9896 (kafka.log.ProducerStateManager)
    >   [2018-12-23 18:14:43,667] INFO [Log partition=ztf_20181212_programid1-1, dir=/data1-01] Loading producer state from offset 9896 with message format version 2 (kafka.log.Log)
    >   [2018-12-23 18:14:43,668] INFO [ProducerStateManager partition=ztf_20181212_programid1-1] Loading producer state from snapshot file '/data1-01/ztf_20181212_programid1-1/00000000000000009896.snapshot' (kafka.log.ProducerStateManager)
    >   [2018-12-23 18:14:43,673] INFO [Log partition=ztf_20181212_programid1-1, dir=/data1-01] Completed load of log with 1 segments, log start offset 0 and log end offset 9896 in 43052 ms (kafka.log.Log)
    >   [2018-12-23 18:14:43,683] WARN [Log partition=ztf_20181213_programid1-7, dir=/data1-01] Found a corrupted index file corresponding to log file /data1-01/ztf_20181213_programid1-7/00000000000000000000.log due to Corrupt index found, index file (/data1-01/ztf_20181213_programid1-7/00000000000000000000.index) has non-zero size but the last offset is 0 which is no greater than the base offset 0.}, recovering segment and rebuilding index files... (kafka.log.Log)


    >   [2018-12-23 18:14:43,315] INFO [Log partition=ztf_20181212_programid1-1, dir=/data1-01] Loading producer state from offset 9896 with message format version 2 (kafka.log.Log)
    >   [2018-12-23 18:14:43,316] INFO [ProducerStateManager partition=ztf_20181212_programid1-1] Loading producer state from snapshot file '/data1-01/ztf_20181212_programid1-1/00000000000000009896.snapshot' (kafka.log.ProducerStateManager)
    >   [2018-12-23 18:14:43,317] INFO [Log partition=ztf_20181212_programid1-1, dir=/data1-01] Completed load of log with 1 segments, log start offset 0 and log end offset 9896 in 41473 ms (kafka.log.Log)
    >   [2018-12-23 18:14:43,327] WARN [Log partition=ztf_20181213_programid1-10, dir=/data1-01] Found a corrupted index file corresponding to log file /data1-01/ztf_20181213_programid1-10/00000000000000000000.log due to Corrupt index found, index file (/data1-01/ztf_20181213_programid1-10/00000000000000000000.index) has non-zero size but the last offset is 0 which is no greater than the base offset 0.}, recovering segment and rebuilding index files... (kafka.log.Log)
    >   [2018-12-23 18:14:55,330] INFO [ProducerStateManager partition=ztf_20181212_programid1-4] Writing producer snapshot at offset 9897 (kafka.log.ProducerStateManager)
    >   [2018-12-23 18:14:55,331] INFO [Log partition=ztf_20181212_programid1-4, dir=/data2-01] Recovering unflushed segment 0 (kafka.log.Log)
    >   [2018-12-23 18:14:57,162] INFO [ProducerStateManager partition=ztf_20181212_programid1-4] Writing producer snapshot at offset 9897 (kafka.log.ProducerStateManager)
    >   [2018-12-23 18:14:57,163] INFO [Log partition=ztf_20181212_programid1-4, dir=/data2-01] Loading producer state from offset 9897 with message format version 2 (kafka.log.Log)
    >   [2018-12-23 18:14:57,164] INFO [ProducerStateManager partition=ztf_20181212_programid1-4] Loading producer state from snapshot file '/data2-01/ztf_20181212_programid1-4/00000000000000009897.snapshot' (kafka.log.ProducerStateManager)
    >   [2018-12-23 18:14:57,165] INFO [Log partition=ztf_20181212_programid1-4, dir=/data2-01] Completed load of log with 1 segments, log start offset 0 and log end offset 9897 in 41880 ms (kafka.log.Log)
    >   [2018-12-23 18:14:57,171] WARN [Log partition=ztf_20181213_programid1-6, dir=/data2-01] Found a corrupted index file corresponding to log file /data2-01/ztf_20181213_programid1-6/00000000000000000000.log due to Corrupt index found, index file (/data2-01/ztf_20181213_programid1-6/00000000000000000000.index) has non-zero size but the last offset is 0 which is no greater than the base offset 0.}, recovering segment and rebuilding index files... (kafka.log.Log)


# -----------------------------------------------------
# Kafka debug logs stabilize ...
#[user@trop03]

    >   [2018-12-23 18:49:45,280] DEBUG [Controller id=3] Topics not in preferred replica for broker 2 Map() (kafka.controller.KafkaController)
    >   [2018-12-23 18:49:45,280] TRACE [Controller id=3] Leader imbalance ratio for broker 2 is 0.0 (kafka.controller.KafkaController)
    >   [2018-12-23 18:49:45,280] DEBUG [Controller id=3] Topics not in preferred replica for broker 4 Map() (kafka.controller.KafkaController)
    >   [2018-12-23 18:49:45,280] TRACE [Controller id=3] Leader imbalance ratio for broker 4 is 0.0 (kafka.controller.KafkaController)
    >   [2018-12-23 18:49:45,280] DEBUG [Controller id=3] Topics not in preferred replica for broker 1 Map() (kafka.controller.KafkaController)
    >   [2018-12-23 18:49:45,280] TRACE [Controller id=3] Leader imbalance ratio for broker 1 is 0.0 (kafka.controller.KafkaController)
    >   [2018-12-23 18:49:45,280] DEBUG [Controller id=3] Topics not in preferred replica for broker 3 Map() (kafka.controller.KafkaController)
    >   [2018-12-23 18:49:45,281] TRACE [Controller id=3] Leader imbalance ratio for broker 3 is 0.0 (kafka.controller.KafkaController)

    >   [2018-12-23 18:44:45,565] INFO [Log partition=ztf_20181215_programid1-11, dir=/data2-01] Truncating to 640 has no effect as the largest offset in the log is 639 (kafka.log.Log)
    >   [2018-12-23 18:44:45,565] WARN [ReplicaFetcher replicaId=4, leaderId=3, fetcherId=0] Based on follower's leader epoch, leader replied with an unknown offset in ztf_20181219_programid1-14. The initial fetch offset 0 will be used for truncation. (kafka.server.ReplicaFetcherThread)
    >   [2018-12-23 18:44:45,565] INFO [Log partition=ztf_20181219_programid1-14, dir=/data2-02] Truncating to 0 has no effect as the largest offset in the log is -1 (kafka.log.Log)

    >   [2018-12-23 18:44:45,520] INFO [Log partition=ztf_20181216_programid1-7, dir=/data1-01] Truncating to 8650 has no effect as the largest offset in the log is 8649 (kafka.log.Log)
    >   [2018-12-23 18:44:45,520] INFO [ReplicaFetcher replicaId=2, leaderId=3, fetcherId=0] Based on follower's leader epoch, leader replied with an offset 6744 >= the follower's log end offset 6744 in ztf_20181210_programid1-10. No truncation needed. (kafka.server.ReplicaFetcherThread)
    >   [2018-12-23 18:44:45,520] INFO [Log partition=ztf_20181210_programid1-10, dir=/data1-01] Truncating to 6744 has no effect as the largest offset in the log is 6743 (kafka.log.Log)
    >   [2018-12-23 18:52:24,569] INFO [GroupMetadataManager brokerId=2] Removed 0 expired offsets in 0 milliseconds. (kafka.coordinator.group.GroupMetadataManager)

    >   [2018-12-23 18:44:45,644] INFO [Log partition=ztf_20181215_programid1-7, dir=/data1-01] Truncating to 642 has no effect as the largest offset in the log is 641 (kafka.log.Log)
    >   [2018-12-23 18:44:45,644] INFO [ReplicaFetcher replicaId=1, leaderId=3, fetcherId=0] Based on follower's leader epoch, leader replied with an offset 4205 >= the follower's log end offset 4205 in ztf_20181209_programid1-9. No truncation needed. (kafka.server.ReplicaFetcherThread)
    >   [2018-12-23 18:44:45,644] INFO [Log partition=ztf_20181209_programid1-9, dir=/data2-01] Truncating to 4205 has no effect as the largest offset in the log is 4204 (kafka.log.Log)
    >   [2018-12-23 18:49:42,122] INFO [GroupMetadataManager brokerId=1] Removed 0 expired offsets in 0 milliseconds. (kafka.coordinator.group.GroupMetadataManager)


# -----------------------------------------------------
# Check the disc use on each Kafka node.
#[user@trop03]

    for vmname in ${kfnames[@]}
        do
            ssh \
                ${sshopts[*]} \
                ${sshuser:?}@${vmname:?} \
                    "
                    echo \"---- ---- ---- ----\"
                    echo \"[\$(hostname)][\$(date)]\"

                    echo \"---- ----\"
                    du -h -d 1 \"/data1-01\"
                    echo \"---- ----\"
                    du -h -d 1 \"/data1-02\"

                    echo "---- ----"
                    du -h -d 1 \"/data2-01\"
                    echo "---- ----"
                    du -h -d 1 \"/data2-02\"
                    "
        done


    >   ---- ---- ---- ----
    >   [Stedigo][Sun 23 Dec 18:55:14 GMT 2018]
    >   ---- ----
    >   0	/data1-01/__confluent.support.metrics-0
    >   715M	/data1-01/ztf_20181205_programid1-6
    >   716M	/data1-01/ztf_20181205_programid1-14
    >   715M	/data1-01/ztf_20181205_programid1-12
    >   716M	/data1-01/ztf_20181205_programid1-0
    >   715M	/data1-01/ztf_20181205_programid1-4
    >   716M	/data1-01/ztf_20181205_programid1-1
    >   269M	/data1-01/ztf_20181209_programid1-7
    >   269M	/data1-01/ztf_20181209_programid1-15
    >   269M	/data1-01/ztf_20181209_programid1-14
    >   269M	/data1-01/ztf_20181209_programid1-5
    >   269M	/data1-01/ztf_20181209_programid1-12
    >   269M	/data1-01/ztf_20181209_programid1-6
    >   437M	/data1-01/ztf_20181210_programid1-0
    >   437M	/data1-01/ztf_20181210_programid1-8
    >   437M	/data1-01/ztf_20181210_programid1-9
    >   437M	/data1-01/ztf_20181210_programid1-3
    >   436M	/data1-01/ztf_20181210_programid1-5
    >   437M	/data1-01/ztf_20181210_programid1-2
    >   646M	/data1-01/ztf_20181212_programid1-2
    >   646M	/data1-01/ztf_20181212_programid1-10
    >   647M	/data1-01/ztf_20181212_programid1-12
    >   646M	/data1-01/ztf_20181212_programid1-9
    >   646M	/data1-01/ztf_20181212_programid1-7
    >   646M	/data1-01/ztf_20181212_programid1-1
    >   497M	/data1-01/ztf_20181213_programid1-10
    >   497M	/data1-01/ztf_20181213_programid1-2
    >   497M	/data1-01/ztf_20181213_programid1-9
    >   496M	/data1-01/ztf_20181213_programid1-4
    >   496M	/data1-01/ztf_20181213_programid1-1
    >   496M	/data1-01/ztf_20181213_programid1-11
    >   957M	/data1-01/ztf_20181214_programid1-8
    >   957M	/data1-01/ztf_20181214_programid1-0
    >   957M	/data1-01/ztf_20181214_programid1-5
    >   958M	/data1-01/ztf_20181214_programid1-2
    >   957M	/data1-01/ztf_20181214_programid1-9
    >   957M	/data1-01/ztf_20181214_programid1-3
    >   42M	/data1-01/ztf_20181215_programid1-9
    >   42M	/data1-01/ztf_20181215_programid1-1
    >   42M	/data1-01/ztf_20181215_programid1-15
    >   42M	/data1-01/ztf_20181215_programid1-6
    >   42M	/data1-01/ztf_20181215_programid1-0
    >   42M	/data1-01/ztf_20181215_programid1-7
    >   561M	/data1-01/ztf_20181216_programid1-1
    >   560M	/data1-01/ztf_20181216_programid1-9
    >   560M	/data1-01/ztf_20181216_programid1-3
    >   561M	/data1-01/ztf_20181216_programid1-7
    >   560M	/data1-01/ztf_20181216_programid1-15
    >   560M	/data1-01/ztf_20181216_programid1-0
    >   992M	/data1-01/ztf_20181217_programid1-2
    >   991M	/data1-01/ztf_20181217_programid1-10
    >   992M	/data1-01/ztf_20181217_programid1-12
    >   991M	/data1-01/ztf_20181217_programid1-0
    >   991M	/data1-01/ztf_20181217_programid1-13
    >   993M	/data1-01/ztf_20181217_programid1-7
    >   30G	/data1-01
    >   ---- ----
    >   0	/data1-02/ztf_20181219_programid1-10
    >   0	/data1-02/ztf_20181219_programid1-4
    >   72K	/data1-02/ztf_20181219_programid1-8
    >   0	/data1-02/ztf_20181219_programid1-12
    >   144K	/data1-02/ztf_20181219_programid1-6
    >   0	/data1-02/ztf_20181219_programid1-0
    >   248K	/data1-02
    >   ---- ----
    >   716M	/data2-01/ztf_20181205_programid1-2
    >   716M	/data2-01/ztf_20181205_programid1-10
    >   715M	/data2-01/ztf_20181205_programid1-11
    >   716M	/data2-01/ztf_20181205_programid1-9
    >   716M	/data2-01/ztf_20181205_programid1-7
    >   715M	/data2-01/ztf_20181205_programid1-13
    >   269M	/data2-01/ztf_20181209_programid1-3
    >   269M	/data2-01/ztf_20181209_programid1-11
    >   269M	/data2-01/ztf_20181209_programid1-0
    >   269M	/data2-01/ztf_20181209_programid1-8
    >   269M	/data2-01/ztf_20181209_programid1-2
    >   269M	/data2-01/ztf_20181209_programid1-9
    >   436M	/data2-01/ztf_20181210_programid1-12
    >   436M	/data2-01/ztf_20181210_programid1-4
    >   437M	/data2-01/ztf_20181210_programid1-15
    >   437M	/data2-01/ztf_20181210_programid1-6
    >   436M	/data2-01/ztf_20181210_programid1-14
    >   437M	/data2-01/ztf_20181210_programid1-11
    >   647M	/data2-01/ztf_20181212_programid1-14
    >   647M	/data2-01/ztf_20181212_programid1-6
    >   646M	/data2-01/ztf_20181212_programid1-11
    >   646M	/data2-01/ztf_20181212_programid1-0
    >   646M	/data2-01/ztf_20181212_programid1-13
    >   646M	/data2-01/ztf_20181212_programid1-4
    >   496M	/data2-01/ztf_20181213_programid1-6
    >   496M	/data2-01/ztf_20181213_programid1-14
    >   496M	/data2-01/ztf_20181213_programid1-12
    >   497M	/data2-01/ztf_20181213_programid1-0
    >   496M	/data2-01/ztf_20181213_programid1-13
    >   496M	/data2-01/ztf_20181213_programid1-7
    >   957M	/data2-01/ztf_20181214_programid1-4
    >   957M	/data2-01/ztf_20181214_programid1-12
    >   957M	/data2-01/ztf_20181214_programid1-11
    >   957M	/data2-01/ztf_20181214_programid1-14
    >   958M	/data2-01/ztf_20181214_programid1-15
    >   958M	/data2-01/ztf_20181214_programid1-6
    >   42M	/data2-01/ztf_20181215_programid1-5
    >   42M	/data2-01/ztf_20181215_programid1-13
    >   42M	/data2-01/ztf_20181215_programid1-8
    >   42M	/data2-01/ztf_20181215_programid1-12
    >   42M	/data2-01/ztf_20181215_programid1-3
    >   42M	/data2-01/ztf_20181215_programid1-10
    >   560M	/data2-01/ztf_20181216_programid1-13
    >   560M	/data2-01/ztf_20181216_programid1-5
    >   560M	/data2-01/ztf_20181216_programid1-6
    >   560M	/data2-01/ztf_20181216_programid1-10
    >   560M	/data2-01/ztf_20181216_programid1-8
    >   560M	/data2-01/ztf_20181216_programid1-12
    >   992M	/data2-01/ztf_20181217_programid1-14
    >   992M	/data2-01/ztf_20181217_programid1-6
    >   993M	/data2-01/ztf_20181217_programid1-11
    >   992M	/data2-01/ztf_20181217_programid1-9
    >   992M	/data2-01/ztf_20181217_programid1-4
    >   992M	/data2-01/ztf_20181217_programid1-1
    >   30G	/data2-01
    >   ---- ----
    >   16K	/data2-02
    >   ---- ---- ---- ----
    >   [Angece][Sun 23 Dec 18:55:14 GMT 2018]
    >   ---- ----
    >   0	/data1-01/__confluent.support.metrics-0
    >   715M	/data1-01/ztf_20181205_programid1-15
    >   716M	/data1-01/ztf_20181205_programid1-7
    >   715M	/data1-01/ztf_20181205_programid1-5
    >   716M	/data1-01/ztf_20181205_programid1-10
    >   715M	/data1-01/ztf_20181205_programid1-13
    >   716M	/data1-01/ztf_20181205_programid1-14
    >   269M	/data1-01/ztf_20181209_programid1-4
    >   269M	/data1-01/ztf_20181209_programid1-12
    >   269M	/data1-01/ztf_20181209_programid1-13
    >   269M	/data1-01/ztf_20181209_programid1-7
    >   269M	/data1-01/ztf_20181209_programid1-15
    >   269M	/data1-01/ztf_20181209_programid1-6
    >   437M	/data1-01/ztf_20181210_programid1-13
    >   436M	/data1-01/ztf_20181210_programid1-5
    >   436M	/data1-01/ztf_20181210_programid1-12
    >   437M	/data1-01/ztf_20181210_programid1-3
    >   437M	/data1-01/ztf_20181210_programid1-10
    >   437M	/data1-01/ztf_20181210_programid1-8
    >   646M	/data1-01/ztf_20181212_programid1-15
    >   646M	/data1-01/ztf_20181212_programid1-7
    >   646M	/data1-01/ztf_20181212_programid1-8
    >   646M	/data1-01/ztf_20181212_programid1-2
    >   646M	/data1-01/ztf_20181212_programid1-10
    >   646M	/data1-01/ztf_20181212_programid1-1
    >   496M	/data1-01/ztf_20181213_programid1-7
    >   496M	/data1-01/ztf_20181213_programid1-15
    >   496M	/data1-01/ztf_20181213_programid1-13
    >   497M	/data1-01/ztf_20181213_programid1-10
    >   496M	/data1-01/ztf_20181213_programid1-8
    >   497M	/data1-01/ztf_20181213_programid1-2
    >   957M	/data1-01/ztf_20181214_programid1-5
    >   957M	/data1-01/ztf_20181214_programid1-13
    >   957M	/data1-01/ztf_20181214_programid1-7
    >   958M	/data1-01/ztf_20181214_programid1-15
    >   958M	/data1-01/ztf_20181214_programid1-6
    >   957M	/data1-01/ztf_20181214_programid1-0
    >   42M	/data1-01/ztf_20181215_programid1-6
    >   42M	/data1-01/ztf_20181215_programid1-14
    >   42M	/data1-01/ztf_20181215_programid1-9
    >   42M	/data1-01/ztf_20181215_programid1-13
    >   42M	/data1-01/ztf_20181215_programid1-4
    >   42M	/data1-01/ztf_20181215_programid1-11
    >   560M	/data1-01/ztf_20181216_programid1-10
    >   560M	/data1-01/ztf_20181216_programid1-2
    >   561M	/data1-01/ztf_20181216_programid1-7
    >   561M	/data1-01/ztf_20181216_programid1-1
    >   560M	/data1-01/ztf_20181216_programid1-12
    >   560M	/data1-01/ztf_20181216_programid1-9
    >   993M	/data1-01/ztf_20181217_programid1-15
    >   993M	/data1-01/ztf_20181217_programid1-7
    >   991M	/data1-01/ztf_20181217_programid1-8
    >   992M	/data1-01/ztf_20181217_programid1-2
    >   991M	/data1-01/ztf_20181217_programid1-13
    >   992M	/data1-01/ztf_20181217_programid1-1
    >   30G	/data1-01
    >   ---- ----
    >   0	/data1-02/ztf_20181219_programid1-10
    >   0	/data1-02/ztf_20181219_programid1-4
    >   0	/data1-02/ztf_20181219_programid1-14
    >   0	/data1-02/ztf_20181219_programid1-5
    >   0	/data1-02/ztf_20181219_programid1-12
    >   0	/data1-02/ztf_20181219_programid1-0
    >   32K	/data1-02
    >   ---- ----
    >   715M	/data2-01/ztf_20181205_programid1-11
    >   715M	/data2-01/ztf_20181205_programid1-3
    >   716M	/data2-01/ztf_20181205_programid1-8
    >   716M	/data2-01/ztf_20181205_programid1-2
    >   715M	/data2-01/ztf_20181205_programid1-4
    >   716M	/data2-01/ztf_20181205_programid1-1
    >   269M	/data2-01/ztf_20181209_programid1-0
    >   269M	/data2-01/ztf_20181209_programid1-8
    >   269M	/data2-01/ztf_20181209_programid1-3
    >   269M	/data2-01/ztf_20181209_programid1-10
    >   269M	/data2-01/ztf_20181209_programid1-1
    >   269M	/data2-01/ztf_20181209_programid1-9
    >   437M	/data2-01/ztf_20181210_programid1-9
    >   437M	/data2-01/ztf_20181210_programid1-1
    >   437M	/data2-01/ztf_20181210_programid1-15
    >   437M	/data2-01/ztf_20181210_programid1-6
    >   437M	/data2-01/ztf_20181210_programid1-0
    >   437M	/data2-01/ztf_20181210_programid1-7
    >   646M	/data2-01/ztf_20181212_programid1-11
    >   646M	/data2-01/ztf_20181212_programid1-3
    >   647M	/data2-01/ztf_20181212_programid1-14
    >   646M	/data2-01/ztf_20181212_programid1-5
    >   646M	/data2-01/ztf_20181212_programid1-13
    >   646M	/data2-01/ztf_20181212_programid1-4
    >   496M	/data2-01/ztf_20181213_programid1-3
    >   496M	/data2-01/ztf_20181213_programid1-11
    >   496M	/data2-01/ztf_20181213_programid1-4
    >   496M	/data2-01/ztf_20181213_programid1-1
    >   496M	/data2-01/ztf_20181213_programid1-14
    >   496M	/data2-01/ztf_20181213_programid1-5
    >   958M	/data2-01/ztf_20181214_programid1-1
    >   957M	/data2-01/ztf_20181214_programid1-9
    >   958M	/data2-01/ztf_20181214_programid1-10
    >   957M	/data2-01/ztf_20181214_programid1-8
    >   957M	/data2-01/ztf_20181214_programid1-12
    >   957M	/data2-01/ztf_20181214_programid1-3
    >   42M	/data2-01/ztf_20181215_programid1-2
    >   42M	/data2-01/ztf_20181215_programid1-10
    >   42M	/data2-01/ztf_20181215_programid1-12
    >   42M	/data2-01/ztf_20181215_programid1-0
    >   42M	/data2-01/ztf_20181215_programid1-7
    >   42M	/data2-01/ztf_20181215_programid1-1
    >   560M	/data2-01/ztf_20181216_programid1-6
    >   560M	/data2-01/ztf_20181216_programid1-14
    >   560M	/data2-01/ztf_20181216_programid1-13
    >   560M	/data2-01/ztf_20181216_programid1-4
    >   560M	/data2-01/ztf_20181216_programid1-11
    >   560M	/data2-01/ztf_20181216_programid1-0
    >   993M	/data2-01/ztf_20181217_programid1-11
    >   993M	/data2-01/ztf_20181217_programid1-3
    >   992M	/data2-01/ztf_20181217_programid1-14
    >   992M	/data2-01/ztf_20181217_programid1-5
    >   992M	/data2-01/ztf_20181217_programid1-4
    >   991M	/data2-01/ztf_20181217_programid1-10
    >   30G	/data2-01
    >   ---- ----
    >   16K	/data2-02
    >   ---- ---- ---- ----
    >   [Edwalafia][Sun 23 Dec 18:55:15 GMT 2018]
    >   ---- ----
    >   0	/data1-01/__confluent.support.metrics-0
    >   715M	/data1-01/ztf_20181205_programid1-12
    >   715M	/data1-01/ztf_20181205_programid1-4
    >   715M	/data1-01/ztf_20181205_programid1-5
    >   715M	/data1-01/ztf_20181205_programid1-15
    >   715M	/data1-01/ztf_20181205_programid1-6
    >   716M	/data1-01/ztf_20181205_programid1-14
    >   269M	/data1-01/ztf_20181209_programid1-1
    >   269M	/data1-01/ztf_20181209_programid1-9
    >   269M	/data1-01/ztf_20181209_programid1-10
    >   269M	/data1-01/ztf_20181209_programid1-4
    >   269M	/data1-01/ztf_20181209_programid1-11
    >   269M	/data1-01/ztf_20181209_programid1-12
    >   437M	/data1-01/ztf_20181210_programid1-10
    >   437M	/data1-01/ztf_20181210_programid1-2
    >   437M	/data1-01/ztf_20181210_programid1-9
    >   437M	/data1-01/ztf_20181210_programid1-13
    >   436M	/data1-01/ztf_20181210_programid1-4
    >   437M	/data1-01/ztf_20181210_programid1-11
    >   647M	/data1-01/ztf_20181212_programid1-12
    >   646M	/data1-01/ztf_20181212_programid1-4
    >   646M	/data1-01/ztf_20181212_programid1-11
    >   646M	/data1-01/ztf_20181212_programid1-2
    >   646M	/data1-01/ztf_20181212_programid1-9
    >   646M	/data1-01/ztf_20181212_programid1-3
    >   497M	/data1-01/ztf_20181213_programid1-0
    >   496M	/data1-01/ztf_20181213_programid1-8
    >   496M	/data1-01/ztf_20181213_programid1-6
    >   496M	/data1-01/ztf_20181213_programid1-14
    >   496M	/data1-01/ztf_20181213_programid1-5
    >   496M	/data1-01/ztf_20181213_programid1-15
    >   957M	/data1-01/ztf_20181214_programid1-14
    >   958M	/data1-01/ztf_20181214_programid1-6
    >   957M	/data1-01/ztf_20181214_programid1-4
    >   957M	/data1-01/ztf_20181214_programid1-11
    >   957M	/data1-01/ztf_20181214_programid1-9
    >   957M	/data1-01/ztf_20181214_programid1-13
    >   42M	/data1-01/ztf_20181215_programid1-3
    >   42M	/data1-01/ztf_20181215_programid1-11
    >   42M	/data1-01/ztf_20181215_programid1-5
    >   42M	/data1-01/ztf_20181215_programid1-13
    >   42M	/data1-01/ztf_20181215_programid1-4
    >   42M	/data1-01/ztf_20181215_programid1-14
    >   561M	/data1-01/ztf_20181216_programid1-7
    >   560M	/data1-01/ztf_20181216_programid1-15
    >   560M	/data1-01/ztf_20181216_programid1-10
    >   561M	/data1-01/ztf_20181216_programid1-1
    >   560M	/data1-01/ztf_20181216_programid1-8
    >   560M	/data1-01/ztf_20181216_programid1-2
    >   992M	/data1-01/ztf_20181217_programid1-12
    >   992M	/data1-01/ztf_20181217_programid1-4
    >   993M	/data1-01/ztf_20181217_programid1-11
    >   992M	/data1-01/ztf_20181217_programid1-2
    >   992M	/data1-01/ztf_20181217_programid1-9
    >   993M	/data1-01/ztf_20181217_programid1-3
    >   30G	/data1-01
    >   ---- ----
    >   0	/data1-02/ztf_20181219_programid1-10
    >   0	/data1-02/ztf_20181219_programid1-1
    >   0	/data1-02/ztf_20181219_programid1-11
    >   0	/data1-02/ztf_20181219_programid1-5
    >   0	/data1-02/ztf_20181219_programid1-2
    >   0	/data1-02/ztf_20181219_programid1-3
    >   32K	/data1-02
    >   ---- ----
    >   716M	/data2-01/ztf_20181205_programid1-8
    >   716M	/data2-01/ztf_20181205_programid1-0
    >   715M	/data2-01/ztf_20181205_programid1-11
    >   716M	/data2-01/ztf_20181205_programid1-2
    >   716M	/data2-01/ztf_20181205_programid1-9
    >   715M	/data2-01/ztf_20181205_programid1-3
    >   269M	/data2-01/ztf_20181209_programid1-13
    >   269M	/data2-01/ztf_20181209_programid1-5
    >   269M	/data2-01/ztf_20181209_programid1-0
    >   269M	/data2-01/ztf_20181209_programid1-7
    >   269M	/data2-01/ztf_20181209_programid1-14
    >   269M	/data2-01/ztf_20181209_programid1-2
    >   437M	/data2-01/ztf_20181210_programid1-6
    >   436M	/data2-01/ztf_20181210_programid1-14
    >   436M	/data2-01/ztf_20181210_programid1-12
    >   437M	/data2-01/ztf_20181210_programid1-0
    >   437M	/data2-01/ztf_20181210_programid1-7
    >   437M	/data2-01/ztf_20181210_programid1-1
    >   646M	/data2-01/ztf_20181212_programid1-8
    >   646M	/data2-01/ztf_20181212_programid1-0
    >   647M	/data2-01/ztf_20181212_programid1-14
    >   646M	/data2-01/ztf_20181212_programid1-5
    >   646M	/data2-01/ztf_20181212_programid1-15
    >   647M	/data2-01/ztf_20181212_programid1-6
    >   496M	/data2-01/ztf_20181213_programid1-12
    >   496M	/data2-01/ztf_20181213_programid1-4
    >   497M	/data2-01/ztf_20181213_programid1-9
    >   496M	/data2-01/ztf_20181213_programid1-3
    >   496M	/data2-01/ztf_20181213_programid1-11
    >   497M	/data2-01/ztf_20181213_programid1-2
    >   958M	/data2-01/ztf_20181214_programid1-10
    >   958M	/data2-01/ztf_20181214_programid1-2
    >   957M	/data2-01/ztf_20181214_programid1-7
    >   958M	/data2-01/ztf_20181214_programid1-1
    >   957M	/data2-01/ztf_20181214_programid1-12
    >   957M	/data2-01/ztf_20181214_programid1-0
    >   42M	/data2-01/ztf_20181215_programid1-15
    >   42M	/data2-01/ztf_20181215_programid1-7
    >   42M	/data2-01/ztf_20181215_programid1-8
    >   42M	/data2-01/ztf_20181215_programid1-2
    >   42M	/data2-01/ztf_20181215_programid1-10
    >   42M	/data2-01/ztf_20181215_programid1-1
    >   560M	/data2-01/ztf_20181216_programid1-3
    >   560M	/data2-01/ztf_20181216_programid1-11
    >   560M	/data2-01/ztf_20181216_programid1-13
    >   560M	/data2-01/ztf_20181216_programid1-4
    >   560M	/data2-01/ztf_20181216_programid1-14
    >   560M	/data2-01/ztf_20181216_programid1-5
    >   991M	/data2-01/ztf_20181217_programid1-8
    >   991M	/data2-01/ztf_20181217_programid1-0
    >   992M	/data2-01/ztf_20181217_programid1-14
    >   992M	/data2-01/ztf_20181217_programid1-5
    >   993M	/data2-01/ztf_20181217_programid1-15
    >   992M	/data2-01/ztf_20181217_programid1-6
    >   30G	/data2-01
    >   ---- ----
    >   16K	/data2-02
    >   ---- ---- ---- ----
    >   [Onoza][Sun 23 Dec 18:55:15 GMT 2018]
    >   ---- ----
    >   715M	/data1-01/ztf_20181205_programid1-5
    >   715M	/data1-01/ztf_20181205_programid1-13
    >   716M	/data1-01/ztf_20181205_programid1-8
    >   715M	/data1-01/ztf_20181205_programid1-12
    >   715M	/data1-01/ztf_20181205_programid1-3
    >   716M	/data1-01/ztf_20181205_programid1-10
    >   269M	/data1-01/ztf_20181209_programid1-10
    >   269M	/data1-01/ztf_20181209_programid1-2
    >   269M	/data1-01/ztf_20181209_programid1-3
    >   269M	/data1-01/ztf_20181209_programid1-4
    >   269M	/data1-01/ztf_20181209_programid1-11
    >   269M	/data1-01/ztf_20181209_programid1-5
    >   437M	/data1-01/ztf_20181210_programid1-15
    >   437M	/data1-01/ztf_20181210_programid1-7
    >   437M	/data1-01/ztf_20181210_programid1-13
    >   436M	/data1-01/ztf_20181210_programid1-4
    >   437M	/data1-01/ztf_20181210_programid1-8
    >   436M	/data1-01/ztf_20181210_programid1-5
    >   646M	/data1-01/ztf_20181212_programid1-5
    >   646M	/data1-01/ztf_20181212_programid1-13
    >   646M	/data1-01/ztf_20181212_programid1-8
    >   647M	/data1-01/ztf_20181212_programid1-12
    >   647M	/data1-01/ztf_20181212_programid1-6
    >   646M	/data1-01/ztf_20181212_programid1-10
    >   497M	/data1-01/ztf_20181213_programid1-9
    >   496M	/data1-01/ztf_20181213_programid1-1
    >   496M	/data1-01/ztf_20181213_programid1-12
    >   496M	/data1-01/ztf_20181213_programid1-3
    >   497M	/data1-01/ztf_20181213_programid1-10
    >   496M	/data1-01/ztf_20181213_programid1-8
    >   957M	/data1-01/ztf_20181214_programid1-7
    >   958M	/data1-01/ztf_20181214_programid1-15
    >   958M	/data1-01/ztf_20181214_programid1-10
    >   958M	/data1-01/ztf_20181214_programid1-1
    >   957M	/data1-01/ztf_20181214_programid1-5
    >   958M	/data1-01/ztf_20181214_programid1-2
    >   42M	/data1-01/ztf_20181215_programid1-8
    >   42M	/data1-01/ztf_20181215_programid1-0
    >   42M	/data1-01/ztf_20181215_programid1-15
    >   42M	/data1-01/ztf_20181215_programid1-2
    >   42M	/data1-01/ztf_20181215_programid1-6
    >   42M	/data1-01/ztf_20181215_programid1-14
    >   560M	/data1-01/ztf_20181216_programid1-4
    >   560M	/data1-01/ztf_20181216_programid1-12
    >   560M	/data1-01/ztf_20181216_programid1-6
    >   560M	/data1-01/ztf_20181216_programid1-14
    >   560M	/data1-01/ztf_20181216_programid1-5
    >   560M	/data1-01/ztf_20181216_programid1-15
    >   992M	/data1-01/ztf_20181217_programid1-5
    >   991M	/data1-01/ztf_20181217_programid1-13
    >   991M	/data1-01/ztf_20181217_programid1-8
    >   992M	/data1-01/ztf_20181217_programid1-12
    >   993M	/data1-01/ztf_20181217_programid1-3
    >   991M	/data1-01/ztf_20181217_programid1-10
    >   30G	/data1-01
    >   ---- ----
    >   0	/data1-02/ztf_20181219_programid1-7
    >   0	/data1-02/ztf_20181219_programid1-11
    >   0	/data1-02/ztf_20181219_programid1-5
    >   0	/data1-02/ztf_20181219_programid1-2
    >   0	/data1-02/ztf_20181219_programid1-9
    >   0	/data1-02/ztf_20181219_programid1-3
    >   32K	/data1-02
    >   ---- ----
    >   716M	/data2-01/ztf_20181205_programid1-9
    >   716M	/data2-01/ztf_20181205_programid1-1
    >   715M	/data2-01/ztf_20181205_programid1-15
    >   715M	/data2-01/ztf_20181205_programid1-6
    >   716M	/data2-01/ztf_20181205_programid1-0
    >   716M	/data2-01/ztf_20181205_programid1-7
    >   269M	/data2-01/ztf_20181209_programid1-14
    >   269M	/data2-01/ztf_20181209_programid1-6
    >   269M	/data2-01/ztf_20181209_programid1-13
    >   269M	/data2-01/ztf_20181209_programid1-1
    >   269M	/data2-01/ztf_20181209_programid1-8
    >   269M	/data2-01/ztf_20181209_programid1-15
    >   437M	/data2-01/ztf_20181210_programid1-3
    >   437M	/data2-01/ztf_20181210_programid1-11
    >   437M	/data2-01/ztf_20181210_programid1-10
    >   437M	/data2-01/ztf_20181210_programid1-1
    >   436M	/data2-01/ztf_20181210_programid1-14
    >   437M	/data2-01/ztf_20181210_programid1-2
    >   646M	/data2-01/ztf_20181212_programid1-9
    >   646M	/data2-01/ztf_20181212_programid1-1
    >   646M	/data2-01/ztf_20181212_programid1-15
    >   646M	/data2-01/ztf_20181212_programid1-0
    >   646M	/data2-01/ztf_20181212_programid1-3
    >   646M	/data2-01/ztf_20181212_programid1-7
    >   496M	/data2-01/ztf_20181213_programid1-13
    >   496M	/data2-01/ztf_20181213_programid1-5
    >   496M	/data2-01/ztf_20181213_programid1-6
    >   497M	/data2-01/ztf_20181213_programid1-0
    >   496M	/data2-01/ztf_20181213_programid1-7
    >   496M	/data2-01/ztf_20181213_programid1-15
    >   957M	/data2-01/ztf_20181214_programid1-11
    >   957M	/data2-01/ztf_20181214_programid1-3
    >   957M	/data2-01/ztf_20181214_programid1-4
    >   957M	/data2-01/ztf_20181214_programid1-8
    >   957M	/data2-01/ztf_20181214_programid1-14
    >   957M	/data2-01/ztf_20181214_programid1-13
    >   42M	/data2-01/ztf_20181215_programid1-12
    >   42M	/data2-01/ztf_20181215_programid1-4
    >   42M	/data2-01/ztf_20181215_programid1-5
    >   42M	/data2-01/ztf_20181215_programid1-9
    >   42M	/data2-01/ztf_20181215_programid1-3
    >   42M	/data2-01/ztf_20181215_programid1-11
    >   560M	/data2-01/ztf_20181216_programid1-8
    >   560M	/data2-01/ztf_20181216_programid1-0
    >   560M	/data2-01/ztf_20181216_programid1-3
    >   560M	/data2-01/ztf_20181216_programid1-11
    >   560M	/data2-01/ztf_20181216_programid1-2
    >   560M	/data2-01/ztf_20181216_programid1-9
    >   992M	/data2-01/ztf_20181217_programid1-9
    >   992M	/data2-01/ztf_20181217_programid1-1
    >   993M	/data2-01/ztf_20181217_programid1-15
    >   992M	/data2-01/ztf_20181217_programid1-6
    >   991M	/data2-01/ztf_20181217_programid1-0
    >   993M	/data2-01/ztf_20181217_programid1-7
    >   30G	/data2-01
    >   ---- ----
    >   16K	/data2-02


# -----------------------------------------------------
# Update the topic and restart MirrorMaker on each node.
#[user@trop03]

    ztftopicid=ztf_20181218_programid1
    ztftopicid=ztf_20181219_programid1

    for vmname in ${mmnames[@]}
        do
            echo "---- ----"
            echo "vmname [${vmname:?}]"
            ssh \
                ${scpopts[*]} \
                ${sshuser:?}@${vmname:?} \
                "
                docker-compose \
                    --file mirror.yml \
                    down
                sed -i \"
                    s/^ztftopicid=.*/ztftopicid=${ztftopicid:?}/
                    \" mirror.env
                docker-compose \
                    --file mirror.yml \
                    up -d
                "
        done


    >   ---- ----
    >   vmname [Afoaviel]
    >   Removing stevedore_tina_1 ... done
    >   Removing network stevedore_default
    >   Creating network "stevedore_default" with the default driver
    >   Creating stevedore_tina_1 ... done
    >   ---- ----
    >   vmname [Rusaldez]
    >   Removing stevedore_tina_1 ... done
    >   Removing network stevedore_default
    >   Creating network "stevedore_default" with the default driver
    >   Creating stevedore_tina_1 ... done


# -----------------------------------------------------
# Check our client offsets in the ZTF broker.
#[user@trop03]

    devnode=Rusaldez

    ztfconnect=public.alerts.ztf.uw.edu:9092
    roegroupid=ztf-mirror.roe.ac.uk

    date ; \
    ssh \
        ${sshopts[*]} \
        ${sshuser:?}@${devnode:?} \
        "
        docker run --rm phymatopus/kafka-core \
            bin/kafka-consumer-groups.sh \
                --bootstrap-server "${ztfconnect:?}" \
                --describe \
                --group "${roegroupid:?}"
         " \
    | sort \
    ; date


    >   Sun 23 Dec 18:58:29 GMT 2018
    >   TOPIC                   PARTITION  CURRENT-OFFSET  LOG-END-OFFSET  LAG             CONSUMER-ID                                                 HOST            CLIENT-ID
    >   ztf_20181219_programid1 0          243             20858           20615           ztf-mirror.roe.ac.uk-0-28c360df-3013-470a-8bc3-f0c7e0110c69 /129.215.175.98 ztf-mirror.roe.ac.uk-0
    >   ztf_20181219_programid1 10         199             20859           20660           ztf-mirror.roe.ac.uk-1-2c096f42-2ab9-431a-ae88-1357b8873c35 /129.215.175.98 ztf-mirror.roe.ac.uk-1
    >   ztf_20181219_programid1 11         242             20858           20616           ztf-mirror.roe.ac.uk-1-b56e5897-5ca5-497f-9a8a-c9b7b7480b23 /129.215.175.98 ztf-mirror.roe.ac.uk-1
    >   ztf_20181219_programid1 1          198             20859           20661           ztf-mirror.roe.ac.uk-0-ce193fc9-da42-4670-960a-ccaa127ace9c /129.215.175.98 ztf-mirror.roe.ac.uk-0
    >   ztf_20181219_programid1 12         198             20858           20660           ztf-mirror.roe.ac.uk-2-0cb6e6b8-d534-4a14-9a55-9af2d321bb50 /129.215.175.98 ztf-mirror.roe.ac.uk-2
    >   ztf_20181219_programid1 13         242             20859           20617           ztf-mirror.roe.ac.uk-2-3fecac00-538a-418e-b6e4-73beef1580dd /129.215.175.98 ztf-mirror.roe.ac.uk-2
    >   ztf_20181219_programid1 2          199             20858           20659           ztf-mirror.roe.ac.uk-1-2c096f42-2ab9-431a-ae88-1357b8873c35 /129.215.175.98 ztf-mirror.roe.ac.uk-1
    >   ztf_20181219_programid1 3          243             20859           20616           ztf-mirror.roe.ac.uk-1-b56e5897-5ca5-497f-9a8a-c9b7b7480b23 /129.215.175.98 ztf-mirror.roe.ac.uk-1
    >   ztf_20181219_programid1 4          201             20859           20658           ztf-mirror.roe.ac.uk-2-0cb6e6b8-d534-4a14-9a55-9af2d321bb50 /129.215.175.98 ztf-mirror.roe.ac.uk-2
    >   ztf_20181219_programid1 5          244             20858           20614           ztf-mirror.roe.ac.uk-2-3fecac00-538a-418e-b6e4-73beef1580dd /129.215.175.98 ztf-mirror.roe.ac.uk-2
    >   ztf_20181219_programid1 6          477             20858           20381           ztf-mirror.roe.ac.uk-3-60cba15d-0bad-41bc-8c6e-fb0849800aee /129.215.175.98 ztf-mirror.roe.ac.uk-3
    >   ztf_20181219_programid1 7          412             20859           20447           ztf-mirror.roe.ac.uk-3-e2c87d6f-e332-4b42-a888-c2fa39f8d2bb /129.215.175.98 ztf-mirror.roe.ac.uk-3
    >   ztf_20181219_programid1 8          245             20858           20613           ztf-mirror.roe.ac.uk-0-28c360df-3013-470a-8bc3-f0c7e0110c69 /129.215.175.98 ztf-mirror.roe.ac.uk-0
    >   ztf_20181219_programid1 9          201             20859           20658           ztf-mirror.roe.ac.uk-0-ce193fc9-da42-4670-960a-ccaa127ace9c /129.215.175.98 ztf-mirror.roe.ac.uk-0
    >   Sun 23 Dec 18:58:37 GMT 2018


    >   Sun 23 Dec 19:00:44 GMT 2018
    >   TOPIC                   PARTITION  CURRENT-OFFSET  LOG-END-OFFSET  LAG             CONSUMER-ID                                                 HOST            CLIENT-ID
    >   ztf_20181219_programid1 0          774             20858           20084           ztf-mirror.roe.ac.uk-0-28c360df-3013-470a-8bc3-f0c7e0110c69 /129.215.175.98 ztf-mirror.roe.ac.uk-0
    >   ztf_20181219_programid1 10         711             20859           20148           ztf-mirror.roe.ac.uk-1-2c096f42-2ab9-431a-ae88-1357b8873c35 /129.215.175.98 ztf-mirror.roe.ac.uk-1
    >   ztf_20181219_programid1 11         773             20858           20085           ztf-mirror.roe.ac.uk-1-b56e5897-5ca5-497f-9a8a-c9b7b7480b23 /129.215.175.98 ztf-mirror.roe.ac.uk-1
    >   ztf_20181219_programid1 12         728             20858           20130           ztf-mirror.roe.ac.uk-2-0cb6e6b8-d534-4a14-9a55-9af2d321bb50 /129.215.175.98 ztf-mirror.roe.ac.uk-2
    >   ztf_20181219_programid1 13         750             20859           20109           ztf-mirror.roe.ac.uk-2-3fecac00-538a-418e-b6e4-73beef1580dd /129.215.175.98 ztf-mirror.roe.ac.uk-2
    >   ztf_20181219_programid1 1          709             20859           20150           ztf-mirror.roe.ac.uk-0-ce193fc9-da42-4670-960a-ccaa127ace9c /129.215.175.98 ztf-mirror.roe.ac.uk-0
    >   ztf_20181219_programid1 2          711             20858           20147           ztf-mirror.roe.ac.uk-1-2c096f42-2ab9-431a-ae88-1357b8873c35 /129.215.175.98 ztf-mirror.roe.ac.uk-1
    >   ztf_20181219_programid1 3          773             20859           20086           ztf-mirror.roe.ac.uk-1-b56e5897-5ca5-497f-9a8a-c9b7b7480b23 /129.215.175.98 ztf-mirror.roe.ac.uk-1
    >   ztf_20181219_programid1 4          734             20859           20125           ztf-mirror.roe.ac.uk-2-0cb6e6b8-d534-4a14-9a55-9af2d321bb50 /129.215.175.98 ztf-mirror.roe.ac.uk-2
    >   ztf_20181219_programid1 5          754             20858           20104           ztf-mirror.roe.ac.uk-2-3fecac00-538a-418e-b6e4-73beef1580dd /129.215.175.98 ztf-mirror.roe.ac.uk-2
    >   ztf_20181219_programid1 6          1510            20858           19348           ztf-mirror.roe.ac.uk-3-60cba15d-0bad-41bc-8c6e-fb0849800aee /129.215.175.98 ztf-mirror.roe.ac.uk-3
    >   ztf_20181219_programid1 7          1440            20859           19419           ztf-mirror.roe.ac.uk-3-e2c87d6f-e332-4b42-a888-c2fa39f8d2bb /129.215.175.98 ztf-mirror.roe.ac.uk-3
    >   ztf_20181219_programid1 8          776             20858           20082           ztf-mirror.roe.ac.uk-0-28c360df-3013-470a-8bc3-f0c7e0110c69 /129.215.175.98 ztf-mirror.roe.ac.uk-0
    >   ztf_20181219_programid1 9          709             20859           20150           ztf-mirror.roe.ac.uk-0-ce193fc9-da42-4670-960a-ccaa127ace9c /129.215.175.98 ztf-mirror.roe.ac.uk-0
    >   Sun 23 Dec 19:00:52 GMT 2018


    >   Sun 23 Dec 19:06:54 GMT 2018
    >   TOPIC                   PARTITION  CURRENT-OFFSET  LOG-END-OFFSET  LAG             CONSUMER-ID                                                 HOST            CLIENT-ID
    >   ztf_20181219_programid1 0          2381            20858           18477           ztf-mirror.roe.ac.uk-0-28c360df-3013-470a-8bc3-f0c7e0110c69 /129.215.175.98 ztf-mirror.roe.ac.uk-0
    >   ztf_20181219_programid1 10         2331            20859           18528           ztf-mirror.roe.ac.uk-1-2c096f42-2ab9-431a-ae88-1357b8873c35 /129.215.175.98 ztf-mirror.roe.ac.uk-1
    >   ztf_20181219_programid1 11         2373            20858           18485           ztf-mirror.roe.ac.uk-1-b56e5897-5ca5-497f-9a8a-c9b7b7480b23 /129.215.175.98 ztf-mirror.roe.ac.uk-1
    >   ztf_20181219_programid1 12         2323            20858           18535           ztf-mirror.roe.ac.uk-2-0cb6e6b8-d534-4a14-9a55-9af2d321bb50 /129.215.175.98 ztf-mirror.roe.ac.uk-2
    >   ztf_20181219_programid1 1          2327            20859           18532           ztf-mirror.roe.ac.uk-0-ce193fc9-da42-4670-960a-ccaa127ace9c /129.215.175.98 ztf-mirror.roe.ac.uk-0
    >   ztf_20181219_programid1 13         2369            20859           18490           ztf-mirror.roe.ac.uk-2-3fecac00-538a-418e-b6e4-73beef1580dd /129.215.175.98 ztf-mirror.roe.ac.uk-2
    >   ztf_20181219_programid1 2          2329            20858           18529           ztf-mirror.roe.ac.uk-1-2c096f42-2ab9-431a-ae88-1357b8873c35 /129.215.175.98 ztf-mirror.roe.ac.uk-1
    >   ztf_20181219_programid1 3          2373            20859           18486           ztf-mirror.roe.ac.uk-1-b56e5897-5ca5-497f-9a8a-c9b7b7480b23 /129.215.175.98 ztf-mirror.roe.ac.uk-1
    >   ztf_20181219_programid1 4          2331            20859           18528           ztf-mirror.roe.ac.uk-2-0cb6e6b8-d534-4a14-9a55-9af2d321bb50 /129.215.175.98 ztf-mirror.roe.ac.uk-2
    >   ztf_20181219_programid1 5          2366            20858           18492           ztf-mirror.roe.ac.uk-2-3fecac00-538a-418e-b6e4-73beef1580dd /129.215.175.98 ztf-mirror.roe.ac.uk-2
    >   ztf_20181219_programid1 6          4646            20858           16212           ztf-mirror.roe.ac.uk-3-60cba15d-0bad-41bc-8c6e-fb0849800aee /129.215.175.98 ztf-mirror.roe.ac.uk-3
    >   ztf_20181219_programid1 7          4580            20859           16279           ztf-mirror.roe.ac.uk-3-e2c87d6f-e332-4b42-a888-c2fa39f8d2bb /129.215.175.98 ztf-mirror.roe.ac.uk-3
    >   ztf_20181219_programid1 8          2375            20858           18483           ztf-mirror.roe.ac.uk-0-28c360df-3013-470a-8bc3-f0c7e0110c69 /129.215.175.98 ztf-mirror.roe.ac.uk-0
    >   ztf_20181219_programid1 9          2324            20859           18535           ztf-mirror.roe.ac.uk-0-ce193fc9-da42-4670-960a-ccaa127ace9c /129.215.175.98 ztf-mirror.roe.ac.uk-0
    >   Sun 23 Dec 19:07:02 GMT 2018


    >   Sun 23 Dec 19:09:45 GMT 2018
    >   TOPIC                   PARTITION  CURRENT-OFFSET  LOG-END-OFFSET  LAG             CONSUMER-ID                                                 HOST            CLIENT-ID
    >   ztf_20181219_programid1 0          3197            20858           17661           ztf-mirror.roe.ac.uk-0-28c360df-3013-470a-8bc3-f0c7e0110c69 /129.215.175.98 ztf-mirror.roe.ac.uk-0
    >   ztf_20181219_programid1 10         3150            20859           17709           ztf-mirror.roe.ac.uk-1-2c096f42-2ab9-431a-ae88-1357b8873c35 /129.215.175.98 ztf-mirror.roe.ac.uk-1
    >   ztf_20181219_programid1 11         3193            20858           17665           ztf-mirror.roe.ac.uk-1-b56e5897-5ca5-497f-9a8a-c9b7b7480b23 /129.215.175.98 ztf-mirror.roe.ac.uk-1
    >   ztf_20181219_programid1 12         3164            20858           17694           ztf-mirror.roe.ac.uk-2-0cb6e6b8-d534-4a14-9a55-9af2d321bb50 /129.215.175.98 ztf-mirror.roe.ac.uk-2
    >   ztf_20181219_programid1 1          3149            20859           17710           ztf-mirror.roe.ac.uk-0-ce193fc9-da42-4670-960a-ccaa127ace9c /129.215.175.98 ztf-mirror.roe.ac.uk-0
    >   ztf_20181219_programid1 13         3186            20859           17673           ztf-mirror.roe.ac.uk-2-3fecac00-538a-418e-b6e4-73beef1580dd /129.215.175.98 ztf-mirror.roe.ac.uk-2
    >   ztf_20181219_programid1 2          3147            20858           17711           ztf-mirror.roe.ac.uk-1-2c096f42-2ab9-431a-ae88-1357b8873c35 /129.215.175.98 ztf-mirror.roe.ac.uk-1
    >   ztf_20181219_programid1 3          3193            20859           17666           ztf-mirror.roe.ac.uk-1-b56e5897-5ca5-497f-9a8a-c9b7b7480b23 /129.215.175.98 ztf-mirror.roe.ac.uk-1
    >   ztf_20181219_programid1 4          3169            20859           17690           ztf-mirror.roe.ac.uk-2-0cb6e6b8-d534-4a14-9a55-9af2d321bb50 /129.215.175.98 ztf-mirror.roe.ac.uk-2
    >   ztf_20181219_programid1 5          3184            20858           17674           ztf-mirror.roe.ac.uk-2-3fecac00-538a-418e-b6e4-73beef1580dd /129.215.175.98 ztf-mirror.roe.ac.uk-2
    >   ztf_20181219_programid1 6          6197            20858           14661           ztf-mirror.roe.ac.uk-3-60cba15d-0bad-41bc-8c6e-fb0849800aee /129.215.175.98 ztf-mirror.roe.ac.uk-3
    >   ztf_20181219_programid1 7          6132            20859           14727           ztf-mirror.roe.ac.uk-3-e2c87d6f-e332-4b42-a888-c2fa39f8d2bb /129.215.175.98 ztf-mirror.roe.ac.uk-3
    >   ztf_20181219_programid1 8          3191            20858           17667           ztf-mirror.roe.ac.uk-0-28c360df-3013-470a-8bc3-f0c7e0110c69 /129.215.175.98 ztf-mirror.roe.ac.uk-0
    >   ztf_20181219_programid1 9          3142            20859           17717           ztf-mirror.roe.ac.uk-0-ce193fc9-da42-4670-960a-ccaa127ace9c /129.215.175.98 ztf-mirror.roe.ac.uk-0
    >   Sun 23 Dec 19:09:54 GMT 2018


    >   Sun 23 Dec 19:14:42 GMT 2018
    >   TOPIC                   PARTITION  CURRENT-OFFSET  LOG-END-OFFSET  LAG             CONSUMER-ID                                                 HOST            CLIENT-ID
    >   ztf_20181219_programid1 0          4545            20858           16313           ztf-mirror.roe.ac.uk-0-28c360df-3013-470a-8bc3-f0c7e0110c69 /129.215.175.98 ztf-mirror.roe.ac.uk-0
    >   ztf_20181219_programid1 10         4500            20859           16359           ztf-mirror.roe.ac.uk-1-2c096f42-2ab9-431a-ae88-1357b8873c35 /129.215.175.98 ztf-mirror.roe.ac.uk-1
    >   ztf_20181219_programid1 11         4547            20858           16311           ztf-mirror.roe.ac.uk-1-b56e5897-5ca5-497f-9a8a-c9b7b7480b23 /129.215.175.98 ztf-mirror.roe.ac.uk-1
    >   ztf_20181219_programid1 12         4511            20858           16347           ztf-mirror.roe.ac.uk-2-0cb6e6b8-d534-4a14-9a55-9af2d321bb50 /129.215.175.98 ztf-mirror.roe.ac.uk-2
    >   ztf_20181219_programid1 13         4539            20859           16320           ztf-mirror.roe.ac.uk-2-3fecac00-538a-418e-b6e4-73beef1580dd /129.215.175.98 ztf-mirror.roe.ac.uk-2
    >   ztf_20181219_programid1 1          4499            20859           16360           ztf-mirror.roe.ac.uk-0-ce193fc9-da42-4670-960a-ccaa127ace9c /129.215.175.98 ztf-mirror.roe.ac.uk-0
    >   ztf_20181219_programid1 2          4494            20858           16364           ztf-mirror.roe.ac.uk-1-2c096f42-2ab9-431a-ae88-1357b8873c35 /129.215.175.98 ztf-mirror.roe.ac.uk-1
    >   ztf_20181219_programid1 3          4544            20859           16315           ztf-mirror.roe.ac.uk-1-b56e5897-5ca5-497f-9a8a-c9b7b7480b23 /129.215.175.98 ztf-mirror.roe.ac.uk-1
    >   ztf_20181219_programid1 4          4521            20859           16338           ztf-mirror.roe.ac.uk-2-0cb6e6b8-d534-4a14-9a55-9af2d321bb50 /129.215.175.98 ztf-mirror.roe.ac.uk-2
    >   ztf_20181219_programid1 5          4532            20858           16326           ztf-mirror.roe.ac.uk-2-3fecac00-538a-418e-b6e4-73beef1580dd /129.215.175.98 ztf-mirror.roe.ac.uk-2
    >   ztf_20181219_programid1 6          8817            20858           12041           ztf-mirror.roe.ac.uk-3-60cba15d-0bad-41bc-8c6e-fb0849800aee /129.215.175.98 ztf-mirror.roe.ac.uk-3
    >   ztf_20181219_programid1 7          8754            20859           12105           ztf-mirror.roe.ac.uk-3-e2c87d6f-e332-4b42-a888-c2fa39f8d2bb /129.215.175.98 ztf-mirror.roe.ac.uk-3
    >   ztf_20181219_programid1 8          4540            20858           16318           ztf-mirror.roe.ac.uk-0-28c360df-3013-470a-8bc3-f0c7e0110c69 /129.215.175.98 ztf-mirror.roe.ac.uk-0
    >   ztf_20181219_programid1 9          4492            20859           16367           ztf-mirror.roe.ac.uk-0-ce193fc9-da42-4670-960a-ccaa127ace9c /129.215.175.98 ztf-mirror.roe.ac.uk-0
    >   Sun 23 Dec 19:14:49 GMT 2018


    >   Sun 23 Dec 19:47:55 GMT 2018
    >   TOPIC                   PARTITION  CURRENT-OFFSET  LOG-END-OFFSET  LAG             CONSUMER-ID     HOST            CLIENT-ID
    >   ztf_20181219_programid1 0          9953            20858           10905           -               -               -
    >   ztf_20181219_programid1 10         9906            20859           10953           -               -               -
    >   ztf_20181219_programid1 1          10159           20859           10700           -               -               -
    >   ztf_20181219_programid1 11         9932            20858           10926           -               -               -
    >   ztf_20181219_programid1 12         10173           20858           10685           -               -               -
    >   ztf_20181219_programid1 13         9925            20859           10934           -               -               -
    >   ztf_20181219_programid1 2          9898            20858           10960           -               -               -
    >   ztf_20181219_programid1 3          9938            20859           10921           -               -               -
    >   ztf_20181219_programid1 4          10175           20859           10684           -               -               -
    >   ztf_20181219_programid1 5          9922            20858           10936           -               -               -
    >   ztf_20181219_programid1 6          19831           20858           1027            -               -               -
    >   ztf_20181219_programid1 7          19778           20859           1081            -               -               -
    >   ztf_20181219_programid1 8          9947            20858           10911           -               -               -
    >   ztf_20181219_programid1 9          10155           20859           10704           -               -               -
    >   Sun 23 Dec 19:48:04 GMT 2018


# -----------------------------------------------------
# Check the disc use on each Kafka node.
#[user@trop03]

    for vmname in ${kfnames[@]}
        do
            ssh \
                ${sshopts[*]} \
                ${sshuser:?}@${vmname:?} \
                    "
                    echo \"---- ---- ---- ----\"
                    echo \"[\$(hostname)][\$(date)]\"

                    echo \"---- ----\"
                    du -h -d 1 \"/data1-02\"

                    echo "---- ----"
                    du -h -d 1 \"/data2-02\"
                    "
        done


    >   ---- ---- ---- ----
    >   [Stedigo][Sun 23 Dec 19:06:31 GMT 2018]
    >   ---- ----
    >   156M	/data1-02/ztf_20181219_programid1-10
    >   156M	/data1-02/ztf_20181219_programid1-4
    >   156M	/data1-02/ztf_20181219_programid1-8
    >   155M	/data1-02/ztf_20181219_programid1-12
    >   156M	/data1-02/ztf_20181219_programid1-6
    >   156M	/data1-02/ztf_20181219_programid1-0
    >   932M	/data1-02
    >   ---- ----
    >   16K	/data2-02
    >   ---- ---- ---- ----
    >   [Angece][Sun 23 Dec 19:06:31 GMT 2018]
    >   ---- ----
    >   156M	/data1-02/ztf_20181219_programid1-10
    >   156M	/data1-02/ztf_20181219_programid1-4
    >   155M	/data1-02/ztf_20181219_programid1-14
    >   156M	/data1-02/ztf_20181219_programid1-5
    >   155M	/data1-02/ztf_20181219_programid1-12
    >   156M	/data1-02/ztf_20181219_programid1-0
    >   931M	/data1-02
    >   ---- ----
    >   16K	/data2-02
    >   ---- ---- ---- ----
    >   [Edwalafia][Sun 23 Dec 19:06:31 GMT 2018]
    >   ---- ----
    >   156M	/data1-02/ztf_20181219_programid1-10
    >   156M	/data1-02/ztf_20181219_programid1-1
    >   156M	/data1-02/ztf_20181219_programid1-11
    >   156M	/data1-02/ztf_20181219_programid1-5
    >   156M	/data1-02/ztf_20181219_programid1-2
    >   156M	/data1-02/ztf_20181219_programid1-3
    >   932M	/data1-02
    >   ---- ----
    >   16K	/data2-02
    >   ---- ---- ---- ----
    >   [Onoza][Sun 23 Dec 19:06:32 GMT 2018]
    >   ---- ----
    >   156M	/data1-02/ztf_20181219_programid1-7
    >   156M	/data1-02/ztf_20181219_programid1-11
    >   156M	/data1-02/ztf_20181219_programid1-5
    >   156M	/data1-02/ztf_20181219_programid1-2
    >   156M	/data1-02/ztf_20181219_programid1-9
    >   156M	/data1-02/ztf_20181219_programid1-3
    >   933M	/data1-02
    >   ---- ----
    >   16K	/data2-02


    >   ---- ---- ---- ----
    >   [Stedigo][Sun 23 Dec 19:10:25 GMT 2018]
    >   ---- ----
    >   221M	/data1-02/ztf_20181219_programid1-10
    >   221M	/data1-02/ztf_20181219_programid1-4
    >   221M	/data1-02/ztf_20181219_programid1-8
    >   221M	/data1-02/ztf_20181219_programid1-12
    >   222M	/data1-02/ztf_20181219_programid1-6
    >   221M	/data1-02/ztf_20181219_programid1-0
    >   1.3G	/data1-02
    >   ---- ----
    >   16K	/data2-02
    >   ---- ---- ---- ----
    >   [Angece][Sun 23 Dec 19:10:26 GMT 2018]
    >   ---- ----
    >   222M	/data1-02/ztf_20181219_programid1-10
    >   221M	/data1-02/ztf_20181219_programid1-4
    >   221M	/data1-02/ztf_20181219_programid1-14
    >   221M	/data1-02/ztf_20181219_programid1-5
    >   221M	/data1-02/ztf_20181219_programid1-12
    >   221M	/data1-02/ztf_20181219_programid1-0
    >   1.3G	/data1-02
    >   ---- ----
    >   16K	/data2-02
    >   ---- ---- ---- ----
    >   [Edwalafia][Sun 23 Dec 19:10:26 GMT 2018]
    >   ---- ----
    >   222M	/data1-02/ztf_20181219_programid1-10
    >   221M	/data1-02/ztf_20181219_programid1-1
    >   221M	/data1-02/ztf_20181219_programid1-11
    >   221M	/data1-02/ztf_20181219_programid1-5
    >   221M	/data1-02/ztf_20181219_programid1-2
    >   222M	/data1-02/ztf_20181219_programid1-3
    >   1.3G	/data1-02
    >   ---- ----
    >   16K	/data2-02
    >   ---- ---- ---- ----
    >   [Onoza][Sun 23 Dec 19:10:27 GMT 2018]
    >   ---- ----
    >   222M	/data1-02/ztf_20181219_programid1-7
    >   222M	/data1-02/ztf_20181219_programid1-11
    >   221M	/data1-02/ztf_20181219_programid1-5
    >   221M	/data1-02/ztf_20181219_programid1-2
    >   222M	/data1-02/ztf_20181219_programid1-9
    >   222M	/data1-02/ztf_20181219_programid1-3
    >   1.3G	/data1-02
    >   ---- ----
    >   16K	/data2-02


    >   ---- ---- ---- ----
    >   [Stedigo][Sun 23 Dec 19:21:18 GMT 2018]
    >   ---- ----
    >   405M	/data1-02/ztf_20181219_programid1-10
    >   405M	/data1-02/ztf_20181219_programid1-4
    >   406M	/data1-02/ztf_20181219_programid1-8
    >   406M	/data1-02/ztf_20181219_programid1-12
    >   406M	/data1-02/ztf_20181219_programid1-6
    >   405M	/data1-02/ztf_20181219_programid1-0
    >   2.4G	/data1-02
    >   ---- ----
    >   16K	/data2-02
    >   ---- ---- ---- ----
    >   [Angece][Sun 23 Dec 19:21:18 GMT 2018]
    >   ---- ----
    >   406M	/data1-02/ztf_20181219_programid1-10
    >   406M	/data1-02/ztf_20181219_programid1-4
    >   405M	/data1-02/ztf_20181219_programid1-14
    >   406M	/data1-02/ztf_20181219_programid1-5
    >   406M	/data1-02/ztf_20181219_programid1-12
    >   406M	/data1-02/ztf_20181219_programid1-0
    >   2.4G	/data1-02
    >   ---- ----
    >   16K	/data2-02
    >   ---- ---- ---- ----
    >   [Edwalafia][Sun 23 Dec 19:21:19 GMT 2018]
    >   ---- ----
    >   406M	/data1-02/ztf_20181219_programid1-10
    >   405M	/data1-02/ztf_20181219_programid1-1
    >   406M	/data1-02/ztf_20181219_programid1-11
    >   406M	/data1-02/ztf_20181219_programid1-5
    >   406M	/data1-02/ztf_20181219_programid1-2
    >   406M	/data1-02/ztf_20181219_programid1-3
    >   2.4G	/data1-02
    >   ---- ----
    >   16K	/data2-02
    >   ---- ---- ---- ----
    >   [Onoza][Sun 23 Dec 19:21:20 GMT 2018]
    >   ---- ----
    >   406M	/data1-02/ztf_20181219_programid1-7
    >   406M	/data1-02/ztf_20181219_programid1-11
    >   406M	/data1-02/ztf_20181219_programid1-5
    >   406M	/data1-02/ztf_20181219_programid1-2
    >   406M	/data1-02/ztf_20181219_programid1-9
    >   406M	/data1-02/ztf_20181219_programid1-3
    >   2.4G	/data1-02
    >   ---- ----
    >   16K	/data2-02


    >   ---- ---- ---- ----
    >   [Stedigo][Sun 23 Dec 19:48:53 GMT 2018]
    >   ---- ----
    >   648M	/data1-02/ztf_20181219_programid1-10
    >   649M	/data1-02/ztf_20181219_programid1-4
    >   649M	/data1-02/ztf_20181219_programid1-8
    >   649M	/data1-02/ztf_20181219_programid1-12
    >   648M	/data1-02/ztf_20181219_programid1-6
    >   648M	/data1-02/ztf_20181219_programid1-0
    >   3.8G	/data1-02
    >   ---- ----
    >   16K	/data2-02
    >   ---- ---- ---- ----
    >   [Angece][Sun 23 Dec 19:48:54 GMT 2018]
    >   ---- ----
    >   648M	/data1-02/ztf_20181219_programid1-10
    >   649M	/data1-02/ztf_20181219_programid1-4
    >   648M	/data1-02/ztf_20181219_programid1-14
    >   648M	/data1-02/ztf_20181219_programid1-5
    >   649M	/data1-02/ztf_20181219_programid1-12
    >   648M	/data1-02/ztf_20181219_programid1-0
    >   3.8G	/data1-02
    >   ---- ----
    >   16K	/data2-02
    >   ---- ---- ---- ----
    >   [Edwalafia][Sun 23 Dec 19:48:55 GMT 2018]
    >   ---- ----
    >   648M	/data1-02/ztf_20181219_programid1-10
    >   647M	/data1-02/ztf_20181219_programid1-1
    >   648M	/data1-02/ztf_20181219_programid1-11
    >   648M	/data1-02/ztf_20181219_programid1-5
    >   648M	/data1-02/ztf_20181219_programid1-2
    >   648M	/data1-02/ztf_20181219_programid1-3
    >   3.8G	/data1-02
    >   ---- ----
    >   16K	/data2-02
    >   ---- ---- ---- ----
    >   [Onoza][Sun 23 Dec 19:48:55 GMT 2018]
    >   ---- ----
    >   649M	/data1-02/ztf_20181219_programid1-7
    >   649M	/data1-02/ztf_20181219_programid1-11
    >   648M	/data1-02/ztf_20181219_programid1-5
    >   648M	/data1-02/ztf_20181219_programid1-2
    >   649M	/data1-02/ztf_20181219_programid1-9
    >   649M	/data1-02/ztf_20181219_programid1-3
    >   3.8G	/data1-02
    >   ---- ----
    >   16K	/data2-02


# -----------------------------------------------------
# Kafka fails writing to /data2-02.
#[user@trop03]


    >   [2018-12-23 19:35:33,762] ERROR Error while appending records to ztf_20181219_programid1-15 in dir /data2-02 (kafka.server.LogDirFailureChannel)
    >   java.io.IOException: No space left on device
    >   	at sun.nio.ch.FileDispatcherImpl.write0(Native Method)
    >   	at sun.nio.ch.FileDispatcherImpl.write(FileDispatcherImpl.java:60)
    >   	....
    >   	....


# -----------------------------------------------------
# Stop kafka on each node.
#[user@trop03]

    for vmname in ${kfnames[@]}
        do
            echo "---- ----"
            ssh \
                ${scpopts[*]} \
                ${sshuser:?}@${vmname:?} \
                "
                hostname
                docker-compose \
                    --file kafka.yml \
                    down
                "
        done


    >   ---- ----
    >   Stedigo
    >   Removing stevedore_emily_1 ... done
    >   Removing network stevedore_default
    >   ---- ----
    >   Angece
    >   Stopping stevedore_emily_1 ... done
    >   Removing stevedore_emily_1 ... done
    >   Removing network stevedore_default
    >   ---- ----
    >   Edwalafia
    >   Stopping stevedore_emily_1 ... done
    >   Removing stevedore_emily_1 ... done
    >   Removing network stevedore_default
    >   error while removing network: network stevedore_default id e147ed1b28de293cd536c266ddfef91606242c9530b378770744b7495b589832 has active endpoints
    >   ---- ----
    >   Onoza
    >   Removing stevedore_emily_1 ... done
    >   Removing network stevedore_default


# -----------------------------------------------------
# Stop MirrorMaker on each node.
#[user@trop03]

    for vmname in ${mmnames[@]}
        do
            echo "---- ----"
            echo "vmname [${vmname:?}]"
            ssh \
                ${scpopts[*]} \
                ${sshuser:?}@${vmname:?} \
                "
                docker-compose \
                    --file mirror.yml \
                    down
                "
        done


    >   ---- ----
    >   vmname [Afoaviel]
    >   Removing stevedore_tina_1 ... done
    >   Removing network stevedore_default
    >   ---- ----
    >   vmname [Rusaldez]
    >   Removing stevedore_tina_1 ... done
    >   Removing network stevedore_default


# -----------------------------------------------------
# Fix dumb mistakes in our Kafka compose YML files.
#[user@trop03]

    for vmname in ${kfnames[@]}
        do
            echo "---- ----"
            echo "vmname [${vmname:?}]"
            ssh \
                ${scpopts[*]} \
                ${sshuser:?}@${vmname:?} \
                    "
                    sed -i '
                        /^[[:space:]]*volumes:/,$ {
                            d
                            }
                        ' kafka.yml

                    cat >> kafka.yml << 'EOF'
        volumes:
            - type:   \"bind\"
              source: \"/data1-01\"
              target: \"/data1-01\"
            - type:   \"bind\"
              source: \"/data2-01\"
              target: \"/data2-01\"
            - type:   \"bind\"
              source: \"/data1-02\"
              target: \"/data1-02\"
            - type:   \"bind\"
              source: \"/data2-02\"
              target: \"/data2-02\"
EOF
                    "
        done

# -----------------------------------------------------
# Start Kafka on each node.
#[user@trop03]

    for vmname in ${kfnames[@]}
        do
            echo "---- ----"
            ssh \
                ${scpopts[*]} \
                ${sshuser:?}@${vmname:?} \
                "
                hostname
                docker-compose \
                    --file kafka.yml \
                    up -d
                "
        done


    >   ---- ----
    >   Stedigo
    >   Creating network "stevedore_default" with the default driver
    >   Creating stevedore_emily_1 ... done
    >   ---- ----
    >   Angece
    >   Creating network "stevedore_default" with the default driver
    >   Creating stevedore_emily_1 ... done
    >   ---- ----
    >   Edwalafia
    >   Creating stevedore_emily_1 ... error
    >
    >   ERROR: for stevedore_emily_1  Cannot start service emily: endpoint with name stevedore_emily_1 already exists in network stevedore_default
    >
    >   ERROR: for emily  Cannot start service emily: endpoint with name stevedore_emily_1 already exists in network stevedore_default
    >   Encountered errors while bringing up the project.
    >   ---- ----
    >   Onoza
    >   Creating network "stevedore_default" with the default driver
    >   Creating stevedore_emily_1 ... done


# -----------------------------------------------------
# Login to the node and manually fix the container.
#[[Stevedore@Edwalafia]

    docker network ls

    >       NETWORK ID          NAME                DRIVER              SCOPE
    >       039bb2e2fd5a        bridge              bridge              local
    >       06a06c16103d        host                host                local
    >       14bfbb6b5abe        none                null                local
    >       e147ed1b28de        stevedore_default   bridge              local

    docker network rm stevedore_default

    >       Error response from daemon: error while removing network: network stevedore_default id e147ed1b28de293cd536c266ddfef91606242c9530b378770744b7495b589832 has active endpoints

    docker ps -a

    >       CONTAINER ID        IMAGE                         COMMAND                  CREATED             STATUS              PORTS               NAMES
    >       09f9d17d284e        confluentinc/cp-kafka:4.1.1   "/etc/confluent/dock…"   6 minutes ago       Created                                 stevedore_emily_1
    >
    >       docker rm -f stevedore_emily_1
    >
    >       stevedore_emily_1

    docker ps -a

    >       CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES

    sudo systemctl restart docker

    docker network rm stevedore_default

    >       stevedore_default

    docker network ls

    >       NETWORK ID          NAME                DRIVER              SCOPE
    >       3da97f0faa04        bridge              bridge              local
    >       06a06c16103d        host                host                local
    >       14bfbb6b5abe        none                null                local

    docker ps

    >       CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES

    docker-compose \
        --file kafka.yml \
        up -d

    >       Creating network "stevedore_default" with the default driver
    >       Creating stevedore_emily_1 ... done


# -----------------------------------------------------
# Check our client offsets in the ZTF broker.
#[user@trop03]

    devnode=Rusaldez

    ztfconnect=public.alerts.ztf.uw.edu:9092
    roegroupid=ztf-mirror.roe.ac.uk

    date ; \
    ssh \
        ${sshopts[*]} \
        ${sshuser:?}@${devnode:?} \
        "
        docker run --rm phymatopus/kafka-core \
            bin/kafka-consumer-groups.sh \
                --bootstrap-server "${ztfconnect:?}" \
                --describe \
                --group "${roegroupid:?}"
         " \
    | sort \
    ; date


    >   Sun 23 Dec 20:51:33 GMT 2018
    >   Consumer group 'ztf-mirror.roe.ac.uk' has no active members.
    >   TOPIC                   PARTITION  CURRENT-OFFSET  LOG-END-OFFSET  LAG             CONSUMER-ID     HOST            CLIENT-ID
    >   ztf_20181219_programid1 0          9953            20858           10905           -               -               -
    >   ztf_20181219_programid1 10         9906            20859           10953           -               -               -
    >   ztf_20181219_programid1 1          10159           20859           10700           -               -               -
    >   ztf_20181219_programid1 11         9932            20858           10926           -               -               -
    >   ztf_20181219_programid1 12         10173           20858           10685           -               -               -
    >   ztf_20181219_programid1 13         9925            20859           10934           -               -               -
    >   ztf_20181219_programid1 2          9898            20858           10960           -               -               -
    >   ztf_20181219_programid1 3          9938            20859           10921           -               -               -
    >   ztf_20181219_programid1 4          10175           20859           10684           -               -               -
    >   ztf_20181219_programid1 5          9922            20858           10936           -               -               -
    >   ztf_20181219_programid1 6          19831           20858           1027            -               -               -
    >   ztf_20181219_programid1 7          19778           20859           1081            -               -               -
    >   ztf_20181219_programid1 8          9947            20858           10911           -               -               -
    >   ztf_20181219_programid1 9          10155           20859           10704           -               -               -
    >   Sun 23 Dec 20:51:42 GMT 2018


# -----------------------------------------------------
# Check the disc use on each Kafka node.
#[user@trop03]

    for vmname in ${kfnames[@]}
        do
            ssh \
                ${sshopts[*]} \
                ${sshuser:?}@${vmname:?} \
                    "
                    echo \"---- ---- ---- ----\"
                    echo \"[\$(hostname)][\$(date)]\"

                    echo \"---- ----\"
                    du -h -d 1 \"/data1-02\"

                    echo "---- ----"
                    du -h -d 1 \"/data2-02\"
                    "
        done


    >   ---- ---- ---- ----
    >   [Stedigo][Sun 23 Dec 20:52:31 GMT 2018]
    >   ---- ----
    >   648M	/data1-02/ztf_20181219_programid1-10
    >   649M	/data1-02/ztf_20181219_programid1-4
    >   649M	/data1-02/ztf_20181219_programid1-8
    >   649M	/data1-02/ztf_20181219_programid1-12
    >   648M	/data1-02/ztf_20181219_programid1-6
    >   648M	/data1-02/ztf_20181219_programid1-0
    >   3.8G	/data1-02
    >   ---- ----
    >   16K	/data2-02
    >   ---- ---- ---- ----
    >   [Angece][Sun 23 Dec 20:52:33 GMT 2018]
    >   ---- ----
    >   648M	/data1-02/ztf_20181219_programid1-10
    >   649M	/data1-02/ztf_20181219_programid1-4
    >   648M	/data1-02/ztf_20181219_programid1-14
    >   648M	/data1-02/ztf_20181219_programid1-5
    >   649M	/data1-02/ztf_20181219_programid1-12
    >   648M	/data1-02/ztf_20181219_programid1-0
    >   3.8G	/data1-02
    >   ---- ----
    >   16K	/data2-02
    >   ---- ---- ---- ----
    >   [Edwalafia][Sun 23 Dec 20:52:34 GMT 2018]
    >   ---- ----
    >   648M	/data1-02/ztf_20181219_programid1-10
    >   647M	/data1-02/ztf_20181219_programid1-1
    >   648M	/data1-02/ztf_20181219_programid1-11
    >   648M	/data1-02/ztf_20181219_programid1-5
    >   648M	/data1-02/ztf_20181219_programid1-2
    >   648M	/data1-02/ztf_20181219_programid1-3
    >   3.8G	/data1-02
    >   ---- ----
    >   16K	/data2-02
    >   ---- ---- ---- ----
    >   [Onoza][Sun 23 Dec 20:52:35 GMT 2018]
    >   ---- ----
    >   649M	/data1-02/ztf_20181219_programid1-7
    >   649M	/data1-02/ztf_20181219_programid1-11
    >   648M	/data1-02/ztf_20181219_programid1-5
    >   648M	/data1-02/ztf_20181219_programid1-2
    >   649M	/data1-02/ztf_20181219_programid1-9
    >   649M	/data1-02/ztf_20181219_programid1-3
    >   3.8G	/data1-02
    >   ---- ----
    >   16K	/data2-02


# -----------------------------------------------------
# Update the topic and restart MirrorMaker on each node.
#[user@trop03]

    ztftopicid=ztf_20181218_programid1
    ztftopicid=ztf_20181219_programid1

    for vmname in ${mmnames[@]}
        do
            echo "---- ----"
            echo "vmname [${vmname:?}]"
            ssh \
                ${scpopts[*]} \
                ${sshuser:?}@${vmname:?} \
                "
                docker-compose \
                    --file mirror.yml \
                    down
                sed -i \"
                    s/^ztftopicid=.*/ztftopicid=${ztftopicid:?}/
                    \" mirror.env
                docker-compose \
                    --file mirror.yml \
                    up -d
                "
        done


    >   ---- ----
    >   vmname [Afoaviel]
    >   Removing network stevedore_default
    >   Network stevedore_default not found.
    >   Creating network "stevedore_default" with the default driver
    >   Creating stevedore_tina_1 ... done
    >   ---- ----
    >   vmname [Rusaldez]
    >   Removing network stevedore_default
    >   Network stevedore_default not found.
    >   Creating network "stevedore_default" with the default driver
    >   Creating stevedore_tina_1 ... done


# -----------------------------------------------------
# Check our client offsets in the ZTF broker.
#[user@trop03]

    devnode=Rusaldez

    ztfconnect=public.alerts.ztf.uw.edu:9092
    roegroupid=ztf-mirror.roe.ac.uk

    date ; \
    ssh \
        ${sshopts[*]} \
        ${sshuser:?}@${devnode:?} \
        "
        docker run --rm phymatopus/kafka-core \
            bin/kafka-consumer-groups.sh \
                --bootstrap-server "${ztfconnect:?}" \
                --describe \
                --group "${roegroupid:?}"
         " \
    | sort \
    ; date


    >   Sun 23 Dec 20:53:50 GMT 2018
    >   TOPIC                   PARTITION  CURRENT-OFFSET  LOG-END-OFFSET  LAG             CONSUMER-ID                                                 HOST            CLIENT-ID
    >   ztf_20181219_programid1 0          9953            20858           10905           ztf-mirror.roe.ac.uk-0-840d8bb1-ff1b-49f0-ba13-fec11fba2f8d /129.215.175.98 ztf-mirror.roe.ac.uk-0
    >   ztf_20181219_programid1 10         9906            20859           10953           ztf-mirror.roe.ac.uk-1-054d678a-2894-4654-89be-75f357aff52d /129.215.175.98 ztf-mirror.roe.ac.uk-1
    >   ztf_20181219_programid1 1          10159           20859           10700           ztf-mirror.roe.ac.uk-0-df75b4ac-ecb0-460b-b92d-6cd9f6192786 /129.215.175.98 ztf-mirror.roe.ac.uk-0
    >   ztf_20181219_programid1 11         9932            20858           10926           ztf-mirror.roe.ac.uk-1-29e0e12d-23bf-4309-b0b9-99aa5671e799 /129.215.175.98 ztf-mirror.roe.ac.uk-1
    >   ztf_20181219_programid1 12         10173           20858           10685           ztf-mirror.roe.ac.uk-2-98fbc524-6c31-4b44-b926-05459e966962 /129.215.175.98 ztf-mirror.roe.ac.uk-2
    >   ztf_20181219_programid1 13         9925            20859           10934           ztf-mirror.roe.ac.uk-2-d860ab18-7d28-4d0d-9438-e45fce3d4290 /129.215.175.98 ztf-mirror.roe.ac.uk-2
    >   ztf_20181219_programid1 2          9898            20858           10960           ztf-mirror.roe.ac.uk-1-054d678a-2894-4654-89be-75f357aff52d /129.215.175.98 ztf-mirror.roe.ac.uk-1
    >   ztf_20181219_programid1 3          9938            20859           10921           ztf-mirror.roe.ac.uk-1-29e0e12d-23bf-4309-b0b9-99aa5671e799 /129.215.175.98 ztf-mirror.roe.ac.uk-1
    >   ztf_20181219_programid1 4          10175           20859           10684           ztf-mirror.roe.ac.uk-2-98fbc524-6c31-4b44-b926-05459e966962 /129.215.175.98 ztf-mirror.roe.ac.uk-2
    >   ztf_20181219_programid1 5          9922            20858           10936           ztf-mirror.roe.ac.uk-2-d860ab18-7d28-4d0d-9438-e45fce3d4290 /129.215.175.98 ztf-mirror.roe.ac.uk-2
    >   ztf_20181219_programid1 6          19831           20858           1027            ztf-mirror.roe.ac.uk-3-3f4c45f0-2d86-4d31-8160-9c9d106122d7 /129.215.175.98 ztf-mirror.roe.ac.uk-3
    >   ztf_20181219_programid1 7          19778           20859           1081            ztf-mirror.roe.ac.uk-3-dcf0e662-af6a-49fb-91f8-c718fa7ff63d /129.215.175.98 ztf-mirror.roe.ac.uk-3
    >   ztf_20181219_programid1 8          9947            20858           10911           ztf-mirror.roe.ac.uk-0-840d8bb1-ff1b-49f0-ba13-fec11fba2f8d /129.215.175.98 ztf-mirror.roe.ac.uk-0
    >   ztf_20181219_programid1 9          10155           20859           10704           ztf-mirror.roe.ac.uk-0-df75b4ac-ecb0-460b-b92d-6cd9f6192786 /129.215.175.98 ztf-mirror.roe.ac.uk-0
    >   Sun 23 Dec 20:53:57 GMT 2018


    >   Sun 23 Dec 20:58:33 GMT 2018
    >   Consumer group 'ztf-mirror.roe.ac.uk' has no active members.
    >   TOPIC                   PARTITION  CURRENT-OFFSET  LOG-END-OFFSET  LAG             CONSUMER-ID     HOST            CLIENT-ID
    >   ztf_20181219_programid1 0          9953            20858           10905           -               -               -
    >   ztf_20181219_programid1 10         9906            20859           10953           -               -               -
    >   ztf_20181219_programid1 1          10159           20859           10700           -               -               -
    >   ztf_20181219_programid1 11         9932            20858           10926           -               -               -
    >   ztf_20181219_programid1 12         10173           20858           10685           -               -               -
    >   ztf_20181219_programid1 13         9925            20859           10934           -               -               -
    >   ztf_20181219_programid1 2          9898            20858           10960           -               -               -
    >   ztf_20181219_programid1 3          9938            20859           10921           -               -               -
    >   ztf_20181219_programid1 4          10175           20859           10684           -               -               -
    >   ztf_20181219_programid1 5          9922            20858           10936           -               -               -
    >   ztf_20181219_programid1 6          19831           20858           1027            -               -               -
    >   ztf_20181219_programid1 7          19778           20859           1081            -               -               -
    >   ztf_20181219_programid1 8          9947            20858           10911           -               -               -
    >   ztf_20181219_programid1 9          10155           20859           10704           -               -               -
    >   Sun 23 Dec 20:58:42 GMT 2018

# -----------------------------------------------------
# Check the disc use on each Kafka node.
#[user@trop03]

    for vmname in ${kfnames[@]}
        do
            ssh \
                ${sshopts[*]} \
                ${sshuser:?}@${vmname:?} \
                    "
                    echo \"---- ---- ---- ----\"
                    echo \"[\$(hostname)][\$(date)]\"

                    echo \"---- ----\"
                    du -h -d 1 \"/data1-02\"

                    echo "---- ----"
                    du -h -d 1 \"/data2-02\"
                    "
        done


    >   ---- ---- ---- ----
    >   [Stedigo][Sun 23 Dec 20:54:40 GMT 2018]
    >   ---- ----
    >   648M	/data1-02/ztf_20181219_programid1-10
    >   649M	/data1-02/ztf_20181219_programid1-4
    >   649M	/data1-02/ztf_20181219_programid1-8
    >   649M	/data1-02/ztf_20181219_programid1-12
    >   648M	/data1-02/ztf_20181219_programid1-6
    >   648M	/data1-02/ztf_20181219_programid1-0
    >   3.8G	/data1-02
    >   ---- ----
    >   16K	/data2-02
    >   ---- ---- ---- ----
    >   [Angece][Sun 23 Dec 20:54:41 GMT 2018]
    >   ---- ----
    >   648M	/data1-02/ztf_20181219_programid1-10
    >   649M	/data1-02/ztf_20181219_programid1-4
    >   648M	/data1-02/ztf_20181219_programid1-14
    >   648M	/data1-02/ztf_20181219_programid1-5
    >   649M	/data1-02/ztf_20181219_programid1-12
    >   648M	/data1-02/ztf_20181219_programid1-0
    >   3.8G	/data1-02
    >   ---- ----
    >   16K	/data2-02
    >   ---- ---- ---- ----
    >   [Edwalafia][Sun 23 Dec 20:54:44 GMT 2018]
    >   ---- ----
    >   648M	/data1-02/ztf_20181219_programid1-10
    >   647M	/data1-02/ztf_20181219_programid1-1
    >   648M	/data1-02/ztf_20181219_programid1-11
    >   648M	/data1-02/ztf_20181219_programid1-5
    >   648M	/data1-02/ztf_20181219_programid1-2
    >   648M	/data1-02/ztf_20181219_programid1-3
    >   3.8G	/data1-02
    >   ---- ----
    >   16K	/data2-02
    >   ---- ---- ---- ----
    >   [Onoza][Sun 23 Dec 20:54:46 GMT 2018]
    >   ---- ----
    >   649M	/data1-02/ztf_20181219_programid1-7
    >   649M	/data1-02/ztf_20181219_programid1-11
    >   648M	/data1-02/ztf_20181219_programid1-5
    >   648M	/data1-02/ztf_20181219_programid1-2
    >   649M	/data1-02/ztf_20181219_programid1-9
    >   649M	/data1-02/ztf_20181219_programid1-3
    >   3.8G	/data1-02
    >   ---- ----
    >   16K	/data2-02




